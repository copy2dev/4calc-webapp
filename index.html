<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4Calc - ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô | All-in-One Calculator Hub</title>
    <meta name="description" content="‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç MRT, ‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà, ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤, ‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå, ‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢, ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå, BTU ‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ó‡∏¢-‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©">
    <meta name="keywords" content="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç, ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì, MRT, ‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà, ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤, ‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå, ‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢, ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå, BTU, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á, calculator, thai, english">
    <meta name="author" content="4Calc Team">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://4calc.netlify.app/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://4calc.netlify.app/">
    <meta property="og:title" content="4Calc - ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô">
    <meta property="og:description" content="‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç MRT, ‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà, ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤, ‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå, ‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢, ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå, BTU ‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ó‡∏¢-‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©">
    <meta property="og:image" content="https://4calc.netlify.app/og-image.jpg">
    <meta property="og:site_name" content="4Calc">
    <meta property="og:locale" content="th_TH">
    <meta property="og:locale:alternate" content="en_US">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://4calc.netlify.app/">
    <meta property="twitter:title" content="4Calc - ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô">
    <meta property="twitter:description" content="‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç MRT, ‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà, ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤, ‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå, ‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢, ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå, BTU ‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ó‡∏¢-‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©">
    <meta property="twitter:image" content="https://4calc.netlify.app/og-image.jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans Thai', sans-serif; }
        .calculator-card:hover { transform: translateY(-2px); transition: transform 0.2s ease; }
        .lang-btn { position: relative; }
        .lang-dropdown { display: none; position: absolute; top: 100%; right: 0; background: white; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 50; min-width: 120px; }
        .lang-dropdown.show { display: block; }
        .expandable-section { transition: all 0.3s ease-out; overflow: hidden; }
        .expandable-content { max-height: 0; transition: max-height 0.3s ease-out; overflow: hidden; }
        .expandable-content.expanded { max-height: 1000px; }
        .expand-icon { transition: transform 0.3s ease; }
        .expand-icon.rotated { transform: rotate(180deg); }
    </style>

<!-- 4Calc v1.1.0 -->
<!-- Built: 2025-07-05T02:15:00.000Z -->
<!-- Environment: production -->
<!-- Branch: main -->
<!-- Commit: enhanced-mrt-calculator -->
<!-- Deployed on Netlify -->

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "4Calc",
        "alternateName": "4Calc - All-in-One Calculator Hub",
        "url": "https://4calc.netlify.app/",
        "description": "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç MRT, ‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà, ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤, ‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå, ‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢, ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå, BTU ‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ó‡∏¢-‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©",
        "applicationCategory": "Calculator",
        "operatingSystem": "All",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "author": {
            "@type": "Organization",
            "name": "4Calc Team"
        },
        "publisher": {
            "@type": "Organization",
            "name": "4Calc Team"
        },
        "inLanguage": ["th", "en"],
        "featureList": [
            "MRT ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á",
            "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà",
            "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏ü‡∏ü‡πâ‡∏≤",
            "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå‡πÄ‡∏ã‡∏•‡∏•‡πå",
            "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå",
            "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢",
            "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì BTU",
            "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á"
        ],
        "category": "Productivity",
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "ratingCount": "150"
        }
    }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <div class="text-2xl font-bold text-gray-900">
                        <span class="text-blue-600">4</span>Calc
                    </div>
                    <span id="siteSubtitle" class="ml-2 text-sm text-gray-500">
                        ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô
                    </span>
                </div>
                <div class="flex items-center space-x-4">
                    <nav class="hidden md:flex space-x-8">
                        <a href="index.html" id="nav-home" class="text-gray-700 hover:text-blue-600 transition-colors">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
                        <a href="#categories" id="nav-categories" class="text-gray-700 hover:text-blue-600 transition-colors">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</a>
                        <a href="about.html" id="nav-about" class="text-gray-700 hover:text-blue-600 transition-colors">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a>
                    </nav>
                    
                    <!-- Language Switcher -->
                    <div class="lang-btn">
                        <button id="langButton" class="flex items-center gap-2 px-3 py-2 rounded-lg border border-gray-300 bg-white hover:bg-gray-50 transition-colors">
                            <span id="currentFlag">üáπüá≠</span>
                            <span id="currentLang">‡πÑ‡∏ó‡∏¢</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="langDropdown" class="lang-dropdown">
                            <button onclick="switchLanguage('th')" class="w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-50 transition-colors rounded-t-lg">
                                <span>üáπüá≠</span>
                                <span>‡πÑ‡∏ó‡∏¢</span>
                            </button>
                            <button onclick="switchLanguage('en')" class="w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-50 transition-colors rounded-b-lg">
                                <span>üá∫üá∏</span>
                                <span>English</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        
        <!-- Header Section -->
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">
                <span id="welcomeText">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà</span> <span class="text-blue-600">4Calc</span>
            </h1>
            <p id="welcomeDescription" class="text-xl text-gray-600 mb-8">
                ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
            </p>
            
            <!-- Search Bar -->
            <div class="max-w-md mx-auto mb-8">
                <input
                    type="text"
                    id="searchInput"
                    placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç..."
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
            </div>
        </div>

        <!-- Categories -->
        <section id="categories" class="flex flex-wrap justify-center gap-2 mb-8">
            <h2 class="sr-only">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç</h2>
            <button class="category-btn px-4 py-2 bg-blue-600 text-white border border-blue-600 rounded-lg hover:bg-blue-700 transition-colors" data-category="all">
                <span class="mr-2">üîç</span>
                <span>‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</span>
            </button>
            <button class="category-btn px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors" data-category="transportation">
                <span class="mr-2">üöó</span>
                <span>‡∏Ñ‡∏°‡∏ô‡∏≤‡∏Ñ‡∏°</span>
            </button>
            <button class="category-btn px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors" data-category="health">
                <span class="mr-2">üè•</span>
                <span>‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</span>
            </button>
            <button class="category-btn px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors" data-category="finance">
                <span class="mr-2">üí≥</span>
                <span>‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</span>
            </button>
            <button class="category-btn px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors" data-category="utilities">
                <span class="mr-2">üè†</span>
                <span>‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏π‡∏õ‡πÇ‡∏†‡∏Ñ</span>
            </button>
            <button class="category-btn px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors" data-category="geography">
                <span class="mr-2">üåç</span>
                <span>‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</span>
            </button>
        </section>
        
        <!-- Calculator Grid -->
        <main id="calculatorGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <h2 class="sr-only">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
            <!-- Calculators will be populated by JavaScript -->
        </main>

        <!-- No Results -->
        <div id="noResults" class="text-center py-12 hidden">
            <div class="text-4xl mb-4">üîç</div>
            <h3 class="text-xl font-semibold mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç</h3>
            <p class="text-gray-600">‡∏•‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏≠‡∏∑‡πà‡∏ô</p>
        </div>

        <!-- Add Calculator Card -->
        <div class="mt-8 bg-white p-6 rounded-lg shadow-md border-2 border-dashed border-gray-300">
            <div class="text-center">
                <div class="text-3xl mb-4">‚ûï</div>
                <h3 id="needNewCalc" class="text-lg font-semibold mb-2">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà?</h3>
                <p id="newCalcDesc" class="text-gray-600 mb-4">
                    ‡πÄ‡∏£‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                </p>
                <a href="about.html" id="requestCalcBtn" class="inline-block px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    ‡∏Ç‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç
                </a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-100 border-t border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center">
                <p id="footerText" class="text-gray-600">
                    ¬© 2024 4Calc ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ñ‡∏π‡πà‡πÉ‡∏à‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
                </p>
            </div>
        </div>
    </footer>

    <!-- Calculator Modal -->
    <div id="calculatorModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg max-w-4xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="modalTitle" class="text-2xl font-bold"></h2>
                    <button onclick="closeCalculator()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                </div>
                <div id="modalContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Import MRT Station Data - Updated 2024
        const MRT_LINES = {
          blue: {
            id: 'blue',
            nameTH: '‡∏™‡∏≤‡∏¢‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô',
            nameEN: 'Blue Line (Chaloem Ratchamongkhon)',
            color: '#0066CC',
            totalStations: 38,
            operational: true,
            stations: [
              { id: 'THA', nameTH: '‡∏ó‡πà‡∏≤‡∏û‡∏£‡∏∞', nameEN: 'Tha Phra', code: 'BL01' },
              { id: 'CHA1', nameTH: '‡∏à‡∏£‡∏±‡∏•‡∏™‡∏ô‡∏¥‡∏ó‡∏ß‡∏á‡∏®‡πå 13', nameEN: 'Charan Sanit Wong 13', code: 'BL02' },
              { id: 'FAR', nameTH: '‡∏ü‡∏≤‡∏£‡πå‡∏±‡∏ô ‡∏û‡∏á‡∏©‡πå', nameEN: 'Faran Phong', code: 'BL03' },
              { id: 'KHB', nameTH: '‡∏Ñ‡∏•‡∏≠‡∏á‡∏ö‡∏≤‡∏á‡πÑ‡∏ú‡πà', nameEN: 'Khlong Bang Phai', code: 'BL04' },
              { id: 'BAN7', nameTH: '‡∏ö‡∏≤‡∏á‡∏¢‡∏µ‡πà‡∏Ç‡∏±‡∏ô', nameEN: 'Bang Yi Khan', code: 'BL05' },
              { id: 'SIR', nameTH: '‡∏®‡∏¥‡∏£‡∏¥‡∏£‡∏≤‡∏ä', nameEN: 'Siriraj', code: 'BL06' },
              { id: 'THO1', nameTH: '‡∏ò‡∏ô‡∏ö‡∏∏‡∏£‡∏µ', nameEN: 'Thonburi', code: 'BL07' },
              { id: 'ISA1', nameTH: '‡∏≠‡∏¥‡∏™‡∏£‡∏†‡∏≤‡∏û', nameEN: 'Itsaraphap', code: 'BL08' },
              { id: 'SAN1', nameTH: '‡∏™‡∏ô‡∏≤‡∏°‡πÑ‡∏ä‡∏¢', nameEN: 'Sanam Chai', code: 'BL09' },
              { id: 'SAY1', nameTH: '‡∏™‡∏≤‡∏°‡∏¢‡∏≠‡∏î', nameEN: 'Sam Yot', code: 'BL10' },
              { id: 'WAT1', nameTH: '‡∏ß‡∏±‡∏î‡∏°‡∏±‡∏á‡∏Å‡∏£', nameEN: 'Wat Mangkon', code: 'BL11' },
              { id: 'HUL1', nameTH: '‡∏´‡∏±‡∏ß‡∏•‡∏≥‡πÇ‡∏û‡∏á', nameEN: 'Hua Lamphong', code: 'BL12' },
              { id: 'SAM1', nameTH: '‡∏™‡∏≤‡∏°‡∏¢‡πà‡∏≤‡∏ô', nameEN: 'Sam Yan', code: 'BL13' },
              { id: 'SIL1', nameTH: '‡∏™‡∏µ‡∏•‡∏°', nameEN: 'Silom', code: 'BL14' },
              { id: 'LUM1', nameTH: '‡∏•‡∏∏‡∏°‡∏û‡∏¥‡∏ô‡∏µ', nameEN: 'Lumphini', code: 'BL15' },
              { id: 'KLO1', nameTH: '‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢', nameEN: 'Khlong Toei', code: 'BL16' },
              { id: 'QSI1', nameTH: '‡∏Ñ‡∏ß‡∏µ‡∏ô‡∏™‡∏¥‡∏£‡∏¥‡∏Å‡∏¥‡∏ï‡∏¥‡πå', nameEN: 'Queen Sirikit', code: 'BL17' },
              { id: 'SUK1', nameTH: '‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó', nameEN: 'Sukhumvit', code: 'BL18' },
              { id: 'PET1', nameTH: '‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ', nameEN: 'Phetchaburi', code: 'BL19' },
              { id: 'PRA1', nameTH: '‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏° 9', nameEN: 'Phra Ram 9', code: 'BL20' },
              { id: 'CUL1', nameTH: '‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°', nameEN: 'Thailand Cultural Centre', code: 'BL21' },
              { id: 'HUA1', nameTH: '‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á', nameEN: 'Huai Khwang', code: 'BL22' },
              { id: 'SUT1', nameTH: '‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏™‡∏≤‡∏£', nameEN: 'Sutthisan', code: 'BL23' },
              { id: 'RAT1', nameTH: '‡∏£‡∏±‡∏ä‡∏î‡∏≤‡∏†‡∏¥‡πÄ‡∏©‡∏Å', nameEN: 'Ratchadaphisek', code: 'BL24' },
              { id: 'LAD1', nameTH: '‡∏•‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≤‡∏ß', nameEN: 'Lat Phrao', code: 'BL25' },
              { id: 'PAH1', nameTH: '‡∏û‡∏´‡∏•‡πÇ‡∏¢‡∏ò‡∏¥‡∏ô', nameEN: 'Phahon Yothin', code: 'BL26' },
              { id: 'CHA2', nameTH: '‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£', nameEN: 'Chatuchak Park', code: 'BL27' },
              { id: 'KAM1', nameTH: '‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£', nameEN: 'Kamphaeng Phet', code: 'BL28' },
              { id: 'BAN1', nameTH: '‡∏ö‡∏≤‡∏á‡∏ã‡∏∑‡πà‡∏≠', nameEN: 'Bang Sue', code: 'BL29' },
              { id: 'LAT1', nameTH: '‡∏•‡∏≤‡∏î‡∏¢‡∏≤‡∏ß', nameEN: 'Lat Yao', code: 'BL30' },
              { id: 'BKM1', nameTH: '‡∏ö‡∏≤‡∏á‡πÅ‡∏Ñ', nameEN: 'Bang Khae', code: 'BL31' },
              { id: 'PET2', nameTH: '‡πÄ‡∏û‡∏ä‡∏£‡πÄ‡∏Å‡∏©‡∏° 48', nameEN: 'Phetkasem 48', code: 'BL32' },
              { id: 'BAW1', nameTH: '‡∏ö‡∏≤‡∏á‡∏´‡∏ß‡πâ‡∏≤', nameEN: 'Bang Wa', code: 'BL33' },
              { id: 'BNG1', nameTH: '‡∏ö‡∏≤‡∏á‡πÑ‡∏ú‡πà', nameEN: 'Bang Phai', code: 'BL34' },
              { id: 'WUT1', nameTH: '‡∏ß‡∏∏‡∏í‡∏≤‡∏Å‡∏≤‡∏®', nameEN: 'Wutthakat', code: 'BL35' },
              { id: 'TAL1', nameTH: '‡∏ï‡∏•‡∏≤‡∏î‡∏û‡∏•‡∏π', nameEN: 'Talad Phlu', code: 'BL36' },
              { id: 'PHO1', nameTH: '‡πÇ‡∏û‡∏ò‡∏¥‡πå‡∏ô‡∏¥‡∏°‡∏¥‡∏ï‡∏£', nameEN: 'Pho Nimit', code: 'BL37' },
              { id: 'LAK1', nameTH: '‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≠‡∏á', nameEN: 'Lak Song', code: 'BL38' }
            ]
          },
          purple: {
            id: 'purple',
            nameTH: '‡∏™‡∏≤‡∏¢‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á',
            nameEN: 'Purple Line (Chaloem Ratchadham)',
            color: '#663399',
            totalStations: 16,
            operational: true,
            stations: [
              { id: 'KLO2', nameTH: '‡∏Ñ‡∏•‡∏≠‡∏á‡∏ö‡∏≤‡∏á‡πÑ‡∏ú‡πà', nameEN: 'Khlong Bang Phai', code: 'PP01' },
              { id: 'TAL2', nameTH: '‡∏ï‡∏•‡∏≤‡∏î‡∏ö‡∏≤‡∏á‡πÉ‡∏´‡∏ç‡πà', nameEN: 'Talad Bang Yai', code: 'PP02' },
              { id: 'SAM2', nameTH: '‡∏™‡∏≤‡∏°‡πÅ‡∏¢‡∏Å‡∏ö‡∏≤‡∏á‡πÉ‡∏´‡∏ç‡πà', nameEN: 'Sam Yaek Bang Yai', code: 'PP03' },
              { id: 'BAN2', nameTH: '‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏π', nameEN: 'Bang Phlu', code: 'PP04' },
              { id: 'BAN3', nameTH: '‡∏ö‡∏≤‡∏á‡∏£‡∏±‡∏Å‡πÉ‡∏´‡∏ç‡πà', nameEN: 'Bang Rak Yai', code: 'PP05' },
              { id: 'BAN4', nameTH: '‡∏ö‡∏≤‡∏á‡∏£‡∏±‡∏Å‡∏ô‡πâ‡∏≠‡∏¢-‡∏ó‡πà‡∏≤‡∏≠‡∏¥‡∏ê', nameEN: 'Bang Rak Noi Tha It', code: 'PP06' },
              { id: 'SAI', nameTH: '‡πÑ‡∏ó‡∏£‡∏°‡πâ‡∏≤', nameEN: 'Sai Ma', code: 'PP07' },
              { id: 'PLI', nameTH: '‡∏û‡∏•‡∏µ‡πÄ‡∏û‡∏•‡∏¥‡∏ô', nameEN: 'Pli Ploen', code: 'PP08' },
              { id: 'MAN', nameTH: '‡∏°‡∏±‡∏¢‡∏•‡∏≤‡∏†', nameEN: 'Mai Lap', code: 'PP09' },
              { id: 'NON', nameTH: '‡∏´‡∏ô‡∏≠‡∏á‡∏õ‡∏£‡∏∑‡∏≠', nameEN: 'Nong Prue', code: 'PP10' },
              { id: 'YAE', nameTH: '‡πÅ‡∏¢‡∏Å‡∏ï‡∏¥‡∏ß‡∏≤‡∏ô‡∏ô‡∏ó‡πå', nameEN: 'Yaek Tiwanon', code: 'PP11' },
              { id: 'TIW', nameTH: '‡∏ï‡∏¥‡∏ß‡∏≤‡∏ô‡∏ô‡∏ó‡πå', nameEN: 'Tiwanon', code: 'PP12' },
              { id: 'THA2', nameTH: '‡∏ó‡πà‡∏≤‡∏≠‡∏¥‡∏ê', nameEN: 'Tha It', code: 'PP13' },
              { id: 'PAK', nameTH: '‡∏õ‡∏≤‡∏Å‡πÄ‡∏Å‡∏£‡πá‡∏î', nameEN: 'Pak Kret', code: 'PP14' },
              { id: 'KHA', nameTH: '‡πÅ‡∏Ç‡∏ß‡∏á‡πÄ‡∏ß‡∏µ‡∏¢‡∏á‡∏û‡∏≤', nameEN: 'Khaeng Wiang Pha', code: 'PP15' },
              { id: 'TAO', nameTH: '‡πÄ‡∏ï‡∏≤‡∏õ‡∏π‡∏ô', nameEN: 'Tao Poon', code: 'PP16' }
            ]
          },
          
          yellow: {
            id: 'yellow',
            nameTH: '‡∏™‡∏≤‡∏¢‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á',
            nameEN: 'Yellow Line (Nakhon Phiphat)',
            color: '#FFD700',
            totalStations: 23,
            operational: true,
            stations: [
              { id: 'LAD2', nameTH: '‡∏•‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≤‡∏ß', nameEN: 'Lat Phrao', code: 'YL01' },
              { id: 'PHW', nameTH: '‡∏û‡∏´‡∏•‡πÇ‡∏¢‡∏ò‡∏¥‡∏ô 24', nameEN: 'Phahon Yothin 24', code: 'YL02' },
              { id: 'CHO', nameTH: '‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏±‡∏¢ 4', nameEN: 'Chok Chai 4', code: 'YL03' },
              { id: 'LAD3', nameTH: '‡∏•‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≤‡∏ß 71', nameEN: 'Lat Phrao 71', code: 'YL04' },
              { id: 'LAD4', nameTH: '‡∏•‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≤‡∏ß 83', nameEN: 'Lat Phrao 83', code: 'YL05' },
              { id: 'MAL', nameTH: '‡∏°‡∏≤‡∏•‡∏±‡∏¢‡πÅ‡∏°‡∏ô', nameEN: 'Malai Man', code: 'YL06' },
              { id: 'RAM', nameTH: '‡∏£‡∏≤‡∏°‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏≤ 4 ‡∏Å‡∏°.', nameEN: 'Ram Inthra Km.4', code: 'YL07' },
              { id: 'LAD5', nameTH: '‡∏•‡∏≤‡∏î‡∏õ‡∏•‡∏≤‡πÄ‡∏Ñ‡πâ‡∏≤', nameEN: 'Lat Plakhao', code: 'YL08' },
              { id: 'RAM2', nameTH: '‡∏£‡∏≤‡∏°‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏≤ 6 ‡∏Å‡∏°.', nameEN: 'Ram Inthra Km.6', code: 'YL09' },
              { id: 'KRU2', nameTH: '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Å‡∏£‡∏µ‡∏ë‡∏≤', nameEN: 'Krungthep Kreetha', code: 'YL10' },
              { id: 'HUA2', nameTH: '‡∏´‡∏±‡∏ß‡∏´‡∏°‡∏≤‡∏Å', nameEN: 'Hua Mak', code: 'YL11' },
              { id: 'RAM3', nameTH: '‡∏£‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏´‡∏á', nameEN: 'Ram Khamhaeng', code: 'YL12' },
              { id: 'RAJ', nameTH: '‡∏£‡∏≤‡∏ä‡∏°‡∏±‡∏á‡∏Ñ‡∏•‡∏≤‡∏Å‡∏µ‡∏¨‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô', nameEN: 'Rajamangala Stadium', code: 'YL13' },
              { id: 'SRI', nameTH: '‡∏®‡∏£‡∏µ‡∏ô‡∏ß‡∏•', nameEN: 'Si Nuan', code: 'YL14' },
              { id: 'HUA3', nameTH: '‡∏´‡∏±‡∏ß‡∏ï‡∏∞‡πÄ‡∏Ç‡πâ', nameEN: 'Hua Takhe', code: 'YL15' },
              { id: 'BAN8', nameTH: '‡∏ö‡∏≤‡∏á‡∏≠‡πâ‡∏≠', nameEN: 'Bang O', code: 'YL16' },
              { id: 'SAM4', nameTH: '‡∏™‡∏≥‡πÇ‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á', nameEN: 'Samrong Klang', code: 'YL17' },
              { id: 'SAM5', nameTH: '‡∏™‡∏≥‡πÇ‡∏£‡∏á', nameEN: 'Samrong', code: 'YL18' },
              { id: 'SAM6', nameTH: '‡∏™‡∏≥‡πÇ‡∏£‡∏á ‡∏Å‡∏°.3', nameEN: 'Samrong Km.3', code: 'YL19' },
              { id: 'SAM7', nameTH: '‡∏™‡∏≥‡πÇ‡∏£‡∏á ‡∏Å‡∏°.6', nameEN: 'Samrong Km.6', code: 'YL20' },
              { id: 'SAM8', nameTH: '‡∏™‡∏≥‡πÇ‡∏£‡∏á ‡∏Å‡∏°.9', nameEN: 'Samrong Km.9', code: 'YL21' },
              { id: 'SAM9', nameTH: '‡∏™‡∏≥‡πÇ‡∏£‡∏á ‡∏Å‡∏°.12', nameEN: 'Samrong Km.12', code: 'YL22' },
              { id: 'KEH', nameTH: '‡πÄ‡∏Ñ‡∏´‡∏∞', nameEN: 'Kheha', code: 'YL23' }
            ]
          },
          
          pink: {
            id: 'pink',
            nameTH: '‡∏™‡∏≤‡∏¢‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π',
            nameEN: 'Pink Line',
            color: '#FF1493',
            totalStations: 32,
            operational: true,
            stations: [
              { id: 'KHR', nameTH: '‡πÅ‡∏Ñ‡∏£‡∏≤‡∏¢', nameEN: 'Khae Rai', code: 'PK01' },
              { id: 'MUT', nameTH: '‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡∏≠‡∏á‡∏ò‡∏≤‡∏ô‡∏µ', nameEN: 'Muang Thong Thani', code: 'PK02' },
              { id: 'IMP', nameTH: '‡∏≠‡∏¥‡∏°‡πÅ‡∏û‡πá‡∏Ñ ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡∏≠‡∏á‡∏ò‡∏≤‡∏ô‡∏µ', nameEN: 'IMPACT Muang Thong Thani', code: 'PK03' },
              { id: 'COS', nameTH: '‡∏Ñ‡∏≠‡∏™‡πÇ‡∏°‡∏ö‡∏≤‡∏ã‡∏≤‡∏£‡πå', nameEN: 'Cosmo Bazaar', code: 'PK04' },
              { id: 'GOV', nameTH: '‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ', nameEN: 'Government Complex', code: 'PK05' },
              { id: 'MIN', nameTH: '‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç', nameEN: 'Ministry of Public Health', code: 'PK06' },
              { id: 'YAE2', nameTH: '‡πÅ‡∏¢‡∏Å‡∏ï‡∏¥‡∏ß‡∏≤‡∏ô‡∏ô‡∏ó‡πå', nameEN: 'Yaek Tiwanon', code: 'PK07' },
              { id: 'SAM10', nameTH: '‡∏™‡∏≤‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏µ', nameEN: 'Samakkhi', code: 'PK08' },
              { id: 'ROY', nameTH: '‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ñ‡∏µ', nameEN: 'Rajavithi Hospital', code: 'PK09' },
              { id: 'RAN2', nameTH: '‡∏£‡∏≤‡∏á‡∏ô‡πâ‡∏≥', nameEN: 'Rang Nam', code: 'PK10' },
              { id: 'PRA2', nameTH: '‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ô‡πâ‡∏≥', nameEN: 'Pratunam', code: 'PK11' },
              { id: 'RAT2', nameTH: '‡∏£‡∏≤‡∏ä‡∏õ‡∏£‡∏≤‡∏£‡∏†', nameEN: 'Ratchaprarop', code: 'PK12' },
              { id: 'MAK', nameTH: '‡∏°‡∏±‡∏Å‡∏Å‡∏∞‡∏™‡∏±‡∏ô', nameEN: 'Makkasan', code: 'PK13' },
              { id: 'RAM4', nameTH: '‡∏£‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏´‡∏á 12', nameEN: 'Ram Khamhaeng 12', code: 'PK14' },
              { id: 'LAM', nameTH: '‡∏•‡∏≤‡∏î‡∏°‡∏∞‡∏¢‡∏°', nameEN: 'Lad Mayom', code: 'PK15' },
              { id: 'RAM5', nameTH: '‡∏£‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏´‡∏á 34', nameEN: 'Ram Khamhaeng 34', code: 'PK16' },
              { id: 'WAT3', nameTH: '‡∏ß‡∏±‡∏î‡πÄ‡∏ó‡∏û‡∏•‡∏µ‡∏•‡∏≤', nameEN: 'Wat Thep Lila', code: 'PK17' },
              { id: 'KLO3', nameTH: '‡∏Ñ‡∏•‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡πâ‡∏≤', nameEN: 'Khlong Ban Ma', code: 'PK18' },
              { id: 'HIP', nameTH: '‡∏Æ‡∏¥‡∏õ‡πÇ‡∏õ‡πÇ‡∏î‡∏£‡∏°', nameEN: 'Hippodrome', code: 'PK19' },
              { id: 'CHO2', nameTH: '‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏ô‡∏ó‡∏£‡∏µ', nameEN: 'Chong Nonsi', code: 'PK20' },
              { id: 'KLO4', nameTH: '‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢', nameEN: 'Khlong Toei', code: 'PK21' },
              { id: 'WAT4', nameTH: '‡∏ß‡∏±‡∏î‡∏ó‡∏∞‡πÄ‡∏•‡∏ó‡∏≠‡∏á', nameEN: 'Wat Tha Le Thong', code: 'PK22' },
              { id: 'MIN2', nameTH: '‡∏°‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ', nameEN: 'Min Buri', code: 'PK23' },
              { id: 'MIN3', nameTH: '‡∏°‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ ‡∏Å‡∏°.7', nameEN: 'Min Buri Km.7', code: 'PK24' },
              { id: 'MIN4', nameTH: '‡∏°‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ ‡∏Å‡∏°.8', nameEN: 'Min Buri Km.8', code: 'PK25' },
              { id: 'LAT6', nameTH: '‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á', nameEN: 'Lat Krabang', code: 'PK26' },
              { id: 'LAT7', nameTH: '‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á ‡∏Å‡∏°.2', nameEN: 'Lat Krabang Km.2', code: 'PK27' },
              { id: 'LAT8', nameTH: '‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á ‡∏Å‡∏°.4.5', nameEN: 'Lat Krabang Km.4.5', code: 'PK28' },
              { id: 'LAT9', nameTH: '‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á ‡∏Å‡∏°.7.5', nameEN: 'Lat Krabang Km.7.5', code: 'PK29' },
              { id: 'LAT10', nameTH: '‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á ‡∏Å‡∏°.10', nameEN: 'Lat Krabang Km.10', code: 'PK30' },
              { id: 'LAT11', nameTH: '‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á ‡∏Å‡∏°.12', nameEN: 'Lat Krabang Km.12', code: 'PK31' },
              { id: 'MIN5', nameTH: '‡∏°‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ ‡∏Å‡∏°.14', nameEN: 'Min Buri Km.14', code: 'PK32' }
            ]
          }
        };

        const INTERCHANGE_STATIONS = [
          { station: '‡∏•‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≤‡∏ß', lines: ['blue', 'yellow'], codes: ['BL25', 'YL01'] },
          { station: '‡πÄ‡∏ï‡∏≤‡∏õ‡∏π‡∏ô', lines: ['purple'], codes: ['PP16'] },
          { station: '‡πÅ‡∏¢‡∏Å‡∏ï‡∏¥‡∏ß‡∏≤‡∏ô‡∏ô‡∏ó‡πå', lines: ['purple', 'pink'], codes: ['PP11', 'PK07'] }
        ];

        const TRAVEL_INFO = {
          averageTimePerStation: 2,
          averageWaitTime: 3,
          baseFare: 16,
          farePerStation: 2,
          maxFare: 42
        };

        function calculateDistance(fromStationId, toStationId, lineId) {
          const line = MRT_LINES[lineId];
          if (!line || !line.stations) return null;
          
          const fromIndex = line.stations.findIndex(station => station.id === fromStationId);
          const toIndex = line.stations.findIndex(station => station.id === toStationId);
          
          if (fromIndex === -1 || toIndex === -1) return null;
          
          return Math.abs(toIndex - fromIndex);
        }
        
        function getRouteStations(fromStationId, toStationId, lineId) {
          const line = MRT_LINES[lineId];
          if (!line || !line.stations) return [];
          
          const fromIndex = line.stations.findIndex(s => s.id === fromStationId);
          const toIndex = line.stations.findIndex(s => s.id === toStationId);
          
          if (fromIndex === -1 || toIndex === -1) return [];
          
          const start = Math.min(fromIndex, toIndex);
          const end = Math.max(fromIndex, toIndex);
          
          const routeStations = line.stations.slice(start, end + 1);
          
          // ‡∏´‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏•‡∏≥‡∏î‡∏±‡∏ö
          if (fromIndex > toIndex) {
            routeStations.reverse();
          }
          
          return routeStations;
        }

        function calculateFare(distance) {
          if (distance === 0) return 0;
          
          const fare = TRAVEL_INFO.baseFare + (distance * TRAVEL_INFO.farePerStation);
          return Math.min(fare, TRAVEL_INFO.maxFare);
        }

        function calculateTravelTime(distance, isPeakHour = false) {
          if (distance === 0) return 0;
          
          const travelTime = (distance * TRAVEL_INFO.averageTimePerStation) + TRAVEL_INFO.averageWaitTime;
          const peakMultiplier = isPeakHour ? 1.3 : 1;
          
          return Math.round(travelTime * peakMultiplier);
        }

        let currentLanguage = localStorage.getItem('language') || 'th'; 
        let selectedCategory = null; 
        
        const translations = { 
          th: { 
            siteSubtitle: '‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô', 
            welcomeText: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà', 
            welcomeDescription: '‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì', 
            searchPlaceholder: '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç...', 
            navHome: '‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å', 
            navCategories: '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', 
            navAbout: '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤', 
            allCategories: '‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', 
            transportation: '‡∏Ñ‡∏°‡∏ô‡∏≤‡∏Ñ‡∏°', 
            health: '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û', 
            finance: '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô', 
            utilities: '‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏π‡∏õ‡πÇ‡∏†‡∏Ñ', 
            geography: '‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', 
            needNewCalc: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà?', 
            newCalcDesc: '‡πÄ‡∏£‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 
            requestCalcBtn: '‡∏Ç‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç', 
            footerText: '¬© 2024 4Calc ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ñ‡∏π‡πà‡πÉ‡∏à‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì', 
            noResultsTitle: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç', 
            noResultsDesc: '‡∏•‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏≠‡∏∑‡πà‡∏ô' 
          }, 
          en: { 
            siteSubtitle: 'All-in-One Calculator Hub', 
            welcomeText: 'Welcome to', 
            welcomeDescription: 'Your comprehensive calculator hub for all your daily calculations', 
            searchPlaceholder: 'Search calculators...', 
            navHome: 'Home', 
            navCategories: 'Categories', 
            navAbout: 'About', 
            allCategories: 'All Categories', 
            transportation: 'Transportation', 
            health: 'Health', 
            finance: 'Finance', 
            utilities: 'Utilities', 
            geography: 'Geography', 
            needNewCalc: 'Need a New Calculator?', 
            newCalcDesc: "We're constantly adding new calculators based on user needs", 
            requestCalcBtn: 'Request Calculator', 
            footerText: '¬© 2024 4Calc. All rights reserved. Your trusted calculator companion', 
            noResultsTitle: 'No calculators found', 
            noResultsDesc: 'Try adjusting your search or selecting a different category' 
          } 
        }; const calculators = { th: [ { id: 'mrt-time', name: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á MRT', description: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ MRT', emoji: 'üöá', category: 'transportation' }, { id: 'taxi-fare', name: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà', description: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤', emoji: 'üöï', category: 'transportation' }, { id: 'pregnancy', name: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå', description: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏•‡∏≠‡∏î‡πÅ‡∏•‡∏∞ milestone ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç', emoji: 'ü§±', category: 'health' }, { id: 'interest', name: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢', description: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ó‡∏ö‡∏ï‡πâ‡∏ô', emoji: 'üí∞', category: 'finance' }, { id: 'solar', name: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå‡πÄ‡∏ã‡∏•‡∏•‡πå', description: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå', emoji: '‚òÄÔ∏è', category: 'utilities' }, { id: 'electrical', name: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏≤‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤', description: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡πÑ‡∏ü ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å', emoji: '‚ö°', category: 'utilities' }, { id: 'btu', name: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì BTU', description: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ BTU ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®', emoji: '‚ùÑÔ∏è', category: 'utilities' }, { id: 'distance', name: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á', description: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≠‡∏á‡∏à‡∏∏‡∏î', emoji: 'üìç', category: 'geography' } ], en: [ { id: 'mrt-time', name: 'MRT Time Calculator', description: 'Calculate travel time between MRT stations', emoji: 'üöá', category: 'transportation' }, { id: 'taxi-fare', name: 'Taxi Fare Calculator', description: 'Calculate taxi fare based on distance and time', emoji: 'üöï', category: 'transportation' }, { id: 'pregnancy', name: 'Pregnancy Calculator', description: 'Calculate due date and pregnancy milestones', emoji: 'ü§±', category: 'health' }, { id: 'interest', name: 'Interest Calculator', description: 'Calculate simple and compound interest', emoji: 'üí∞', category: 'finance' }, { id: 'solar', name: 'Solar Rooftop Calculator', description: 'Calculate ROI and savings for solar panel systems', emoji: '‚òÄÔ∏è', category: 'utilities' }, { id: 'electrical', name: 'Electrical Calculator', description: 'Calculate wire size, distance, and voltage drop', emoji: '‚ö°', category: 'utilities' }, { id: 'btu', name: 'BTU Calculator', description: 'Calculate BTU requirements for air conditioning', emoji: '‚ùÑÔ∏è', category: 'utilities' }, { id: 'distance', name: 'Distance Calculator', description: 'Calculate distance between two points', emoji: 'üìç', category: 'geography' } ] }; document.addEventListener('DOMContentLoaded', function() { updateLanguage(); renderCalculators(); setupEventListeners(); }); function setupEventListeners() { document.getElementById('langButton').addEventListener('click', function() { const dropdown = document.getElementById('langDropdown'); dropdown.classList.toggle('show'); }); document.addEventListener('click', function(event) { if (!event.target.closest('.lang-btn')) { document.getElementById('langDropdown').classList.remove('show'); } }); document.getElementById('searchInput').addEventListener('input', function(e) { renderCalculators(e.target.value); }); document.querySelectorAll('.category-btn').forEach(btn => { btn.addEventListener('click', function() { const category = this.dataset.category; document.querySelectorAll('.category-btn').forEach(b => { b.className = 'category-btn px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors'; }); this.className = 'category-btn px-4 py-2 bg-blue-600 text-white border border-blue-600 rounded-lg hover:bg-blue-700 transition-colors'; selectedCategory = category === 'all' ? null : category; renderCalculators(); }); }); } function switchLanguage(lang) { currentLanguage = lang; localStorage.setItem('language', lang); const flagMap = { th: 'üáπüá≠', en: 'üá∫üá∏' }; const nameMap = { th: '‡πÑ‡∏ó‡∏¢', en: 'English' }; document.getElementById('currentFlag').textContent = flagMap[lang]; document.getElementById('currentLang').textContent = nameMap[lang]; document.getElementById('langDropdown').classList.remove('show'); updateLanguage(); renderCalculators(); } function updateLanguage() { const t = translations[currentLanguage]; document.getElementById('siteSubtitle').textContent = t.siteSubtitle; document.getElementById('welcomeText').textContent = t.welcomeText; document.getElementById('welcomeDescription').textContent = t.welcomeDescription; document.getElementById('searchInput').placeholder = t.searchPlaceholder; document.getElementById('nav-home').textContent = t.navHome; document.getElementById('nav-categories').textContent = t.navCategories; document.getElementById('nav-about').textContent = t.navAbout; document.getElementById('needNewCalc').textContent = t.needNewCalc; document.getElementById('newCalcDesc').textContent = t.newCalcDesc; document.getElementById('requestCalcBtn').textContent = t.requestCalcBtn; document.getElementById('footerText').textContent = t.footerText; const categoryTexts = [t.allCategories, t.transportation, t.health, t.finance, t.utilities, t.geography]; document.querySelectorAll('.category-btn span:last-child').forEach((span, index) => { span.textContent = categoryTexts[index]; }); } function renderCalculators(searchTerm = '') { const grid = document.getElementById('calculatorGrid'); const noResults = document.getElementById('noResults'); const currentCalculators = calculators[currentLanguage]; let filtered = currentCalculators.filter(calc => { const matchesSearch = calc.name.toLowerCase().includes(searchTerm.toLowerCase()) || calc.description.toLowerCase().includes(searchTerm.toLowerCase()); const matchesCategory = !selectedCategory || calc.category === selectedCategory; return matchesSearch && matchesCategory; }); if (filtered.length === 0) { grid.classList.add('hidden'); noResults.classList.remove('hidden'); return; } grid.classList.remove('hidden'); noResults.classList.add('hidden'); grid.innerHTML = filtered.map(calc => ` <div class="calculator-card bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer" onclick="showCalculator('${calc.id}')"> <div class="text-3xl mb-4">${calc.emoji}</div> <h3 class="text-lg font-semibold mb-2">${calc.name}</h3> <p class="text-gray-600 mb-3">${calc.description}</p> <span class="text-sm text-blue-600 font-medium"> ${translations[currentLanguage][calc.category]} </span> </div> `).join(''); } function showCalculator(type) { const modal = document.getElementById('calculatorModal'); const title = document.getElementById('modalTitle'); const content = document.getElementById('modalContent'); modal.classList.remove('hidden'); modal.classList.add('flex'); if (type === 'mrt-time') { title.textContent = currentLanguage === 'th' ? 'üöá ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á MRT' : 'üöá MRT Time Calculator'; content.innerHTML = getMRTCalculatorHTML(); } else { title.textContent = currentLanguage === 'th' ? '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤!' : 'Calculator Coming Soon!'; content.innerHTML = `<p class="text-center py-8 text-gray-500">${currentLanguage === 'th' ? '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á!' : 'This calculator is under development. Please check back later!'}</p>`; } } function closeCalculator() { const modal = document.getElementById('calculatorModal'); modal.classList.add('hidden'); modal.classList.remove('flex'); } function getMRTCalculatorHTML() {
          const isEnglish = currentLanguage === 'en';
          
          // Generate station options from comprehensive data
          let stationOptions = '';
          Object.keys(MRT_LINES).forEach(lineKey => {
            const line = MRT_LINES[lineKey];
            if (line.stations) {
              stationOptions += `<optgroup label="${isEnglish ? line.nameEN : line.nameTH}">`;
              line.stations.forEach(station => {
                const stationName = isEnglish ? station.nameEN : station.nameTH;
                stationOptions += `<option value="${station.id}" data-line="${lineKey}">${station.code} - ${stationName}</option>`;
              });
              stationOptions += '</optgroup>';
            }
          });
          
          return `
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold mb-4">${isEnglish ? 'Trip Details' : '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á'}</h3>
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium mb-2">${isEnglish ? 'From Station' : '‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ'}</label>
                    <select id="fromStation" class="w-full px-3 py-2 border rounded-lg">
                      <option value="">${isEnglish ? 'Select departure station' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á'}</option>
                      ${stationOptions}
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-2">${isEnglish ? 'To Station' : '‡πÑ‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ'}</label>
                    <select id="toStation" class="w-full px-3 py-2 border rounded-lg">
                      <option value="">${isEnglish ? 'Select destination station' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á'}</option>
                      ${stationOptions}
                    </select>
                  </div>
                  <div>
                    <label class="flex items-center">
                      <input type="checkbox" id="isPeakHour" class="mr-2">
                      <span class="text-sm">${isEnglish ? 'Peak hours (Rush hour)' : '‡∏ä‡πà‡∏ß‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô'}</span>
                    </label>
                  </div>
                  <button onclick="calculateMRT()" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    ${isEnglish ? 'Calculate' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}
                  </button>
                </div>
              </div>
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold mb-4">${isEnglish ? 'Results' : '‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå'}</h3>
                <div id="mrtResults" class="text-center py-8 text-gray-500">
                  ${isEnglish ? 'Select stations and click calculate' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}
                </div>
              </div>
            </div>
          `;
        }

        // Global variables to store current route data
        let currentRouteData = null;
        
        function toggleRouteDetails() {
          // ‡∏´‡∏≤ elements ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ innerHTML ‡∏≠‡∏≤‡∏à‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
          const routeContainer = document.getElementById('routeDetails');
          const toggleIcon = document.getElementById('routeToggleIcon');
          const isEnglish = currentLanguage === 'en';
          
          if (!routeContainer) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            return;
          }
          
          if (!currentRouteData) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô');
            return;
          }
          
          // Check if route is currently expanded
          const isExpanded = routeContainer.style.maxHeight !== '0px' && routeContainer.style.maxHeight !== '';
          
          if (!isExpanded) {
            // Expand route details
            const { fromStationId, toStationId, lineId } = currentRouteData;
            const routeStations = getRouteStations(fromStationId, toStationId, lineId);
            
            if (routeStations.length === 0) {
              const innerDiv = routeContainer.querySelector('div');
              if (innerDiv) {
                innerDiv.innerHTML = `<p class="text-red-500">${isEnglish ? 'Unable to calculate route' : '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏î‡πâ'}</p>`;
              }
              return;
            }
              
              let routeHTML = `
                <div class="bg-white p-4 rounded border">
                  <h4 class="font-semibold mb-3 text-gray-800">${isEnglish ? 'Route Details' : '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á'}</h4>
                  <div class="space-y-2">
              `;
              
              routeStations.forEach((station, index) => {
                const stationName = isEnglish ? station.nameEN : station.nameTH;
                const lineInfo = MRT_LINES[lineId];
                const lineColor = lineInfo.color;
                
                let timeInfo = '';
                if (index > 0) {
                  const timeFromPrevious = 2; // 2 minutes per station
                  timeInfo = `<span class="text-sm text-gray-500 ml-2">(+${timeFromPrevious} ${isEnglish ? 'min' : '‡∏ô‡∏≤‡∏ó‡∏µ'})</span>`;
                } else {
                  timeInfo = `<span class="text-sm text-gray-500 ml-2">(${isEnglish ? 'Start' : '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô'})</span>`;
                }
                
                const isStart = index === 0;
                const isEnd = index === routeStations.length - 1;
                
                routeHTML += `
                  <div class="flex items-center py-2 ${isStart ? 'bg-green-50' : isEnd ? 'bg-red-50' : 'bg-blue-50'} rounded px-3">
                    <div class="w-3 h-3 rounded-full mr-3" style="background-color: ${lineColor}"></div>
                    <div class="flex-1">
                      <strong>${station.code}</strong> - ${stationName}
                      ${timeInfo}
                    </div>
                    ${isStart ? '<span class="text-green-600 text-sm font-medium">üöá ' + (isEnglish ? 'Start' : '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô') + '</span>' : ''}
                    ${isEnd ? '<span class="text-red-600 text-sm font-medium">üèÅ ' + (isEnglish ? 'End' : '‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á') + '</span>' : ''}
                  </div>
                `;
              });
              
              routeHTML += `
                  </div>
                  <div class="mt-3 p-2 bg-gray-100 rounded text-sm">
                    <strong>${isEnglish ? 'Total stations:' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏£‡∏ß‡∏°:'}</strong> ${routeStations.length}<br>
                    <strong>${isEnglish ? 'Estimated time:' : '‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì:'}</strong> ${(routeStations.length - 1) * 2 + 3} ${isEnglish ? 'minutes' : '‡∏ô‡∏≤‡∏ó‡∏µ'}
                  </div>
                </div>
              `;
              
              // Set content first
              const innerDiv = routeContainer.querySelector('div');
              if (innerDiv) {
                innerDiv.innerHTML = routeHTML;
              } else {
                return;
              }
              
              // Force reflow to calculate actual height
              routeContainer.style.maxHeight = 'none';
              const actualHeight = routeContainer.scrollHeight;
              routeContainer.style.maxHeight = '0px';
              
              // Trigger expansion with slight delay for smooth animation
              setTimeout(() => {
                routeContainer.style.maxHeight = actualHeight + 'px';
              }, 10);
              
              // Rotate icon
              if (toggleIcon) {
                toggleIcon.style.transform = 'rotate(180deg)';
              }
          } else {
            // Collapse route details
            routeContainer.style.maxHeight = '0px';
            
            // Rotate icon back
            if (toggleIcon) {
              toggleIcon.style.transform = 'rotate(0deg)';
            }
          }
        }

        function calculateMRT() {
          console.log('calculateMRT function called');
          const fromStationId = document.getElementById('fromStation').value;
          const toStationId = document.getElementById('toStation').value;
          const isPeakHour = document.getElementById('isPeakHour').checked;
          const results = document.getElementById('mrtResults');
          const isEnglish = currentLanguage === 'en';
          
          console.log('Input values:', { fromStationId, toStationId, isPeakHour, isEnglish });
          
          // Reset route details state
          currentRouteData = null;
          
          if (!fromStationId || !toStationId) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please select both stations' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á'}</p>`;
            return;
          }
          
          if (fromStationId === toStationId) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please select different stations' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô'}</p>`;
            return;
          }
          
          // Find stations and their lines
          let fromStation = null, toStation = null;
          let fromLine = null, toLine = null;
          
          Object.keys(MRT_LINES).forEach(lineKey => {
            const line = MRT_LINES[lineKey];
            if (line.stations) {
              const foundFrom = line.stations.find(s => s.id === fromStationId);
              const foundTo = line.stations.find(s => s.id === toStationId);
              
              if (foundFrom) {
                fromStation = foundFrom;
                fromLine = lineKey;
              }
              if (foundTo) {
                toStation = foundTo;
                toLine = lineKey;
              }
            }
          });
          
          if (!fromStation || !toStation) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Station not found' : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ'}</p>`;
            return;
          }
          
          // Calculate if same line or need transfer
          let distance = 0;
          let transferInfo = '';
          
          if (fromLine === toLine) {
            // Same line - direct calculation
            distance = calculateDistance(fromStationId, toStationId, fromLine);
            
            // Store route data for toggle function
            currentRouteData = {
              fromStationId: fromStationId,
              toStationId: toStationId,
              lineId: fromLine
            };
          } else {
            // Different lines - need transfer (simplified calculation)
            // For now, we'll calculate approximate distance via interchange stations
            distance = 8; // Estimated average for cross-line transfers
            transferInfo = isEnglish 
              ? `<div class="p-2 bg-yellow-100 rounded text-sm"><strong>Note:</strong> Transfer required between lines</div>`
              : `<div class="p-2 bg-yellow-100 rounded text-sm"><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢</div>`;
              
            // Store route data for toggle function (use primary line for now)
            currentRouteData = {
              fromStationId: fromStationId,
              toStationId: toStationId,
              lineId: fromLine
            };
          }
          
          const time = calculateTravelTime(distance, isPeakHour);
          const fare = calculateFare(distance);
          
          console.log('Calculated values:', { distance, time, fare });
          
          const fromName = isEnglish ? fromStation.nameEN : fromStation.nameTH;
          const toName = isEnglish ? toStation.nameEN : toStation.nameTH;
          const fromLineDisplay = isEnglish ? MRT_LINES[fromLine].nameEN : MRT_LINES[fromLine].nameTH;
          const toLineDisplay = isEnglish ? MRT_LINES[toLine].nameEN : MRT_LINES[toLine].nameTH;
          
          results.innerHTML = `
            <div class="space-y-3 text-left">
              <div class="p-3 bg-blue-50 rounded">
                <strong>${isEnglish ? 'From:' : '‡∏à‡∏≤‡∏Å:'}</strong> ${fromStation.code} - ${fromName}<br>
                <small class="text-gray-600">${fromLineDisplay}</small><br>
                <strong>${isEnglish ? 'To:' : '‡πÑ‡∏õ:'}</strong> ${toStation.code} - ${toName}<br>
                <small class="text-gray-600">${toLineDisplay}</small>
              </div>
              ${transferInfo}
              <div class="p-3 bg-green-50 rounded">
                <strong>${isEnglish ? 'Travel Time:' : '‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á:'}</strong> ${time} ${isEnglish ? 'minutes' : '‡∏ô‡∏≤‡∏ó‡∏µ'}
                ${isPeakHour ? `<br><small class="text-gray-600">${isEnglish ? '(Including peak hour delay)' : '(‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤‡∏ä‡πà‡∏ß‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô)'}</small>` : ''}
              </div>
              <div class="p-3 bg-yellow-50 rounded cursor-pointer hover:bg-yellow-100 transition-colors" onclick="toggleRouteDetails()">
                <div class="flex items-center justify-between">
                  <div>
                    <strong>${isEnglish ? 'Distance:' : '‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á:'}</strong> 
                    <span class="text-blue-600 hover:text-blue-800 underline">${distance} ${isEnglish ? 'stations' : '‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ'}</span>
                  </div>
                  <div class="flex items-center">
                    <span class="text-sm text-gray-500 mr-2">(${isEnglish ? 'Click to view route' : '‡∏Ñ‡∏•‡∏¥‡∏Å‡∏î‡∏π‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á'})</span>
                    <svg id="routeToggleIcon" class="w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </div>
                </div>
              </div>
              <div id="routeDetails" class="overflow-hidden transition-all duration-300 ease-in-out" style="max-height: 0;">
                <div class="p-3 bg-gray-50 rounded border mt-3">
                  <!-- Route details will be inserted here -->
                </div>
              </div>
              <div class="p-3 bg-purple-50 rounded">
                <strong>${isEnglish ? 'Fare:' : '‡∏Ñ‡πà‡∏≤‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£:'}</strong> ‡∏ø${fare}
              </div>
            </div>
          `;
          
          console.log('MRT calculation completed and results displayed');
        }

        // ======================
        // TAXI FARE CALCULATOR
        // ======================

        // Import taxi calculator functions (inline version)
        const TAXI_RATES = {
          regular: {
            name: '‡∏£‡∏ñ‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏Å‡∏ï‡∏¥',
            nameEN: 'Regular Size Taxi',
            baseFare: 35.00,
            rates: [
              { min: 1.01, max: 10, rate: 6.50 },
              { min: 10.01, max: 20, rate: 7.00 },
              { min: 20.01, max: 40, rate: 8.00 },
              { min: 40.01, max: 60, rate: 8.50 },
              { min: 60.01, max: 80, rate: 9.00 },
              { min: 80.01, max: Infinity, rate: 10.50 }
            ]
          },
          large: {
            name: '‡∏£‡∏ñ‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà',
            nameEN: 'Large Size Taxi',
            baseFare: 40.00,
            rates: [
              { min: 1.01, max: 10, rate: 6.50 },
              { min: 10.01, max: 20, rate: 7.00 },
              { min: 20.01, max: 40, rate: 8.00 },
              { min: 40.01, max: 60, rate: 8.50 },
              { min: 60.01, max: 80, rate: 9.00 },
              { min: 80.01, max: Infinity, rate: 10.50 }
            ]
          }
        };

        const WAITING_RATE = {
          ratePerMinute: 3.00,
          speedThreshold: 6
        };

        const ADDITIONAL_CHARGES = {
          appBooking: 20,
          airportSurcharge: 50
        };

        function calculateDistanceFare(distance, taxiType = 'regular') {
          if (distance <= 0) return 0;
          
          const rateConfig = TAXI_RATES[taxiType];
          if (!rateConfig) return 0;
          
          let totalFare = rateConfig.baseFare;
          
          if (distance <= 1) {
            return totalFare;
          }
          
          let remainingDistance = distance - 1;
          
          for (const rateRange of rateConfig.rates) {
            if (remainingDistance <= 0) break;
            
            const distanceInRange = Math.min(
              remainingDistance,
              rateRange.max - Math.max(rateRange.min - 1, 0)
            );
            
            totalFare += distanceInRange * rateRange.rate;
            remainingDistance -= distanceInRange;
          }
          
          return Math.round(totalFare * 100) / 100;
        }

        function calculateWaitingFare(waitingTimeMinutes) {
          if (waitingTimeMinutes <= 0) return 0;
          return Math.round(waitingTimeMinutes * WAITING_RATE.ratePerMinute * 100) / 100;
        }

        function calculateTaxiFare({
          distance,
          waitingTime = 0,
          taxiType = 'regular',
          isAppBooking = false,
          isAirportPickup = false
        }) {
          if (distance <= 0) {
            return {
              error: '‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0 ‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£',
              errorEN: 'Distance must be greater than 0 kilometers'
            };
          }
          
          const distanceFare = calculateDistanceFare(distance, taxiType);
          const waitingFare = calculateWaitingFare(waitingTime);
          
          let additionalFee = 0;
          const additionalCharges = [];
          
          if (isAppBooking) {
            additionalFee += ADDITIONAL_CHARGES.appBooking;
            additionalCharges.push({
              name: '‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏≠‡∏õ',
              nameEN: 'App Booking Fee',
              amount: ADDITIONAL_CHARGES.appBooking
            });
          }
          
          if (isAirportPickup) {
            additionalFee += ADDITIONAL_CHARGES.airportSurcharge;
            additionalCharges.push({
              name: '‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô',
              nameEN: 'Airport Surcharge',
              amount: ADDITIONAL_CHARGES.airportSurcharge
            });
          }
          
          const totalFare = distanceFare + waitingFare + additionalFee;
          
          return {
            success: true,
            breakdown: {
              distanceFare,
              waitingFare,
              additionalFee,
              additionalCharges
            },
            total: Math.round(totalFare * 100) / 100,
            taxiInfo: TAXI_RATES[taxiType],
            distance,
            waitingTime
          };
        }

        // Update showCalculator function to handle taxi-fare
        const originalShowCalculator = showCalculator;
        showCalculator = function(type) {
          const modal = document.getElementById('calculatorModal');
          const title = document.getElementById('modalTitle');
          const content = document.getElementById('modalContent');
          
          modal.classList.remove('hidden');
          modal.classList.add('flex');
          
          if (type === 'mrt-time') {
            title.textContent = currentLanguage === 'th' ? 'üöá ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á MRT' : 'üöá MRT Time Calculator';
            content.innerHTML = getMRTCalculatorHTML();
          } else if (type === 'taxi-fare') {
            title.textContent = currentLanguage === 'th' ? 'üöï ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà' : 'üöï Taxi Fare Calculator';
            content.innerHTML = getTaxiCalculatorHTML();
          } else if (type === 'btu') {
            title.textContent = currentLanguage === 'th' ? '‚ùÑÔ∏è ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì BTU ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®' : '‚ùÑÔ∏è BTU Air Conditioner Calculator';
            content.innerHTML = getBTUCalculatorHTML();
          } else if (type === 'pregnancy') {
            title.textContent = currentLanguage === 'th' ? 'ü§± ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå' : 'ü§± Pregnancy Calculator';
            content.innerHTML = getPregnancyCalculatorHTML();
          } else if (type === 'interest') {
            title.textContent = currentLanguage === 'th' ? 'üí∞ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢' : 'üí∞ Interest Calculator';
            content.innerHTML = getInterestCalculatorHTML();
          } else if (type === 'distance') {
            title.textContent = currentLanguage === 'th' ? 'üìè ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á' : 'üìè Distance Calculator';
            content.innerHTML = getDistanceCalculatorHTML();
          } else if (type === 'solar') {
            title.textContent = currentLanguage === 'th' ? '‚òÄÔ∏è ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏ö‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤' : '‚òÄÔ∏è Solar Rooftop Calculator';
            content.innerHTML = getSolarCalculatorHTML();
          } else if (type === 'electrical') {
            title.textContent = currentLanguage === 'th' ? '‚ö° ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏≤‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤' : '‚ö° Electrical Calculator';
            content.innerHTML = getElectricalCalculatorHTML();
          } else {
            title.textContent = currentLanguage === 'th' ? '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤!' : 'Calculator Coming Soon!';
            content.innerHTML = `<p class="text-center py-8 text-gray-500">${currentLanguage === 'th' ? '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á!' : 'This calculator is under development. Please check back later!'}</p>`;
          }
        };

        function getTaxiCalculatorHTML() {
          const isEnglish = currentLanguage === 'en';
          
          return `
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold mb-4">${isEnglish ? 'Trip Details' : '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á'}</h3>
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium mb-2">${isEnglish ? 'Distance (km)' : '‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£)'}</label>
                    <input type="number" id="taxiDistance" placeholder="${isEnglish ? 'Enter distance in kilometers' : '‡πÉ‡∏™‡πà‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£'}" 
                           class="w-full px-3 py-2 border rounded-lg" min="0.1" step="0.1">
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-2">${isEnglish ? 'Traffic Time (minutes)' : '‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏¥‡∏î/‡∏£‡∏≠ (‡∏ô‡∏≤‡∏ó‡∏µ)'}</label>
                    <input type="number" id="taxiWaitTime" placeholder="${isEnglish ? 'Enter waiting time in minutes' : '‡πÉ‡∏™‡πà‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ'}" 
                           class="w-full px-3 py-2 border rounded-lg" min="0" step="1" value="0">
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-2">${isEnglish ? 'Taxi Type' : '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà'}</label>
                    <select id="taxiType" class="w-full px-3 py-2 border rounded-lg">
                      <option value="regular">${isEnglish ? 'Regular Size (‡∏ø35 base)' : '‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏ø35 ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)'}</option>
                      <option value="large">${isEnglish ? 'Large Size (‡∏ø40 base)' : '‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà (‡∏ø40 ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)'}</option>
                    </select>
                  </div>
                  <div class="space-y-2">
                    <label class="flex items-center">
                      <input type="checkbox" id="isAppBooking" class="mr-2">
                      <span class="text-sm">${isEnglish ? 'App booking (+‡∏ø20)' : '‡∏à‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ (+‡∏ø20)'}</span>
                    </label>
                    <label class="flex items-center">
                      <input type="checkbox" id="isAirportPickup" class="mr-2">
                      <span class="text-sm">${isEnglish ? 'Airport pickup (+‡∏ø50)' : '‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô (+‡∏ø50)'}</span>
                    </label>
                  </div>
                  <button onclick="calculateTaxi()" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    ${isEnglish ? 'Calculate Fare' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£'}
                  </button>
                </div>
              </div>
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold mb-4">${isEnglish ? 'Fare Breakdown' : '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡πà‡∏≤‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£'}</h3>
                <div id="taxiResults" class="text-center py-8 text-gray-500">
                  ${isEnglish ? 'Enter distance and click calculate' : '‡πÉ‡∏™‡πà‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}
                </div>
              </div>
            </div>
          `;
        }

        function calculateTaxi() {
          const distance = parseFloat(document.getElementById('taxiDistance').value);
          const waitingTime = parseInt(document.getElementById('taxiWaitTime').value) || 0;
          const taxiType = document.getElementById('taxiType').value;
          const isAppBooking = document.getElementById('isAppBooking').checked;
          const isAirportPickup = document.getElementById('isAirportPickup').checked;
          const results = document.getElementById('taxiResults');
          const isEnglish = currentLanguage === 'en';
          
          if (!distance || distance <= 0) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please enter a valid distance' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'}</p>`;
            return;
          }
          
          const result = calculateTaxiFare({
            distance,
            waitingTime,
            taxiType,
            isAppBooking,
            isAirportPickup
          });
          
          if (result.error) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? result.errorEN : result.error}</p>`;
            return;
          }
          
          const taxiInfo = result.taxiInfo;
          const breakdown = result.breakdown;
          
          let additionalChargesHTML = '';
          if (breakdown.additionalCharges.length > 0) {
            additionalChargesHTML = breakdown.additionalCharges.map(charge => 
              `<div class="flex justify-between">
                <span>${isEnglish ? charge.nameEN : charge.name}:</span>
                <span>‡∏ø${charge.amount}</span>
              </div>`
            ).join('');
          }
          
          results.innerHTML = `
            <div class="space-y-3 text-left">
              <div class="p-3 bg-blue-50 rounded">
                <strong>${isEnglish ? 'Taxi Type:' : '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ:'}</strong> ${isEnglish ? taxiInfo.nameEN : taxiInfo.name}<br>
                <strong>${isEnglish ? 'Distance:' : '‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á:'}</strong> ${distance} ${isEnglish ? 'km' : '‡∏Å‡∏°.'}<br>
                ${waitingTime > 0 ? `<strong>${isEnglish ? 'Waiting Time:' : '‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠:'}</strong> ${waitingTime} ${isEnglish ? 'minutes' : '‡∏ô‡∏≤‡∏ó‡∏µ'}<br>` : ''}
              </div>
              
              <div class="p-3 bg-green-50 rounded">
                <h4 class="font-semibold mb-2">${isEnglish ? 'Fare Breakdown' : '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡πà‡∏≤‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£'}</h4>
                <div class="space-y-1 text-sm">
                  <div class="flex justify-between">
                    <span>${isEnglish ? 'Base fare (1st km):' : '‡∏Ñ‡πà‡∏≤‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (1 ‡∏Å‡∏°.‡πÅ‡∏£‡∏Å):'}</span>
                    <span>‡∏ø${taxiInfo.baseFare}</span>
                  </div>
                  ${distance > 1 ? `
                  <div class="flex justify-between">
                    <span>${isEnglish ? 'Distance fare:' : '‡∏Ñ‡πà‡∏≤‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á:'}</span>
                    <span>‡∏ø${(breakdown.distanceFare - taxiInfo.baseFare).toFixed(2)}</span>
                  </div>` : ''}
                  ${breakdown.waitingFare > 0 ? `
                  <div class="flex justify-between">
                    <span>${isEnglish ? 'Waiting fare:' : '‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠:'}</span>
                    <span>‡∏ø${breakdown.waitingFare}</span>
                  </div>` : ''}
                  ${additionalChargesHTML}
                  <hr class="my-2">
                  <div class="flex justify-between font-semibold text-lg">
                    <span>${isEnglish ? 'Total Fare:' : '‡∏Ñ‡πà‡∏≤‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£‡∏£‡∏ß‡∏°:'}</span>
                    <span class="text-green-600">‡∏ø${result.total}</span>
                  </div>
                </div>
              </div>
              
              <div class="p-3 bg-yellow-50 rounded text-sm">
                <strong>${isEnglish ? 'Note:' : '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:'}</strong>
                ${isEnglish ? 'Rates according to Ministry of Transport announcement (effective Jan 13, 2023)' : '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏Ñ‡∏°‡∏ô‡∏≤‡∏Ñ‡∏° (‡∏°‡∏µ‡∏ú‡∏•‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ 13 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2566)'}
              </div>
            </div>
          `;
        }

        // ======================
        // BTU CALCULATOR
        // ======================

        // BTU Constants (inline version)
        const BTU_CONSTANTS = {
          BASE_BTU_PER_SQM: 600,
          BASE_BTU_PER_SQFT: 25,
          
          DIRECTION_FACTORS: {
            north: 0.9,
            northeast: 0.95,
            east: 1.0,
            southeast: 1.1,
            south: 1.15,
            southwest: 1.1,
            west: 1.05,
            northwest: 0.95
          },
          
          FLOOR_FACTORS: {
            ground: 0.95,
            middle: 1.0,
            top: 1.15
          },
          
          PEOPLE_BTU: 600,
          
          APPLIANCE_BTU: {
            computer: 300,
            tv: 200,
            refrigerator: 1000,
            lighting: 100,
            oven: 2000
          },
          
          CEILING_HEIGHT_FACTORS: {
            low: 0.9,
            normal: 1.0,
            high: 1.1
          },
          
          ROOM_TYPE_FACTORS: {
            bedroom: 0.9,
            living: 1.0,
            kitchen: 1.2,
            office: 1.1,
            server: 1.5
          }
        };

        const STANDARD_BTU_SIZES = [
          { btu: 9000, ton: 0.75, type: '9,000 BTU (3/4 ‡∏ï‡∏±‡∏ô)' },
          { btu: 12000, ton: 1.0, type: '12,000 BTU (1 ‡∏ï‡∏±‡∏ô)' },
          { btu: 18000, ton: 1.5, type: '18,000 BTU (1.5 ‡∏ï‡∏±‡∏ô)' },
          { btu: 24000, ton: 2.0, type: '24,000 BTU (2 ‡∏ï‡∏±‡∏ô)' },
          { btu: 30000, ton: 2.5, type: '30,000 BTU (2.5 ‡∏ï‡∏±‡∏ô)' },
          { btu: 36000, ton: 3.0, type: '36,000 BTU (3 ‡∏ï‡∏±‡∏ô)' },
          { btu: 42000, ton: 3.5, type: '42,000 BTU (3.5 ‡∏ï‡∏±‡∏ô)' },
          { btu: 48000, ton: 4.0, type: '48,000 BTU (4 ‡∏ï‡∏±‡∏ô)' }
        ];

        function calculateBaseBTU(area, unit = 'sqm') {
          if (area <= 0) return 0;
          
          if (unit === 'sqft') {
            return area * BTU_CONSTANTS.BASE_BTU_PER_SQFT;
          } else {
            return area * BTU_CONSTANTS.BASE_BTU_PER_SQM;
          }
        }

        function findRecommendedACSize(requiredBTU) {
          const suitable = STANDARD_BTU_SIZES.find(size => size.btu >= requiredBTU);
          
          if (!suitable) {
            const largestSize = STANDARD_BTU_SIZES[STANDARD_BTU_SIZES.length - 1];
            const machineCount = Math.ceil(requiredBTU / largestSize.btu);
            
            return {
              single: false,
              machineCount,
              eachMachine: largestSize,
              totalBTU: machineCount * largestSize.btu,
              message: `‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ä‡πâ ${machineCount} ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏Ç‡∏ô‡∏≤‡∏î ${largestSize.type} ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á`
            };
          }
          
          return {
            single: true,
            recommended: suitable,
            efficiency: Math.round((requiredBTU / suitable.btu) * 100),
            message: `‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏ô‡∏≤‡∏î ${suitable.type}`
          };
        }

        function calculateBTUTotal({
          area,
          unit = 'sqm',
          direction = 'east',
          floor = 'middle',
          peopleCount = 2,
          roomType = 'living',
          ceilingHeight = 'normal',
          appliances = {
            computer: 0,
            tv: 0,
            refrigerator: 0,
            lighting: 0,
            oven: 0
          }
        }) {
          if (area <= 0) {
            return {
              error: '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0',
              errorEN: 'Room area must be greater than 0'
            };
          }
          
          const baseBTU = calculateBaseBTU(area, unit);
          
          const directionFactor = BTU_CONSTANTS.DIRECTION_FACTORS[direction] || 1.0;
          const floorFactor = BTU_CONSTANTS.FLOOR_FACTORS[floor] || 1.0;
          const roomTypeFactor = BTU_CONSTANTS.ROOM_TYPE_FACTORS[roomType] || 1.0;
          const ceilingFactor = BTU_CONSTANTS.CEILING_HEIGHT_FACTORS[ceilingHeight] || 1.0;
          
          const peopleBTU = peopleCount * BTU_CONSTANTS.PEOPLE_BTU;
          
          let applianceBTU = 0;
          Object.keys(appliances).forEach(appliance => {
            const count = appliances[appliance] || 0;
            const btuPerUnit = BTU_CONSTANTS.APPLIANCE_BTU[appliance] || 0;
            applianceBTU += count * btuPerUnit;
          });
          
          const adjustedBaseBTU = baseBTU * directionFactor * floorFactor * roomTypeFactor * ceilingFactor;
          const totalBTU = adjustedBaseBTU + peopleBTU + applianceBTU;
          
          const recommendedSize = findRecommendedACSize(totalBTU);
          
          return {
            success: true,
            calculation: {
              baseBTU: Math.round(baseBTU),
              adjustedBaseBTU: Math.round(adjustedBaseBTU),
              peopleBTU,
              applianceBTU,
              totalBTU: Math.round(totalBTU)
            },
            factors: {
              direction: directionFactor,
              floor: floorFactor,
              roomType: roomTypeFactor,
              ceiling: ceilingFactor
            },
            recommendation: recommendedSize,
            area,
            unit
          };
        }

        function getBTUCalculatorHTML() {
          const isEnglish = currentLanguage === 'en';
          
          return `
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold mb-4">${isEnglish ? 'Room Details' : '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡πâ‡∏≠‡∏á'}</h3>
                <div class="space-y-4">
                  <div class="grid grid-cols-2 gap-2">
                    <div>
                      <label class="block text-sm font-medium mb-2">${isEnglish ? 'Area' : '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà'}</label>
                      <input type="number" id="btuArea" placeholder="${isEnglish ? 'Enter area' : '‡πÉ‡∏™‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà'}" 
                             class="w-full px-3 py-2 border rounded-lg" min="1" step="0.1">
                    </div>
                    <div>
                      <label class="block text-sm font-medium mb-2">${isEnglish ? 'Unit' : '‡∏´‡∏ô‡πà‡∏ß‡∏¢'}</label>
                      <select id="btuUnit" class="w-full px-3 py-2 border rounded-lg">
                        <option value="sqm">${isEnglish ? 'Square meters (m¬≤)' : '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏°‡∏ï‡∏£ (‡∏ï‡∏£.‡∏°.)'}</option>
                        <option value="sqft">${isEnglish ? 'Square feet (ft¬≤)' : '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ü‡∏∏‡∏ï (‡∏ï‡∏£.‡∏ü‡∏ï.)'}</option>
                      </select>
                    </div>
                  </div>
                  
                  <div class="grid grid-cols-2 gap-2">
                    <div>
                      <label class="block text-sm font-medium mb-2">${isEnglish ? 'Direction' : '‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á'}</label>
                      <select id="btuDirection" class="w-full px-3 py-2 border rounded-lg">
                        <option value="north">${isEnglish ? 'North' : '‡πÄ‡∏´‡∏ô‡∏∑‡∏≠'}</option>
                        <option value="northeast">${isEnglish ? 'Northeast' : '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠'}</option>
                        <option value="east" selected>${isEnglish ? 'East' : '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å'}</option>
                        <option value="southeast">${isEnglish ? 'Southeast' : '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÉ‡∏ï‡πâ'}</option>
                        <option value="south">${isEnglish ? 'South' : '‡πÉ‡∏ï‡πâ'}</option>
                        <option value="southwest">${isEnglish ? 'Southwest' : '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÉ‡∏ï‡πâ'}</option>
                        <option value="west">${isEnglish ? 'West' : '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å'}</option>
                        <option value="northwest">${isEnglish ? 'Northwest' : '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠'}</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium mb-2">${isEnglish ? 'Floor' : '‡∏ä‡∏±‡πâ‡∏ô'}</label>
                      <select id="btuFloor" class="w-full px-3 py-2 border rounded-lg">
                        <option value="ground">${isEnglish ? 'Ground floor' : '‡∏ä‡∏±‡πâ‡∏ô‡∏•‡πà‡∏≤‡∏á'}</option>
                        <option value="middle" selected>${isEnglish ? 'Middle floor' : '‡∏ä‡∏±‡πâ‡∏ô‡∏Å‡∏•‡∏≤‡∏á'}</option>
                        <option value="top">${isEnglish ? 'Top floor' : '‡∏ä‡∏±‡πâ‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î'}</option>
                      </select>
                    </div>
                  </div>
                  
                  <div class="grid grid-cols-2 gap-2">
                    <div>
                      <label class="block text-sm font-medium mb-2">${isEnglish ? 'Room Type' : '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡πâ‡∏≠‡∏á'}</label>
                      <select id="btuRoomType" class="w-full px-3 py-2 border rounded-lg">
                        <option value="bedroom">${isEnglish ? 'Bedroom' : '‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô'}</option>
                        <option value="living" selected>${isEnglish ? 'Living room' : '‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏±‡πà‡∏á‡πÄ‡∏•‡πà‡∏ô'}</option>
                        <option value="kitchen">${isEnglish ? 'Kitchen' : '‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ß'}</option>
                        <option value="office">${isEnglish ? 'Office' : '‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô'}</option>
                        <option value="server">${isEnglish ? 'Server room' : '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå'}</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium mb-2">${isEnglish ? 'Ceiling Height' : '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏û‡∏î‡∏≤‡∏ô'}</label>
                      <select id="btuCeiling" class="w-full px-3 py-2 border rounded-lg">
                        <option value="low">${isEnglish ? 'Low (< 2.5m)' : '‡∏ï‡πà‡∏≥ (< 2.5 ‡∏°.)'}</option>
                        <option value="normal" selected>${isEnglish ? 'Normal (2.5-3m)' : '‡∏õ‡∏Å‡∏ï‡∏¥ (2.5-3 ‡∏°.)'}</option>
                        <option value="high">${isEnglish ? 'High (> 3m)' : '‡∏™‡∏π‡∏á (> 3 ‡∏°.)'}</option>
                      </select>
                    </div>
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-2">${isEnglish ? 'Number of People' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô'}</label>
                    <input type="number" id="btuPeople" value="2" min="0" max="50"
                           class="w-full px-3 py-2 border rounded-lg">
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-2">${isEnglish ? 'Electrical Appliances' : '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤'}</label>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                      <div class="flex justify-between items-center">
                        <span>${isEnglish ? 'Computer' : '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå'}</span>
                        <input type="number" id="btuComputer" value="0" min="0" max="10" class="w-16 px-2 py-1 border rounded text-center">
                      </div>
                      <div class="flex justify-between items-center">
                        <span>${isEnglish ? 'TV' : '‡∏ó‡∏µ‡∏ß‡∏µ'}</span>
                        <input type="number" id="btuTv" value="0" min="0" max="5" class="w-16 px-2 py-1 border rounded text-center">
                      </div>
                      <div class="flex justify-between items-center">
                        <span>${isEnglish ? 'Refrigerator' : '‡∏ï‡∏π‡πâ‡πÄ‡∏¢‡πá‡∏ô'}</span>
                        <input type="number" id="btuRefrigerator" value="0" min="0" max="3" class="w-16 px-2 py-1 border rounded text-center">
                      </div>
                      <div class="flex justify-between items-center">
                        <span>${isEnglish ? 'Lighting' : '‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü'}</span>
                        <input type="number" id="btuLighting" value="0" min="0" max="20" class="w-16 px-2 py-1 border rounded text-center">
                      </div>
                    </div>
                  </div>
                  
                  <button onclick="calculateBTU()" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    ${isEnglish ? 'Calculate BTU' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì BTU'}
                  </button>
                </div>
              </div>
              
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold mb-4">${isEnglish ? 'Calculation Results' : '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}</h3>
                <div id="btuResults" class="text-center py-8 text-gray-500">
                  ${isEnglish ? 'Enter room details and click calculate' : '‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}
                </div>
              </div>
            </div>
          `;
        }

        function calculateBTU() {
          const area = parseFloat(document.getElementById('btuArea').value);
          const unit = document.getElementById('btuUnit').value;
          const direction = document.getElementById('btuDirection').value;
          const floor = document.getElementById('btuFloor').value;
          const roomType = document.getElementById('btuRoomType').value;
          const ceilingHeight = document.getElementById('btuCeiling').value;
          const peopleCount = parseInt(document.getElementById('btuPeople').value) || 0;
          
          const appliances = {
            computer: parseInt(document.getElementById('btuComputer').value) || 0,
            tv: parseInt(document.getElementById('btuTv').value) || 0,
            refrigerator: parseInt(document.getElementById('btuRefrigerator').value) || 0,
            lighting: parseInt(document.getElementById('btuLighting').value) || 0,
            oven: 0
          };
          
          const results = document.getElementById('btuResults');
          const isEnglish = currentLanguage === 'en';
          
          if (!area || area <= 0) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please enter a valid area' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'}</p>`;
            return;
          }
          
          const result = calculateBTUTotal({
            area,
            unit,
            direction,
            floor,
            peopleCount,
            roomType,
            ceilingHeight,
            appliances
          });
          
          if (result.error) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? result.errorEN : result.error}</p>`;
            return;
          }
          
          const calculation = result.calculation;
          const recommendation = result.recommendation;
          
          results.innerHTML = `
            <div class="space-y-3 text-left">
              <div class="p-3 bg-blue-50 rounded">
                <strong>${isEnglish ? 'Room:' : '‡∏´‡πâ‡∏≠‡∏á:'}</strong> ${area} ${unit === 'sqm' ? (isEnglish ? 'm¬≤' : '‡∏ï‡∏£.‡∏°.') : (isEnglish ? 'ft¬≤' : '‡∏ï‡∏£.‡∏ü‡∏ï.')}<br>
                <strong>${isEnglish ? 'People:' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô:'}</strong> ${peopleCount} ${isEnglish ? 'people' : '‡∏Ñ‡∏ô'}
              </div>
              
              <div class="p-3 bg-green-50 rounded">
                <h4 class="font-semibold mb-2">${isEnglish ? 'BTU Breakdown' : '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î BTU'}</h4>
                <div class="space-y-1 text-sm">
                  <div class="flex justify-between">
                    <span>${isEnglish ? 'Base BTU:' : 'BTU ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô:'}</span>
                    <span>${calculation.baseBTU.toLocaleString()}</span>
                  </div>
                  <div class="flex justify-between">
                    <span>${isEnglish ? 'Room adjustments:' : '‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á:'}</span>
                    <span>${(calculation.adjustedBaseBTU - calculation.baseBTU).toLocaleString()}</span>
                  </div>
                  ${calculation.peopleBTU > 0 ? `
                  <div class="flex justify-between">
                    <span>${isEnglish ? 'People BTU:' : 'BTU ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ô:'}</span>
                    <span>+${calculation.peopleBTU.toLocaleString()}</span>
                  </div>` : ''}
                  ${calculation.applianceBTU > 0 ? `
                  <div class="flex justify-between">
                    <span>${isEnglish ? 'Appliances BTU:' : 'BTU ‡∏à‡∏≤‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:'}</span>
                    <span>+${calculation.applianceBTU.toLocaleString()}</span>
                  </div>` : ''}
                  <hr class="my-2">
                  <div class="flex justify-between font-semibold text-lg">
                    <span>${isEnglish ? 'Total BTU Required:' : 'BTU ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°:'}</span>
                    <span class="text-green-600">${calculation.totalBTU.toLocaleString()}</span>
                  </div>
                </div>
              </div>
              
              <div class="p-3 bg-purple-50 rounded">
                <h4 class="font-semibold mb-2">${isEnglish ? 'Recommendation' : '‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥'}</h4>
                ${recommendation.single ? `
                  <p class="text-sm"><strong>${isEnglish ? 'Recommended Size:' : '‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:'}</strong></p>
                  <p class="text-lg font-semibold text-purple-600">${recommendation.recommended.type}</p>
                  <p class="text-sm text-gray-600">${isEnglish ? 'Efficiency:' : '‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û:'} ${recommendation.efficiency}%</p>
                ` : `
                  <p class="text-sm text-orange-600"><strong>${isEnglish ? 'Large Area Alert:' : '‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà:'}</strong></p>
                  <p class="text-sm">${recommendation.message}</p>
                `}
              </div>
              
              <div class="p-3 bg-yellow-50 rounded text-sm">
                <strong>${isEnglish ? 'Tips:' : '‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:'}</strong>
                ${isEnglish ? 'Choose Inverter AC for energy saving. Consider room insulation for better efficiency.' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏≠‡∏£‡πå Inverter ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÑ‡∏ü ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏â‡∏ô‡∏ß‡∏ô‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô'}
              </div>
            </div>
          `;
        }

        // ======================
        // PREGNANCY CALCULATOR
        // ======================

        // Pregnancy constants (inline version)
        const PREGNANCY_CONSTANTS = {
          STANDARD_PREGNANCY_DAYS: 280,
          STANDARD_PREGNANCY_WEEKS: 40,
          
          TRIMESTERS: {
            first: { start: 0, end: 13, name: '‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™‡πÅ‡∏£‡∏Å', nameEN: 'First Trimester' },
            second: { start: 14, end: 27, name: '‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á', nameEN: 'Second Trimester' },
            third: { start: 28, end: 42, name: '‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°', nameEN: 'Third Trimester' }
          },
          
          NORMAL_DELIVERY_RANGE: {
            early: 37,
            late: 42
          }
        };

        const PREGNANCY_MILESTONES = {
          4: {
            th: "‚ù§Ô∏è ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ï‡πâ‡∏ô, ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤",
            en: "‚ù§Ô∏è Heart starts beating, nervous system begins developing"
          },
          8: {
            th: "üë∂ ‡∏≠‡∏ß‡∏±‡∏¢‡∏ß‡∏∞‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏¥‡∏î, ‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 1.6 ‡∏ã‡∏°.",
            en: "üë∂ Major organs begin forming, about 1.6 cm in size"
          },
          12: {
            th: "ü¶¥ ‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏Ç‡πá‡∏á, ‡πÄ‡∏û‡∏®‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô",
            en: "ü¶¥ Bones start hardening, gender becomes clear"
          },
          16: {
            th: "üëÇ ‡∏´‡∏π‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô, ‡∏ú‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏à‡∏£‡∏¥‡∏ç",
            en: "üëÇ Ears start hearing, hair begins growing"
          },
          20: {
            th: "ü§± ‡πÅ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏î‡πá‡∏Å‡∏î‡∏¥‡πâ‡∏ô, ‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 25 ‡∏ã‡∏°.",
            en: "ü§± Mother starts feeling movement, about 25 cm long"
          },
          24: {
            th: "üëÅÔ∏è ‡∏ï‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ, ‡∏õ‡∏≠‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤",
            en: "üëÅÔ∏è Eyes can open, lungs start developing"
          },
          28: {
            th: "üß† ‡∏™‡∏°‡∏≠‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏£‡πá‡∏ß, ‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏£‡∏≠‡∏î‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î",
            en: "üß† Rapid brain development, viable if born premature"
          },
          32: {
            th: "üí™ ‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏Ç‡∏∂‡πâ‡∏ô, ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏∞‡∏™‡∏°‡πÑ‡∏Ç‡∏°‡∏±‡∏ô",
            en: "üí™ Stronger muscles, fat storage begins"
          },
          36: {
            th: "ü´Å ‡∏õ‡∏≠‡∏î‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°, ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2.5 ‡∏Å‡∏Å.",
            en: "ü´Å Lungs nearly ready, weight about 2.5 kg"
          },
          40: {
            th: "üçº ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏•‡∏≠‡∏î! ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 3-3.5 ‡∏Å‡∏Å.",
            en: "üçº Ready for birth! Weight about 3-3.5 kg"
          }
        };

        const TRIMESTER_ADVICE = {
          first: {
            th: [
              "ü•ó ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô‡πÇ‡∏ü‡∏•‡∏¥‡∏Å‡πÅ‡∏≠‡∏ã‡∏¥‡∏î 400-800 ‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡∏Å‡∏£‡∏±‡∏°/‡∏ß‡∏±‡∏ô",
              "üö≠ ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà ‡πÅ‡∏≠‡∏•‡∏Å‡∏≠‡∏Æ‡∏≠‡∏•‡πå ‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡πÄ‡∏™‡∏û‡∏ï‡∏¥‡∏î",
              "‚òï ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 200 ‡∏°‡∏Å./‡∏ß‡∏±‡∏ô",
              "üò¥ ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î"
            ],
            en: [
              "ü•ó Take 400-800 mcg folic acid daily",
              "üö≠ Avoid smoking, alcohol, and drugs",
              "‚òï Limit caffeine to under 200mg/day",
              "üò¥ Get adequate rest, manage stress"
            ]
          },
          second: {
            th: [
              "üèÉ‚Äç‚ôÄÔ∏è ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏î‡∏¥‡∏ô ‡∏ß‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥ ‡πÇ‡∏¢‡∏Ñ‡∏∞",
              "ü©∫ ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏£‡∏£‡∏†‡πå‡∏ó‡∏∏‡∏Å 4 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå",
              "ü•õ ‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8-10 ‡πÅ‡∏Å‡πâ‡∏ß/‡∏ß‡∏±‡∏ô",
              "üëï ‡πÉ‡∏™‡πà‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡∏Ñ‡∏•‡∏≤‡∏¢‡∏ó‡πâ‡∏≠‡∏á ‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏™‡πâ‡∏ô‡πÄ‡∏ï‡∏µ‡πâ‡∏¢"
            ],
            en: [
              "üèÉ‚Äç‚ôÄÔ∏è Exercise regularly: walking, swimming, yoga",
              "ü©∫ Prenatal checkups every 4 weeks",
              "ü•õ Stay hydrated, at least 8-10 glasses/day",
              "üëï Wear loose clothing, low-heeled shoes"
            ]
          },
          third: {
            th: [
              "üéí ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏î‡πá‡∏Å",
              "üè• ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏•‡∏≤‡∏™‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏•‡∏≠‡∏î ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•",
              "üòå ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏à‡∏¥‡∏ï‡πÉ‡∏à ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ó‡πà‡∏≤‡∏Ñ‡∏•‡∏≠‡∏î",
              "üë• ‡∏à‡∏±‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏•‡∏≠‡∏î"
            ],
            en: [
              "üéí Pack hospital bag, buy baby essentials",
              "üè• Attend birthing classes, choose hospital",
              "üòå Mental preparation, learn birthing positions",
              "üë• Arrange postpartum support system"
            ]
          }
        };

        function calculatePregnancyFromLMP(lmpDate, currentDate = new Date()) {
          if (!lmpDate || !(lmpDate instanceof Date)) {
            return {
              error: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
              errorEN: 'Invalid LMP date'
            };
          }
          
          const daysDiff = Math.floor((currentDate - lmpDate) / (1000 * 60 * 60 * 24));
          
          if (daysDiff < 0) {
            return {
              error: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô',
              errorEN: 'LMP date cannot be in the future'
            };
          }
          
          if (daysDiff > 300) {
            return {
              error: '‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥',
              errorEN: 'Pregnancy age exceeds normal range'
            };
          }
          
          const weeks = Math.floor(daysDiff / 7);
          const days = daysDiff % 7;
          
          const eddDate = new Date(lmpDate);
          eddDate.setDate(eddDate.getDate() + PREGNANCY_CONSTANTS.STANDARD_PREGNANCY_DAYS);
          
          const trimester = getPregnancyTrimester(weeks);
          const progressPercent = Math.min((weeks / PREGNANCY_CONSTANTS.STANDARD_PREGNANCY_WEEKS) * 100, 100);
          const daysRemaining = Math.max(0, Math.floor((eddDate - currentDate) / (1000 * 60 * 60 * 24)));
          
          return {
            success: true,
            gestationalAge: {
              totalDays: daysDiff,
              weeks,
              days,
              displayText: `${weeks} ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå ${days} ‡∏ß‡∏±‡∏ô`,
              displayTextEN: `${weeks} weeks ${days} days`
            },
            trimester,
            eddDate,
            lmpDate,
            currentDate,
            progressPercent: Math.round(progressPercent),
            daysRemaining,
            weeksRemaining: Math.ceil(daysRemaining / 7),
            milestone: getCurrentPregnancyMilestone(weeks),
            advice: TRIMESTER_ADVICE[trimester.key],
            isFullTerm: weeks >= PREGNANCY_CONSTANTS.NORMAL_DELIVERY_RANGE.early,
            deliveryStatus: getPregnancyDeliveryStatus(weeks)
          };
        }

        function getPregnancyTrimester(weeks) {
          const trimesters = PREGNANCY_CONSTANTS.TRIMESTERS;
          
          if (weeks <= trimesters.first.end) {
            return { ...trimesters.first, key: 'first' };
          } else if (weeks <= trimesters.second.end) {
            return { ...trimesters.second, key: 'second' };
          } else {
            return { ...trimesters.third, key: 'third' };
          }
        }

        function getCurrentPregnancyMilestone(weeks) {
          const milestoneWeeks = Object.keys(PREGNANCY_MILESTONES).map(Number).sort((a, b) => a - b);
          const passedMilestone = milestoneWeeks.filter(week => week <= weeks).pop();
          
          if (passedMilestone) {
            return {
              week: passedMilestone,
              ...PREGNANCY_MILESTONES[passedMilestone]
            };
          }
          
          const nextMilestone = milestoneWeeks.find(week => week > weeks);
          if (nextMilestone) {
            return {
              week: nextMilestone,
              isUpcoming: true,
              ...PREGNANCY_MILESTONES[nextMilestone]
            };
          }
          
          return null;
        }

        function getPregnancyDeliveryStatus(weeks) {
          const { early, late } = PREGNANCY_CONSTANTS.NORMAL_DELIVERY_RANGE;
          
          if (weeks < early) {
            return {
              status: 'preterm',
              message: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏•‡∏≠‡∏î',
              messageEN: 'Preterm - not yet due',
              color: 'blue'
            };
          } else if (weeks >= early && weeks <= late) {
            return {
              status: 'term',
              message: '‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏•‡∏≠‡∏î‡πÅ‡∏•‡πâ‡∏ß',
              messageEN: 'Full term - ready for delivery',
              color: 'green'
            };
          } else {
            return {
              status: 'overdue',
              message: '‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏•‡∏≠‡∏î',
              messageEN: 'Overdue - past due date',
              color: 'red'
            };
          }
        }

        function getPregnancyCalculatorHTML() {
          const isEnglish = currentLanguage === 'en';
          
          return `
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold mb-4">${isEnglish ? 'Pregnancy Calculation' : '‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå'}</h3>
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium mb-2">
                      ${isEnglish ? 'Calculation Method' : '‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}
                    </label>
                    <select id="pregnancyMethod" onchange="togglePregnancyInputs()" class="w-full px-3 py-2 border rounded-lg">
                      <option value="lmp">${isEnglish ? 'Last Menstrual Period (LMP)' : '‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (LMP)'}</option>
                      <option value="conception">${isEnglish ? 'Conception Date' : '‡∏ß‡∏±‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå/‡∏ú‡∏™‡∏°'}</option>
                    </select>
                  </div>
                  
                  <div id="lmpInput">
                    <label class="block text-sm font-medium mb-2">
                      ${isEnglish ? 'Last Menstrual Period Date' : '‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢'}
                    </label>
                    <input type="date" id="lmpDate" class="w-full px-3 py-2 border rounded-lg">
                    <p class="text-xs text-gray-500 mt-1">
                      ${isEnglish ? 'Select the first day of your last menstrual period' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢'}
                    </p>
                  </div>
                  
                  <div id="conceptionInput" style="display: none;">
                    <label class="block text-sm font-medium mb-2">
                      ${isEnglish ? 'Conception/Fertilization Date' : '‡∏ß‡∏±‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå/‡∏ú‡∏™‡∏°'}
                    </label>
                    <input type="date" id="conceptionDate" class="w-full px-3 py-2 border rounded-lg">
                    <p class="text-xs text-gray-500 mt-1">
                      ${isEnglish ? 'Select the estimated conception date' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå'}
                    </p>
                  </div>
                  
                  <button onclick="calculatePregnancy()" class="w-full px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700">
                    ${isEnglish ? 'Calculate Pregnancy Age' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå'}
                  </button>
                  
                  <div class="text-xs text-gray-500 space-y-1">
                    <p>${isEnglish ? '‚Ä¢ Results are estimates for information only' : '‚Ä¢ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô'}</p>
                    <p>${isEnglish ? '‚Ä¢ Consult your doctor for accurate information' : '‚Ä¢ ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥'}</p>
                  </div>
                </div>
              </div>
              
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold mb-4">${isEnglish ? 'Pregnancy Information' : '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå'}</h3>
                <div id="pregnancyResults" class="text-center py-8 text-gray-500">
                  ${isEnglish ? 'Enter your last menstrual period date and calculate' : '‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}
                </div>
              </div>
            </div>
          `;
        }

        function togglePregnancyInputs() {
          const method = document.getElementById('pregnancyMethod').value;
          const lmpInput = document.getElementById('lmpInput');
          const conceptionInput = document.getElementById('conceptionInput');
          
          if (method === 'lmp') {
            lmpInput.style.display = 'block';
            conceptionInput.style.display = 'none';
          } else {
            lmpInput.style.display = 'none';
            conceptionInput.style.display = 'block';
          }
        }

        function calculatePregnancy() {
          const method = document.getElementById('pregnancyMethod').value;
          const results = document.getElementById('pregnancyResults');
          const isEnglish = currentLanguage === 'en';
          
          let inputDate;
          if (method === 'lmp') {
            const lmpDateValue = document.getElementById('lmpDate').value;
            if (!lmpDateValue) {
              results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please select your last menstrual period date' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢'}</p>`;
              return;
            }
            inputDate = new Date(lmpDateValue);
          } else {
            const conceptionDateValue = document.getElementById('conceptionDate').value;
            if (!conceptionDateValue) {
              results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please select conception date' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå'}</p>`;
              return;
            }
            inputDate = new Date(conceptionDateValue);
            // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô LMP ‡πÇ‡∏î‡∏¢‡∏•‡∏ö 14 ‡∏ß‡∏±‡∏ô
            inputDate.setDate(inputDate.getDate() - 14);
          }
          
          const result = calculatePregnancyFromLMP(inputDate);
          
          if (result.error) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? result.errorEN : result.error}</p>`;
            return;
          }
          
          const { gestationalAge, trimester, eddDate, progressPercent, daysRemaining, milestone, advice, deliveryStatus } = result;
          
          results.innerHTML = `
            <div class="space-y-4 text-left">
              <!-- ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô -->
              <div class="p-4 bg-pink-50 rounded-lg border-l-4 border-pink-400">
                <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Current Gestational Age' : '‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô'}</h4>
                <div class="text-2xl font-bold text-pink-600 mb-2">
                  ${isEnglish ? gestationalAge.displayTextEN : gestationalAge.displayText}
                </div>
                <div class="text-sm text-gray-600">
                  ${isEnglish ? trimester.nameEN : trimester.name} ‚Ä¢ ${progressPercent}% ${isEnglish ? 'complete' : '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß'}
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                  <div class="bg-pink-600 h-2 rounded-full" style="width: ${progressPercent}%"></div>
                </div>
              </div>
              
              <!-- ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏•‡∏≠‡∏î‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå -->
              <div class="p-4 bg-blue-50 rounded-lg">
                <h4 class="font-semibold mb-2">${isEnglish ? 'Estimated Due Date' : '‡∏ß‡∏±‡∏ô‡∏Ñ‡∏•‡∏≠‡∏î‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå'}</h4>
                <div class="text-lg font-semibold text-blue-600">
                  ${eddDate.toLocaleDateString(isEnglish ? 'en-US' : 'th-TH', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                  })}
                </div>
                <div class="text-sm text-gray-600 mt-1">
                  ${isEnglish ? `${daysRemaining} days remaining` : `‡∏≠‡∏µ‡∏Å ${daysRemaining} ‡∏ß‡∏±‡∏ô`}
                  ${result.weeksRemaining > 0 ? ` (${result.weeksRemaining} ${isEnglish ? 'weeks' : '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå'})` : ''}
                </div>
                <div class="mt-2">
                  <span class="inline-block px-2 py-1 text-xs rounded-full bg-${deliveryStatus.color}-100 text-${deliveryStatus.color}-800">
                    ${isEnglish ? deliveryStatus.messageEN : deliveryStatus.message}
                  </span>
                </div>
              </div>
              
              <!-- ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£ -->
              ${milestone ? `
              <div class="p-4 bg-purple-50 rounded-lg">
                <h4 class="font-semibold mb-2">${isEnglish ? 'Development Milestone' : '‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£'}</h4>
                <div class="text-sm">
                  <strong>${isEnglish ? 'Week' : '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà'} ${milestone.week}:</strong>
                  ${milestone.isUpcoming ? `<span class="text-orange-600">(${isEnglish ? 'Upcoming' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á'})</span>` : ''}
                </div>
                <div class="text-sm mt-1">
                  ${isEnglish ? milestone.en : milestone.th}
                </div>
              </div>
              ` : ''}
              
              <!-- ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ -->
              <div class="p-4 bg-green-50 rounded-lg">
                <h4 class="font-semibold mb-2">${isEnglish ? 'Recommendations' : '‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥'}</h4>
                <ul class="text-sm space-y-1">
                  ${(isEnglish ? advice.en : advice.th).map(tip => `<li>${tip}</li>`).join('')}
                </ul>
              </div>
              
              <!-- ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
              <div class="p-3 bg-yellow-50 rounded-lg text-sm border-l-4 border-yellow-400">
                <strong>${isEnglish ? 'Important:' : '‡∏Ç‡πâ‡∏≠‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:'}</strong>
                ${isEnglish ? 'This calculator provides estimates only. Always consult your healthcare provider for accurate information and personalized care.' : '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏™‡∏°‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•'}
              </div>
            </div>
          `;
        }

        // ======================
        // INTEREST CALCULATOR
        // ======================

        // Interest constants (inline version)
        const INTEREST_CONSTANTS_INLINE = {
          COMPOUNDING_FREQUENCIES: {
            annually: 1,
            semiannually: 2,
            quarterly: 4,
            monthly: 12,
            weekly: 52,
            daily: 365
          },
          
          MARKET_RATES: {
            savings: { min: 0.1, max: 1.5, name: '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏≠‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå', nameEN: 'Savings Account' },
            fixed: { min: 1.0, max: 2.5, name: '‡∏ù‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏à‡∏≥', nameEN: 'Fixed Deposit' },
            loan: { min: 5.0, max: 20.0, name: '‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠', nameEN: 'Personal Loan' },
            mortgage: { min: 3.0, max: 6.0, name: '‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡πâ‡∏≤‡∏ô', nameEN: 'Mortgage' },
            credit: { min: 18.0, max: 28.0, name: '‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï', nameEN: 'Credit Card' }
          }
        };

        function calculateSimpleInterestInline(principal, rate, time) {
          if (principal <= 0 || rate < 0 || time <= 0) {
            return {
              error: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0, ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö',
              errorEN: 'Invalid input: Principal and time must be > 0, rate must be ‚â• 0'
            };
          }
          
          const rateDecimal = rate / 100;
          const interest = principal * rateDecimal * time;
          const totalAmount = principal + interest;
          
          return {
            success: true,
            type: 'simple',
            calculation: {
              principal,
              rate,
              time,
              interest: Math.round(interest * 100) / 100,
              totalAmount: Math.round(totalAmount * 100) / 100
            }
          };
        }

        function calculateCompoundInterestInline(principal, rate, time, compoundFrequency = 12) {
          if (principal <= 0 || rate < 0 || time <= 0 || compoundFrequency <= 0) {
            return {
              error: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
              errorEN: 'Invalid input'
            };
          }
          
          const rateDecimal = rate / 100;
          const totalAmount = principal * Math.pow(1 + rateDecimal / compoundFrequency, compoundFrequency * time);
          const compoundInterest = totalAmount - principal;
          const simpleInterest = principal * rateDecimal * time;
          const extraInterest = compoundInterest - simpleInterest;
          
          return {
            success: true,
            type: 'compound',
            calculation: {
              principal,
              rate,
              time,
              compoundFrequency,
              compoundInterest: Math.round(compoundInterest * 100) / 100,
              totalAmount: Math.round(totalAmount * 100) / 100,
              simpleInterest: Math.round(simpleInterest * 100) / 100,
              extraInterest: Math.round(extraInterest * 100) / 100
            }
          };
        }

        function calculateMonthlySavingsInline(monthlyAmount, rate, years, initialAmount = 0) {
          if (monthlyAmount < 0 || rate < 0 || years <= 0 || initialAmount < 0) {
            return {
              error: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
              errorEN: 'Invalid input'
            };
          }
          
          const monthlyRate = rate / 100 / 12;
          const totalMonths = years * 12;
          
          const initialWithInterest = initialAmount * Math.pow(1 + monthlyRate, totalMonths);
          
          let monthlySavingsTotal = 0;
          if (monthlyAmount > 0 && rate > 0) {
            monthlySavingsTotal = monthlyAmount * ((Math.pow(1 + monthlyRate, totalMonths) - 1) / monthlyRate);
          } else if (monthlyAmount > 0) {
            monthlySavingsTotal = monthlyAmount * totalMonths;
          }
          
          const totalContributions = initialAmount + (monthlyAmount * totalMonths);
          const totalAmount = initialWithInterest + monthlySavingsTotal;
          const totalInterest = totalAmount - totalContributions;
          
          return {
            success: true,
            type: 'savings',
            calculation: {
              monthlyAmount,
              rate,
              years,
              initialAmount,
              totalContributions: Math.round(totalContributions * 100) / 100,
              totalInterest: Math.round(totalInterest * 100) / 100,
              totalAmount: Math.round(totalAmount * 100) / 100
            }
          };
        }

        function calculateLoanPaymentInline(loanAmount, rate, years) {
          if (loanAmount <= 0 || rate < 0 || years <= 0) {
            return {
              error: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
              errorEN: 'Invalid input'
            };
          }
          
          const monthlyRate = rate / 100 / 12;
          const totalMonths = years * 12;
          
          let monthlyPayment;
          if (rate === 0) {
            monthlyPayment = loanAmount / totalMonths;
          } else {
            monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, totalMonths)) / 
                            (Math.pow(1 + monthlyRate, totalMonths) - 1);
          }
          
          const totalPayment = monthlyPayment * totalMonths;
          const totalInterest = totalPayment - loanAmount;
          
          return {
            success: true,
            type: 'loan',
            calculation: {
              loanAmount,
              rate,
              years,
              monthlyPayment: Math.round(monthlyPayment * 100) / 100,
              totalPayment: Math.round(totalPayment * 100) / 100,
              totalInterest: Math.round(totalInterest * 100) / 100
            }
          };
        }

        function getInterestCalculatorHTML() {
          const isEnglish = currentLanguage === 'en';
          
          return `
            <div class="space-y-6">
              <!-- Calculator Type Selection -->
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold mb-4">${isEnglish ? 'Calculator Type' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                  <button onclick="switchInterestType('simple')" id="btn-simple" class="p-3 text-sm border rounded-lg hover:bg-blue-50 transition-colors">
                    <div class="font-medium">${isEnglish ? 'Simple Interest' : '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤'}</div>
                    <div class="text-xs text-gray-500">${isEnglish ? 'Basic calculation' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô'}</div>
                  </button>
                  <button onclick="switchInterestType('compound')" id="btn-compound" class="p-3 text-sm border rounded-lg hover:bg-blue-50 transition-colors">
                    <div class="font-medium">${isEnglish ? 'Compound Interest' : '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ó‡∏ö‡∏ï‡πâ‡∏ô'}</div>
                    <div class="text-xs text-gray-500">${isEnglish ? 'With compounding' : '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ó‡∏ö‡∏ï‡πâ‡∏ô'}</div>
                  </button>
                  <button onclick="switchInterestType('savings')" id="btn-savings" class="p-3 text-sm border rounded-lg hover:bg-blue-50 transition-colors">
                    <div class="font-medium">${isEnglish ? 'Monthly Savings' : '‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}</div>
                    <div class="text-xs text-gray-500">${isEnglish ? 'Regular deposits' : '‡∏ù‡∏≤‡∏Å‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠'}</div>
                  </button>
                  <button onclick="switchInterestType('loan')" id="btn-loan" class="p-3 text-sm border rounded-lg hover:bg-blue-50 transition-colors">
                    <div class="font-medium">${isEnglish ? 'Loan Payment' : '‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞'}</div>
                    <div class="text-xs text-gray-500">${isEnglish ? 'Monthly payments' : '‡∏ú‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}</div>
                  </button>
                </div>
              </div>
              
              <!-- Input Forms -->
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-gray-50 p-4 rounded-lg">
                  <div id="interestInputs">
                    <!-- Dynamic content will be loaded here -->
                  </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                  <h3 class="font-semibold mb-4">${isEnglish ? 'Calculation Results' : '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}</h3>
                  <div id="interestResults" class="text-center py-8 text-gray-500">
                    ${isEnglish ? 'Select calculation type and enter values' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}
                  </div>
                </div>
              </div>
            </div>
          `;
        }

        let currentInterestType = 'simple';

        function switchInterestType(type) {
          currentInterestType = type;
          
          // Update button styles
          document.querySelectorAll('[id^="btn-"]').forEach(btn => {
            btn.className = 'p-3 text-sm border rounded-lg hover:bg-blue-50 transition-colors';
          });
          document.getElementById('btn-' + type).className = 'p-3 text-sm border-2 border-blue-500 bg-blue-50 rounded-lg';
          
          loadInterestInputs(type);
          clearInterestResults();
        }

        function loadInterestInputs(type) {
          const isEnglish = currentLanguage === 'en';
          const inputsDiv = document.getElementById('interestInputs');
          
          if (type === 'simple') {
            inputsDiv.innerHTML = `
              <h3 class="font-semibold mb-4">${isEnglish ? 'Simple Interest' : '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤'}</h3>
              <div class="space-y-3">
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Principal Amount (‡∏ø)' : '‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô (‡∏ö‡∏≤‡∏ó)'}</label>
                  <input type="number" id="simplePrincipal" placeholder="${isEnglish ? 'Enter amount' : '‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'}" class="w-full px-3 py-2 border rounded-lg" min="1" step="1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Interest Rate (% per year)' : '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ (% ‡∏ï‡πà‡∏≠‡∏õ‡∏µ)'}</label>
                  <input type="number" id="simpleRate" placeholder="${isEnglish ? 'e.g., 5.5' : '‡πÄ‡∏ä‡πà‡∏ô 5.5'}" class="w-full px-3 py-2 border rounded-lg" min="0" step="0.1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Time Period (years)' : '‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏õ‡∏µ)'}</label>
                  <input type="number" id="simpleTime" placeholder="${isEnglish ? 'e.g., 2.5' : '‡πÄ‡∏ä‡πà‡∏ô 2.5'}" class="w-full px-3 py-2 border rounded-lg" min="0.1" step="0.1">
                </div>
                <button onclick="calculateInterest()" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                  ${isEnglish ? 'Calculate' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}
                </button>
              </div>
            `;
          } else if (type === 'compound') {
            inputsDiv.innerHTML = `
              <h3 class="font-semibold mb-4">${isEnglish ? 'Compound Interest' : '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ó‡∏ö‡∏ï‡πâ‡∏ô'}</h3>
              <div class="space-y-3">
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Principal Amount (‡∏ø)' : '‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô (‡∏ö‡∏≤‡∏ó)'}</label>
                  <input type="number" id="compoundPrincipal" placeholder="${isEnglish ? 'Enter amount' : '‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'}" class="w-full px-3 py-2 border rounded-lg" min="1" step="1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Interest Rate (% per year)' : '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ (% ‡∏ï‡πà‡∏≠‡∏õ‡∏µ)'}</label>
                  <input type="number" id="compoundRate" placeholder="${isEnglish ? 'e.g., 5.5' : '‡πÄ‡∏ä‡πà‡∏ô 5.5'}" class="w-full px-3 py-2 border rounded-lg" min="0" step="0.1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Time Period (years)' : '‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏õ‡∏µ)'}</label>
                  <input type="number" id="compoundTime" placeholder="${isEnglish ? 'e.g., 2.5' : '‡πÄ‡∏ä‡πà‡∏ô 2.5'}" class="w-full px-3 py-2 border rounded-lg" min="0.1" step="0.1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Compounding Frequency' : '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢'}</label>
                  <select id="compoundFreq" class="w-full px-3 py-2 border rounded-lg">
                    <option value="12">${isEnglish ? 'Monthly' : '‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}</option>
                    <option value="4">${isEnglish ? 'Quarterly' : '‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™'}</option>
                    <option value="2">${isEnglish ? 'Semi-annually' : '‡∏£‡∏≤‡∏¢ 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}</option>
                    <option value="1">${isEnglish ? 'Annually' : '‡∏£‡∏≤‡∏¢‡∏õ‡∏µ'}</option>
                    <option value="365">${isEnglish ? 'Daily' : '‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô'}</option>
                  </select>
                </div>
                <button onclick="calculateInterest()" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                  ${isEnglish ? 'Calculate' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}
                </button>
              </div>
            `;
          } else if (type === 'savings') {
            inputsDiv.innerHTML = `
              <h3 class="font-semibold mb-4">${isEnglish ? 'Monthly Savings' : '‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}</h3>
              <div class="space-y-3">
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Initial Amount (‡∏ø)' : '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ö‡∏≤‡∏ó)'}</label>
                  <input type="number" id="savingsInitial" placeholder="${isEnglish ? 'Starting amount' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô'}" class="w-full px-3 py-2 border rounded-lg" min="0" step="1" value="0">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Monthly Deposit (‡∏ø)' : '‡∏ù‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)'}</label>
                  <input type="number" id="savingsMonthly" placeholder="${isEnglish ? 'Monthly amount' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}" class="w-full px-3 py-2 border rounded-lg" min="0" step="1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Interest Rate (% per year)' : '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ (% ‡∏ï‡πà‡∏≠‡∏õ‡∏µ)'}</label>
                  <input type="number" id="savingsRate" placeholder="${isEnglish ? 'e.g., 2.5' : '‡πÄ‡∏ä‡πà‡∏ô 2.5'}" class="w-full px-3 py-2 border rounded-lg" min="0" step="0.1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Time Period (years)' : '‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏õ‡∏µ)'}</label>
                  <input type="number" id="savingsTime" placeholder="${isEnglish ? 'e.g., 5' : '‡πÄ‡∏ä‡πà‡∏ô 5'}" class="w-full px-3 py-2 border rounded-lg" min="0.1" step="0.1">
                </div>
                <button onclick="calculateInterest()" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                  ${isEnglish ? 'Calculate' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}
                </button>
              </div>
            `;
          } else if (type === 'loan') {
            inputsDiv.innerHTML = `
              <h3 class="font-semibold mb-4">${isEnglish ? 'Loan Payment' : '‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞'}</h3>
              <div class="space-y-3">
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Loan Amount (‡∏ø)' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ (‡∏ö‡∏≤‡∏ó)'}</label>
                  <input type="number" id="loanAmount" placeholder="${isEnglish ? 'Total loan amount' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'}" class="w-full px-3 py-2 border rounded-lg" min="1" step="1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Interest Rate (% per year)' : '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ (% ‡∏ï‡πà‡∏≠‡∏õ‡∏µ)'}</label>
                  <input type="number" id="loanRate" placeholder="${isEnglish ? 'e.g., 7.5' : '‡πÄ‡∏ä‡πà‡∏ô 7.5'}" class="w-full px-3 py-2 border rounded-lg" min="0" step="0.1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Loan Term (years)' : '‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≠‡∏ô (‡∏õ‡∏µ)'}</label>
                  <input type="number" id="loanTime" placeholder="${isEnglish ? 'e.g., 3' : '‡πÄ‡∏ä‡πà‡∏ô 3'}" class="w-full px-3 py-2 border rounded-lg" min="0.1" step="0.1">
                </div>
                <button onclick="calculateInterest()" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                  ${isEnglish ? 'Calculate' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}
                </button>
              </div>
            `;
          }
        }

        function calculateInterest() {
          const results = document.getElementById('interestResults');
          const isEnglish = currentLanguage === 'en';
          
          let result;
          
          if (currentInterestType === 'simple') {
            const principal = parseFloat(document.getElementById('simplePrincipal').value);
            const rate = parseFloat(document.getElementById('simpleRate').value);
            const time = parseFloat(document.getElementById('simpleTime').value);
            
            if (!principal || !rate || !time) {
              results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please fill in all fields' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'}</p>`;
              return;
            }
            
            result = calculateSimpleInterestInline(principal, rate, time);
          } else if (currentInterestType === 'compound') {
            const principal = parseFloat(document.getElementById('compoundPrincipal').value);
            const rate = parseFloat(document.getElementById('compoundRate').value);
            const time = parseFloat(document.getElementById('compoundTime').value);
            const freq = parseInt(document.getElementById('compoundFreq').value);
            
            if (!principal || !rate || !time) {
              results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please fill in all fields' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'}</p>`;
              return;
            }
            
            result = calculateCompoundInterestInline(principal, rate, time, freq);
          } else if (currentInterestType === 'savings') {
            const initial = parseFloat(document.getElementById('savingsInitial').value) || 0;
            const monthly = parseFloat(document.getElementById('savingsMonthly').value);
            const rate = parseFloat(document.getElementById('savingsRate').value);
            const time = parseFloat(document.getElementById('savingsTime').value);
            
            if (!monthly || !rate || !time) {
              results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please fill in required fields' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô'}</p>`;
              return;
            }
            
            result = calculateMonthlySavingsInline(monthly, rate, time, initial);
          } else if (currentInterestType === 'loan') {
            const amount = parseFloat(document.getElementById('loanAmount').value);
            const rate = parseFloat(document.getElementById('loanRate').value);
            const time = parseFloat(document.getElementById('loanTime').value);
            
            if (!amount || !rate || !time) {
              results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please fill in all fields' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'}</p>`;
              return;
            }
            
            result = calculateLoanPaymentInline(amount, rate, time);
          }
          
          if (result.error) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? result.errorEN : result.error}</p>`;
            return;
          }
          
          displayInterestResults(result);
        }

        function displayInterestResults(result) {
          const results = document.getElementById('interestResults');
          const isEnglish = currentLanguage === 'en';
          const calc = result.calculation;
          
          if (result.type === 'simple') {
            results.innerHTML = `
              <div class="space-y-4 text-left">
                <div class="p-4 bg-green-50 rounded-lg">
                  <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Simple Interest Results' : '‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤'}</h4>
                  <div class="space-y-2">
                    <div class="flex justify-between">
                      <span>${isEnglish ? 'Principal:' : '‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô:'}</span>
                      <span class="font-medium">‡∏ø${calc.principal.toLocaleString()}</span>
                    </div>
                    <div class="flex justify-between">
                      <span>${isEnglish ? 'Interest:' : '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢:'}</span>
                      <span class="font-medium text-green-600">‡∏ø${calc.interest.toLocaleString()}</span>
                    </div>
                    <hr>
                    <div class="flex justify-between text-lg font-bold">
                      <span>${isEnglish ? 'Total Amount:' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°:'}</span>
                      <span class="text-green-600">‡∏ø${calc.totalAmount.toLocaleString()}</span>
                    </div>
                  </div>
                </div>
                
                <div class="p-3 bg-blue-50 rounded text-sm">
                  <strong>${isEnglish ? 'Formula:' : '‡∏™‡∏π‡∏ï‡∏£:'}</strong><br>
                  ${isEnglish ? 'Interest' : '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢'} = ${calc.principal.toLocaleString()} √ó ${calc.rate}% √ó ${calc.time} ${isEnglish ? 'years' : '‡∏õ‡∏µ'}
                </div>
              </div>
            `;
          } else if (result.type === 'compound') {
            results.innerHTML = `
              <div class="space-y-4 text-left">
                <div class="p-4 bg-purple-50 rounded-lg">
                  <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Compound Interest Results' : '‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ó‡∏ö‡∏ï‡πâ‡∏ô'}</h4>
                  <div class="space-y-2">
                    <div class="flex justify-between">
                      <span>${isEnglish ? 'Principal:' : '‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô:'}</span>
                      <span class="font-medium">‡∏ø${calc.principal.toLocaleString()}</span>
                    </div>
                    <div class="flex justify-between">
                      <span>${isEnglish ? 'Compound Interest:' : '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ó‡∏ö‡∏ï‡πâ‡∏ô:'}</span>
                      <span class="font-medium text-purple-600">‡∏ø${calc.compoundInterest.toLocaleString()}</span>
                    </div>
                    <div class="flex justify-between text-sm text-gray-600">
                      <span>${isEnglish ? 'vs Simple Interest:' : '‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤:'}</span>
                      <span>‡∏ø${calc.simpleInterest.toLocaleString()}</span>
                    </div>
                    <div class="flex justify-between text-sm text-green-600">
                      <span>${isEnglish ? 'Extra from Compounding:' : '‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏ö‡∏ï‡πâ‡∏ô:'}</span>
                      <span>+‡∏ø${calc.extraInterest.toLocaleString()}</span>
                    </div>
                    <hr>
                    <div class="flex justify-between text-lg font-bold">
                      <span>${isEnglish ? 'Total Amount:' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°:'}</span>
                      <span class="text-purple-600">‡∏ø${calc.totalAmount.toLocaleString()}</span>
                    </div>
                  </div>
                </div>
                
                <div class="p-3 bg-blue-50 rounded text-sm">
                  <strong>${isEnglish ? 'Compounding:' : '‡∏Å‡∏≤‡∏£‡∏ó‡∏ö‡∏ï‡πâ‡∏ô:'}</strong>
                  ${calc.compoundFrequency} ${isEnglish ? 'times per year' : '‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏õ‡∏µ'}
                </div>
              </div>
            `;
          } else if (result.type === 'savings') {
            results.innerHTML = `
              <div class="space-y-4 text-left">
                <div class="p-4 bg-blue-50 rounded-lg">
                  <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Savings Results' : '‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô'}</h4>
                  <div class="space-y-2">
                    <div class="flex justify-between">
                      <span>${isEnglish ? 'Total Contributions:' : '‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ù‡∏≤‡∏Å‡∏£‡∏ß‡∏°:'}</span>
                      <span class="font-medium">‡∏ø${calc.totalContributions.toLocaleString()}</span>
                    </div>
                    <div class="flex justify-between">
                      <span>${isEnglish ? 'Interest Earned:' : '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ:'}</span>
                      <span class="font-medium text-blue-600">‡∏ø${calc.totalInterest.toLocaleString()}</span>
                    </div>
                    <hr>
                    <div class="flex justify-between text-lg font-bold">
                      <span>${isEnglish ? 'Final Amount:' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢:'}</span>
                      <span class="text-blue-600">‡∏ø${calc.totalAmount.toLocaleString()}</span>
                    </div>
                  </div>
                </div>
                
                <div class="p-3 bg-green-50 rounded text-sm">
                  <div><strong>${isEnglish ? 'Monthly deposit:' : '‡∏ù‡∏≤‡∏Å‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:'}</strong> ‡∏ø${calc.monthlyAmount.toLocaleString()}</div>
                  <div><strong>${isEnglish ? 'For:' : '‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤:'}</strong> ${calc.years} ${isEnglish ? 'years' : '‡∏õ‡∏µ'} (${calc.years * 12} ${isEnglish ? 'months' : '‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'})</div>
                </div>
              </div>
            `;
          } else if (result.type === 'loan') {
            results.innerHTML = `
              <div class="space-y-4 text-left">
                <div class="p-4 bg-orange-50 rounded-lg">
                  <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Loan Payment Results' : '‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞'}</h4>
                  <div class="space-y-2">
                    <div class="flex justify-between">
                      <span>${isEnglish ? 'Loan Amount:' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ:'}</span>
                      <span class="font-medium">‡∏ø${calc.loanAmount.toLocaleString()}</span>
                    </div>
                    <div class="flex justify-between text-lg font-bold text-orange-600">
                      <span>${isEnglish ? 'Monthly Payment:' : '‡∏ä‡∏≥‡∏£‡∏∞‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:'}</span>
                      <span>‡∏ø${calc.monthlyPayment.toLocaleString()}</span>
                    </div>
                    <div class="flex justify-between">
                      <span>${isEnglish ? 'Total Interest:' : '‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏£‡∏ß‡∏°:'}</span>
                      <span class="font-medium text-red-600">‡∏ø${calc.totalInterest.toLocaleString()}</span>
                    </div>
                    <hr>
                    <div class="flex justify-between text-lg font-bold">
                      <span>${isEnglish ? 'Total Payment:' : '‡∏ä‡∏≥‡∏£‡∏∞‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:'}</span>
                      <span class="text-orange-600">‡∏ø${calc.totalPayment.toLocaleString()}</span>
                    </div>
                  </div>
                </div>
                
                <div class="p-3 bg-yellow-50 rounded text-sm">
                  <div><strong>${isEnglish ? 'Loan term:' : '‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≠‡∏ô:'}</strong> ${calc.years} ${isEnglish ? 'years' : '‡∏õ‡∏µ'} (${calc.years * 12} ${isEnglish ? 'months' : '‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'})</div>
                  <div><strong>${isEnglish ? 'Suggested income:' : '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:'}</strong> ‡∏ø${Math.round(calc.monthlyPayment / 0.3).toLocaleString()}/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (30% rule)</div>
                </div>
              </div>
            `;
          }
        }

        function clearInterestResults() {
          const isEnglish = currentLanguage === 'en';
          document.getElementById('interestResults').innerHTML = `
            <div class="text-center py-8 text-gray-500">
              ${isEnglish ? 'Enter values and calculate to see results' : '‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå'}
            </div>
          `;
        }

        // Initialize with simple interest when page loads
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(() => {
            if (currentInterestType === 'simple' && document.getElementById('interestInputs')) {
              switchInterestType('simple');
            }
          }, 100);
        });

        // ======================
        // DISTANCE CALCULATOR
        // ======================

        // Distance constants (inline version)
        const DISTANCE_CONSTANTS_INLINE = {
          EARTH_RADIUS_KM: 6371,
          TRAVEL_SPEEDS: {
            walking: 5,
            cycling: 15,
            driving: 60,
            flight: 800
          },
          DIRECTIONS: {
            th: ['‡πÄ‡∏´‡∏ô‡∏∑‡∏≠', '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠', '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å', '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÉ‡∏ï‡πâ', 
                 '‡πÉ‡∏ï‡πâ', '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÉ‡∏ï‡πâ', '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å', '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠'],
            en: ['North', 'Northeast', 'East', 'Southeast', 
                 'South', 'Southwest', 'West', 'Northwest']
          },
          POPULAR_PLACES: {
            '‡∏™‡∏¢‡∏≤‡∏°': { lat: 13.7463, lng: 100.5352, name: 'Siam', province: '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø' },
            '‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£': { lat: 13.7997, lng: 100.5497, name: 'Chatuchak', province: '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø' },
            '‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏†‡∏π‡∏°‡∏¥': { lat: 13.6900, lng: 100.7501, name: 'Suvarnabhumi Airport', province: '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø' },
            '‡∏î‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á': { lat: 13.9126, lng: 100.6070, name: 'Don Mueang Airport', province: '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø' },
            '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà': { lat: 18.7883, lng: 98.9853, name: 'Chiang Mai', province: '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà' },
            '‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï': { lat: 7.8804, lng: 98.3923, name: 'Phuket', province: '‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï' },
            '‡∏û‡∏±‡∏ó‡∏¢‡∏≤': { lat: 12.9236, lng: 100.8825, name: 'Pattaya', province: '‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ' },
            '‡∏´‡∏±‡∏ß‡∏´‡∏¥‡∏ô': { lat: 12.5564, lng: 99.9587, name: 'Hua Hin', province: '‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå' }
          }
        };

        function calculateHaversineDistanceInline(lat1, lng1, lat2, lng2, unit = 'km') {
          const toRad = (deg) => deg * (Math.PI / 180);
          
          const dLat = toRad(lat2 - lat1);
          const dLng = toRad(lng2 - lng1);
          
          const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                    Math.sin(dLng / 2) * Math.sin(dLng / 2);
          
          const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
          
          return DISTANCE_CONSTANTS_INLINE.EARTH_RADIUS_KM * c;
        }

        function calculateBearingInline(lat1, lng1, lat2, lng2) {
          const toRad = (deg) => deg * (Math.PI / 180);
          const toDeg = (rad) => rad * (180 / Math.PI);
          
          const dLng = toRad(lng2 - lng1);
          const lat1Rad = toRad(lat1);
          const lat2Rad = toRad(lat2);
          
          const y = Math.sin(dLng) * Math.cos(lat2Rad);
          const x = Math.cos(lat1Rad) * Math.sin(lat2Rad) - 
                    Math.sin(lat1Rad) * Math.cos(lat2Rad) * Math.cos(dLng);
          
          let bearing = toDeg(Math.atan2(y, x));
          bearing = (bearing + 360) % 360;
          
          const directionIndex = Math.round(bearing / 45) % 8;
          
          return {
            degrees: Math.round(bearing * 10) / 10,
            direction: {
              th: DISTANCE_CONSTANTS_INLINE.DIRECTIONS.th[directionIndex],
              en: DISTANCE_CONSTANTS_INLINE.DIRECTIONS.en[directionIndex]
            }
          };
        }

        function calculateTravelTimeInline(distance) {
          const speeds = DISTANCE_CONSTANTS_INLINE.TRAVEL_SPEEDS;
          
          const formatTime = (hours, isEnglish = false) => {
            if (hours < 1) {
              return isEnglish ? `${Math.round(hours * 60)} min` : `${Math.round(hours * 60)} ‡∏ô‡∏≤‡∏ó‡∏µ`;
            } else if (hours < 24) {
              const h = Math.floor(hours);
              const m = Math.round((hours - h) * 60);
              if (isEnglish) {
                return m > 0 ? `${h}h ${m}min` : `${h}h`;
              } else {
                return m > 0 ? `${h} ‡∏ä‡∏°. ${m} ‡∏ô‡∏≤‡∏ó‡∏µ` : `${h} ‡∏ä‡∏°.`;
              }
            } else {
              const days = Math.floor(hours / 24);
              const remainingHours = Math.round(hours % 24);
              if (isEnglish) {
                return `${days}d ${remainingHours}h`;
              } else {
                return `${days} ‡∏ß‡∏±‡∏ô ${remainingHours} ‡∏ä‡∏°.`;
              }
            }
          };
          
          return {
            walking: {
              hours: distance / speeds.walking,
              display: formatTime(distance / speeds.walking),
              displayEN: formatTime(distance / speeds.walking, true)
            },
            cycling: {
              hours: distance / speeds.cycling,
              display: formatTime(distance / speeds.cycling),
              displayEN: formatTime(distance / speeds.cycling, true)
            },
            driving: {
              hours: distance / speeds.driving,
              display: formatTime(distance / speeds.driving),
              displayEN: formatTime(distance / speeds.driving, true)
            },
            flight: {
              hours: distance / speeds.flight,
              display: formatTime(distance / speeds.flight),
              displayEN: formatTime(distance / speeds.flight, true)
            }
          };
        }

        async function searchPlaceInline(query) {
          if (!query || query.trim().length < 2) return [];
          
          // Search in popular places first
          const popularResults = searchInPopularPlacesInline(query);
          
          try {
            const url = `https://nominatim.openstreetmap.org/search?` +
              `q=${encodeURIComponent(query.trim())}&` +
              `format=json&limit=3&countrycodes=th&addressdetails=1`;
            
            const response = await fetch(url);
            const data = await response.json();
            
            const nominatimResults = data.map(place => ({
              name: place.display_name,
              lat: parseFloat(place.lat),
              lng: parseFloat(place.lon),
              source: 'nominatim'
            }));
            
            return [...popularResults, ...nominatimResults].slice(0, 5);
          } catch (error) {
            console.warn('Nominatim API error:', error);
            return popularResults;
          }
        }

        function searchInPopularPlacesInline(query) {
          const queryLower = query.toLowerCase().trim();
          const results = [];
          
          for (const [key, place] of Object.entries(DISTANCE_CONSTANTS_INLINE.POPULAR_PLACES)) {
            const keyLower = key.toLowerCase();
            const nameLower = place.name.toLowerCase();
            
            if (keyLower.includes(queryLower) || nameLower.includes(queryLower)) {
              results.push({
                name: `${key} (${place.province})`,
                lat: place.lat,
                lng: place.lng,
                source: 'popular'
              });
            }
          }
          
          return results;
        }

        function getCurrentLocationInline() {
          return new Promise((resolve, reject) => {
            if (!navigator.geolocation) {
              reject(new Error('Browser ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS'));
              return;
            }
            
            const options = {
              enableHighAccuracy: true,
              timeout: 10000,
              maximumAge: 300000
            };
            
            navigator.geolocation.getCurrentPosition(
              (position) => {
                resolve({
                  lat: position.coords.latitude,
                  lng: position.coords.longitude,
                  name: '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô',
                  nameEN: 'Current Location',
                  source: 'gps'
                });
              },
              (error) => {
                let message;
                switch (error.code) {
                  case error.PERMISSION_DENIED:
                    message = '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á';
                    break;
                  case error.POSITION_UNAVAILABLE:
                    message = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ';
                    break;
                  case error.TIMEOUT:
                    message = '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á';
                    break;
                  default:
                    message = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á';
                    break;
                }
                reject(new Error(message));
              },
              options
            );
          });
        }

        function parseCoordinatesInline(coordText) {
          if (!coordText || typeof coordText !== 'string') return null;
          
          const parts = coordText.trim().split(',');
          if (parts.length !== 2) return null;
          
          const lat = parseFloat(parts[0].trim());
          const lng = parseFloat(parts[1].trim());
          
          if (lat >= -90 && lat <= 90 && lng >= -180 && lng <= 180) {
            return { lat, lng };
          }
          
          return null;
        }

        function getDistanceCalculatorHTML() {
          const isEnglish = currentLanguage === 'en';
          
          return `
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold mb-4">${isEnglish ? 'Location Input' : '‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á'}</h3>
                <div class="space-y-4">
                  
                  <!-- From Location -->
                  <div>
                    <label class="block text-sm font-medium mb-2">
                      üìç ${isEnglish ? 'From (Starting Point)' : '‡∏à‡∏≤‡∏Å (‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)'}
                    </label>
                    <div class="space-y-2">
                      <input type="text" id="fromInput" placeholder="${isEnglish ? 'Search place, use GPS, or enter coordinates' : '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà, ‡πÉ‡∏ä‡πâ GPS, ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà‡∏û‡∏¥‡∏Å‡∏±‡∏î'}" 
                             class="w-full px-3 py-2 border rounded-lg" onkeyup="handleLocationSearch('from')">
                      <div class="flex gap-2">
                        <button onclick="useCurrentLocation('from')" class="px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                          üìç ${isEnglish ? 'Use GPS' : '‡πÉ‡∏ä‡πâ GPS'}
                        </button>
                        <button onclick="clearLocation('from')" class="px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
                          üóëÔ∏è ${isEnglish ? 'Clear' : '‡∏•‡πâ‡∏≤‡∏á'}
                        </button>
                      </div>
                      <div id="fromSuggestions" class="hidden space-y-1"></div>
                    </div>
                  </div>
                  
                  <!-- To Location -->
                  <div>
                    <label class="block text-sm font-medium mb-2">
                      üéØ ${isEnglish ? 'To (Destination)' : '‡πÑ‡∏õ (‡∏à‡∏∏‡∏î‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á)'}
                    </label>
                    <div class="space-y-2">
                      <input type="text" id="toInput" placeholder="${isEnglish ? 'Search place, use GPS, or enter coordinates' : '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà, ‡πÉ‡∏ä‡πâ GPS, ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà‡∏û‡∏¥‡∏Å‡∏±‡∏î'}" 
                             class="w-full px-3 py-2 border rounded-lg" onkeyup="handleLocationSearch('to')">
                      <div class="flex gap-2">
                        <button onclick="useCurrentLocation('to')" class="px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200">
                          üìç ${isEnglish ? 'Use GPS' : '‡πÉ‡∏ä‡πâ GPS'}
                        </button>
                        <button onclick="clearLocation('to')" class="px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
                          üóëÔ∏è ${isEnglish ? 'Clear' : '‡∏•‡πâ‡∏≤‡∏á'}
                        </button>
                      </div>
                      <div id="toSuggestions" class="hidden space-y-1"></div>
                    </div>
                  </div>
                  
                  <!-- Options -->
                  <div class="border-t pt-4">
                    <h4 class="font-medium mb-3">${isEnglish ? 'Options' : '‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å'}</h4>
                    <div class="space-y-2">
                      <label class="flex items-center">
                        <input type="checkbox" id="showDirection" checked class="mr-2">
                        <span class="text-sm">${isEnglish ? 'Show direction' : '‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á'}</span>
                      </label>
                      <label class="flex items-center">
                        <input type="checkbox" id="showTravelTime" checked class="mr-2">
                        <span class="text-sm">${isEnglish ? 'Calculate travel time' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á'}</span>
                      </label>
                      <label class="flex items-center">
                        <input type="checkbox" id="showMidpoint" class="mr-2">
                        <span class="text-sm">${isEnglish ? 'Find midpoint' : '‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á'}</span>
                      </label>
                    </div>
                  </div>
                  
                  <button onclick="calculateDistanceMap()" class="w-full px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">
                    üìè ${isEnglish ? 'Calculate Distance' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á'}
                  </button>
                  
                  <div class="text-xs text-gray-500 space-y-1">
                    <p>${isEnglish ? '‚Ä¢ Coordinates format: latitude, longitude (e.g., 13.7463, 100.5352)' : '‚Ä¢ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î: ‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î, ‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î (‡πÄ‡∏ä‡πà‡∏ô 13.7463, 100.5352)'}</p>
                    <p>${isEnglish ? '‚Ä¢ Distance calculated using Haversine formula' : '‚Ä¢ ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏π‡∏ï‡∏£ Haversine'}</p>
                  </div>
                </div>
              </div>
              
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold mb-4">${isEnglish ? 'Distance Results' : '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á'}</h3>
                <div id="distanceResults" class="text-center py-8 text-gray-500">
                  ${isEnglish ? 'Enter starting point and destination, then calculate' : '‡πÉ‡∏™‡πà‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}
                </div>
              </div>
            </div>
          `;
        }

        // Global variables for distance calculator
        let fromLocation = null;
        let toLocation = null;
        let searchTimeouts = {};

        function handleLocationSearch(type) {
          const input = document.getElementById(type + 'Input');
          const suggestions = document.getElementById(type + 'Suggestions');
          const query = input.value.trim();
          
          // Clear previous timeout
          if (searchTimeouts[type]) {
            clearTimeout(searchTimeouts[type]);
          }
          
          if (query.length < 2) {
            suggestions.innerHTML = '';
            suggestions.classList.add('hidden');
            return;
          }
          
          // Check if it's coordinates
          const coords = parseCoordinatesInline(query);
          if (coords) {
            showCoordinateSuggestion(type, coords, query);
            return;
          }
          
          // Debounce search
          searchTimeouts[type] = setTimeout(async () => {
            try {
              const results = await searchPlaceInline(query);
              showSearchSuggestions(type, results);
            } catch (error) {
              console.error('Search error:', error);
            }
          }, 500);
        }

        function showCoordinateSuggestion(type, coords, query) {
          const suggestions = document.getElementById(type + 'Suggestions');
          const isEnglish = currentLanguage === 'en';
          
          suggestions.innerHTML = `
            <div class="p-2 border rounded bg-yellow-50 cursor-pointer hover:bg-yellow-100" 
                 onclick="selectLocation('${type}', ${coords.lat}, ${coords.lng}, '${query}')">
              üìç ${isEnglish ? 'Coordinates:' : '‡∏û‡∏¥‡∏Å‡∏±‡∏î:'} ${coords.lat.toFixed(4)}, ${coords.lng.toFixed(4)}
            </div>
          `;
          suggestions.classList.remove('hidden');
        }

        function showSearchSuggestions(type, results) {
          const suggestions = document.getElementById(type + 'Suggestions');
          
          if (results.length === 0) {
            suggestions.innerHTML = '<div class="p-2 text-gray-500 text-sm">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</div>';
            suggestions.classList.remove('hidden');
            return;
          }
          
          suggestions.innerHTML = results.map(place => `
            <div class="p-2 border rounded bg-white cursor-pointer hover:bg-gray-50" 
                 onclick="selectLocation('${type}', ${place.lat}, ${place.lng}, '${place.name}')">
              üìç ${place.name}
              ${place.source === 'popular' ? '<span class="text-xs text-blue-600">(‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°)</span>' : ''}
            </div>
          `).join('');
          
          suggestions.classList.remove('hidden');
        }

        function selectLocation(type, lat, lng, name) {
          const input = document.getElementById(type + 'Input');
          const suggestions = document.getElementById(type + 'Suggestions');
          
          input.value = name;
          suggestions.innerHTML = '';
          suggestions.classList.add('hidden');
          
          if (type === 'from') {
            fromLocation = { lat, lng, name };
          } else {
            toLocation = { lat, lng, name };
          }
        }

        async function useCurrentLocation(type) {
          const input = document.getElementById(type + 'Input');
          const isEnglish = currentLanguage === 'en';
          
          input.value = isEnglish ? 'Getting location...' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...';
          
          try {
            const location = await getCurrentLocationInline();
            input.value = isEnglish ? location.nameEN : location.name;
            
            if (type === 'from') {
              fromLocation = location;
            } else {
              toLocation = location;
            }
          } catch (error) {
            input.value = '';
            alert(error.message);
          }
        }

        function clearLocation(type) {
          const input = document.getElementById(type + 'Input');
          const suggestions = document.getElementById(type + 'Suggestions');
          
          input.value = '';
          suggestions.innerHTML = '';
          suggestions.classList.add('hidden');
          
          if (type === 'from') {
            fromLocation = null;
          } else {
            toLocation = null;
          }
        }

        function calculateDistanceMap() {
          const results = document.getElementById('distanceResults');
          const isEnglish = currentLanguage === 'en';
          
          if (!fromLocation || !toLocation) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please select both starting point and destination' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà'}</p>`;
            return;
          }
          
          // Calculate distance
          const distance = calculateHaversineDistanceInline(
            fromLocation.lat, fromLocation.lng,
            toLocation.lat, toLocation.lng
          );
          
          const showDirection = document.getElementById('showDirection').checked;
          const showTravelTime = document.getElementById('showTravelTime').checked;
          const showMidpoint = document.getElementById('showMidpoint').checked;
          
          let bearing = null;
          let travelTime = null;
          let midpoint = null;
          
          if (showDirection) {
            bearing = calculateBearingInline(
              fromLocation.lat, fromLocation.lng,
              toLocation.lat, toLocation.lng
            );
          }
          
          if (showTravelTime) {
            travelTime = calculateTravelTimeInline(distance);
          }
          
          if (showMidpoint) {
            const midLat = (fromLocation.lat + toLocation.lat) / 2;
            const midLng = (fromLocation.lng + toLocation.lng) / 2;
            midpoint = { lat: midLat, lng: midLng };
          }
          
          displayDistanceResults({
            distance,
            fromLocation,
            toLocation,
            bearing,
            travelTime,
            midpoint
          });
        }

        function displayDistanceResults(result) {
          const results = document.getElementById('distanceResults');
          const isEnglish = currentLanguage === 'en';
          const { distance, fromLocation, toLocation, bearing, travelTime, midpoint } = result;
          
          let html = `
            <div class="space-y-4 text-left">
              <!-- Route -->
              <div class="p-4 bg-orange-50 rounded-lg border-l-4 border-orange-400">
                <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Route Information' : '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á'}</h4>
                <div class="space-y-1 text-sm">
                  <div><strong>${isEnglish ? 'From:' : '‡∏à‡∏≤‡∏Å:'}</strong> ${fromLocation.name}</div>
                  <div><strong>${isEnglish ? 'To:' : '‡πÑ‡∏õ:'}</strong> ${toLocation.name}</div>
                </div>
              </div>
              
              <!-- Distance -->
              <div class="p-4 bg-green-50 rounded-lg">
                <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Distance' : '‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á'}</h4>
                <div class="text-2xl font-bold text-green-600 mb-2">
                  ${distance.toFixed(2)} ${isEnglish ? 'km' : '‡∏Å‡∏°.'}
                </div>
                <div class="text-sm text-gray-600">
                  ${(distance * 0.621371).toFixed(2)} ${isEnglish ? 'miles' : '‡πÑ‡∏°‡∏•‡πå'}
                </div>
              </div>
          `;
          
          // Direction
          if (bearing) {
            html += `
              <div class="p-4 bg-blue-50 rounded-lg">
                <h4 class="font-semibold mb-2">${isEnglish ? 'Direction' : '‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á'}</h4>
                <div class="text-lg font-semibold text-blue-600">
                  ${isEnglish ? bearing.direction.en : bearing.direction.th}
                </div>
                <div class="text-sm text-gray-600">
                  ${bearing.degrees}¬∞ ${isEnglish ? 'from North' : '‡∏à‡∏≤‡∏Å‡∏ó‡∏¥‡∏®‡πÄ‡∏´‡∏ô‡∏∑‡∏≠'}
                </div>
              </div>
            `;
          }
          
          // Travel Time
          if (travelTime) {
            html += `
              <div class="p-4 bg-purple-50 rounded-lg">
                <h4 class="font-semibold mb-2">${isEnglish ? 'Estimated Travel Time' : '‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì'}</h4>
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <div class="flex justify-between">
                    <span>üö∂ ${isEnglish ? 'Walking:' : '‡πÄ‡∏î‡∏¥‡∏ô:'}</span>
                    <span class="font-medium">${isEnglish ? travelTime.walking.displayEN : travelTime.walking.display}</span>
                  </div>
                  <div class="flex justify-between">
                    <span>üöó ${isEnglish ? 'Driving:' : '‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ:'}</span>
                    <span class="font-medium">${isEnglish ? travelTime.driving.displayEN : travelTime.driving.display}</span>
                  </div>
                  <div class="flex justify-between">
                    <span>üö¥ ${isEnglish ? 'Cycling:' : '‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô:'}</span>
                    <span class="font-medium">${isEnglish ? travelTime.cycling.displayEN : travelTime.cycling.display}</span>
                  </div>
                  <div class="flex justify-between">
                    <span>‚úàÔ∏è ${isEnglish ? 'Flight:' : '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô:'}</span>
                    <span class="font-medium">${isEnglish ? travelTime.flight.displayEN : travelTime.flight.display}</span>
                  </div>
                </div>
              </div>
            `;
          }
          
          // Midpoint
          if (midpoint) {
            html += `
              <div class="p-4 bg-yellow-50 rounded-lg">
                <h4 class="font-semibold mb-2">${isEnglish ? 'Midpoint' : '‡∏à‡∏∏‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á'}</h4>
                <div class="text-sm">
                  <strong>${isEnglish ? 'Coordinates:' : '‡∏û‡∏¥‡∏Å‡∏±‡∏î:'}</strong><br>
                  ${midpoint.lat.toFixed(6)}, ${midpoint.lng.toFixed(6)}
                </div>
              </div>
            `;
          }
          
          // Coordinates
          html += `
            <div class="p-3 bg-gray-100 rounded text-sm">
              <div class="grid grid-cols-1 gap-1">
                <div><strong>${isEnglish ? 'From coordinates:' : '‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:'}</strong> ${fromLocation.lat.toFixed(6)}, ${fromLocation.lng.toFixed(6)}</div>
                <div><strong>${isEnglish ? 'To coordinates:' : '‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏∏‡∏î‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á:'}</strong> ${toLocation.lat.toFixed(6)}, ${toLocation.lng.toFixed(6)}</div>
              </div>
            </div>
          `;
          
          // Note
          html += `
            <div class="p-3 bg-blue-50 rounded text-sm border-l-4 border-blue-400">
              <strong>${isEnglish ? 'Note:' : '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:'}</strong>
              ${isEnglish ? 'Straight-line distance calculated using Haversine formula. Actual travel distance may vary.' : '‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏π‡∏ï‡∏£ Haversine ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏≤‡∏à‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á'}
            </div>
          `;
          
          html += '</div>';
          results.innerHTML = html;
        }

        // Hide suggestions when clicking outside
        document.addEventListener('click', function(event) {
          const fromSuggestions = document.getElementById('fromSuggestions');
          const toSuggestions = document.getElementById('toSuggestions');
          const fromInput = document.getElementById('fromInput');
          const toInput = document.getElementById('toInput');
          
          if (fromSuggestions && !fromInput?.contains(event.target) && !fromSuggestions.contains(event.target)) {
            fromSuggestions.classList.add('hidden');
          }
          
          if (toSuggestions && !toInput?.contains(event.target) && !toSuggestions.contains(event.target)) {
            toSuggestions.classList.add('hidden');
          }
        });

        // Solar Calculator Functions
        function getSolarCalculatorHTML() {
          const isEnglish = currentLanguage === 'en';
          
          return `
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- Input Section -->
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold mb-4">${isEnglish ? 'Basic Information' : '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô'}</h3>
                <div class="space-y-4">
                  <!-- Core Inputs -->
                  <div>
                    <label class="block text-sm font-medium mb-2">${isEnglish ? 'Roof Area (sqm)' : '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤ (‡∏ï‡∏£.‡∏°.)'}</label>
                    <input type="number" id="solarRoofArea" placeholder="${isEnglish ? 'Enter roof area in square meters' : '‡πÉ‡∏™‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏°‡∏ï‡∏£'}" 
                           class="w-full px-3 py-2 border rounded-lg" min="1" step="0.1">
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-2">${isEnglish ? 'Monthly Electricity Usage (kWh)' : '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏´‡∏ô‡πà‡∏ß‡∏¢)'}</label>
                    <input type="number" id="solarMonthlyUsage" placeholder="${isEnglish ? 'Enter monthly electricity usage' : '‡πÉ‡∏™‡πà‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}" 
                           class="w-full px-3 py-2 border rounded-lg" min="0" step="1">
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-2">${isEnglish ? 'Region' : '‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ'}</label>
                    <select id="solarRegion" class="w-full px-3 py-2 border rounded-lg">
                      <option value="central">${isEnglish ? 'Central (Bangkok)' : '‡∏†‡∏≤‡∏Ñ‡∏Å‡∏•‡∏≤‡∏á (‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø)'}</option>
                      <option value="north">${isEnglish ? 'Northern (Chiang Mai)' : '‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ (‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà)'}</option>
                      <option value="northeast">${isEnglish ? 'Northeastern (Isaan)' : '‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ (‡∏≠‡∏µ‡∏™‡∏≤‡∏ô)'}</option>
                      <option value="south">${isEnglish ? 'Southern (Phuket)' : '‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ (‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï)'}</option>
                      <option value="east">${isEnglish ? 'Eastern (Pattaya)' : '‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å (‡∏û‡∏±‡∏ó‡∏¢‡∏≤)'}</option>
                    </select>
                  </div>

                  <!-- Expandable Advanced Options -->
                  <div class="expandable-section">
                    <button type="button" onclick="toggleSolarAdvanced()" class="w-full flex items-center justify-between p-3 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors">
                      <span class="font-medium text-blue-700">${isEnglish ? '‚öôÔ∏è Advanced Options' : '‚öôÔ∏è ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á'}</span>
                      <svg id="solarAdvancedIcon" class="w-5 h-5 text-blue-600 expand-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                      </svg>
                    </button>
                    <div id="solarAdvancedContent" class="expandable-content mt-3">
                      <div class="space-y-3 p-3 bg-white rounded border">
                        <div>
                          <label class="block text-sm font-medium mb-1">${isEnglish ? 'Panel Type' : '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏ú‡∏á‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå'}</label>
                          <select id="solarPanelType" class="w-full px-3 py-2 border rounded-lg text-sm">
                            <option value="monocrystalline">${isEnglish ? 'Monocrystalline (20% eff.)' : '‡πÇ‡∏°‡πÇ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡∏±‡∏•‡πÑ‡∏•‡∏ô‡πå (‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û 20%)'}</option>
                            <option value="polycrystalline">${isEnglish ? 'Polycrystalline (17% eff.)' : '‡πÇ‡∏û‡∏•‡∏µ‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡∏±‡∏•‡πÑ‡∏•‡∏ô‡πå (‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û 17%)'}</option>
                            <option value="thinfilm">${isEnglish ? 'Thin Film (13% eff.)' : '‡∏ü‡∏¥‡∏•‡πå‡∏°‡∏ö‡∏≤‡∏á (‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û 13%)'}</option>
                          </select>
                        </div>
                        <div>
                          <label class="block text-sm font-medium mb-1">${isEnglish ? 'Electricity Provider' : '‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤'}</label>
                          <select id="solarProvider" class="w-full px-3 py-2 border rounded-lg text-sm">
                            <option value="mea">${isEnglish ? 'MEA (Bangkok Metro)' : 'MEA (‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ô‡∏Ñ‡∏£‡∏´‡∏•‡∏ß‡∏á)'}</option>
                            <option value="pea">${isEnglish ? 'PEA (Provincial)' : 'PEA (‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ)'}</option>
                          </select>
                        </div>
                        <div>
                          <label class="block text-sm font-medium mb-1">${isEnglish ? 'Usable Roof Area (%)' : '‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ (%)'}</label>
                          <input type="number" id="solarUsableRatio" value="80" class="w-full px-3 py-2 border rounded-lg text-sm" min="10" max="100" step="5">
                        </div>
                        <div>
                          <label class="block text-sm font-medium mb-1">${isEnglish ? 'Performance Ratio (%)' : '‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á (%)'}</label>
                          <input type="number" id="solarPerformance" value="85" class="w-full px-3 py-2 border rounded-lg text-sm" min="60" max="95" step="1">
                        </div>
                        <div>
                          <label class="block text-sm font-medium mb-1">${isEnglish ? 'Shading Loss (%)' : '‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏≤ (%)'}</label>
                          <input type="number" id="solarShading" value="5" class="w-full px-3 py-2 border rounded-lg text-sm" min="0" max="30" step="1">
                        </div>
                        
                        <!-- Manual Override Section -->
                        <div class="border-t pt-3 mt-3">
                          <div class="text-sm font-medium text-gray-700 mb-2">${isEnglish ? 'üîß Manual Override (Optional)' : 'üîß ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)'}</div>
                          <div class="grid grid-cols-2 gap-2">
                            <div>
                              <label class="block text-xs font-medium mb-1">${isEnglish ? 'System Capacity (kWp)' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ú‡∏•‡∏¥‡∏ï (kWp)'}</label>
                              <input type="number" id="solarManualCapacity" placeholder="${isEnglish ? 'Auto calculate' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥'}" 
                                     class="w-full px-2 py-1 border rounded text-xs" min="0.1" max="1000" step="0.1">
                              <div class="text-xs text-gray-500 mt-1">${isEnglish ? 'Leave empty for auto' : '‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥'}</div>
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1">${isEnglish ? 'System Cost (‡∏ø)' : '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡∏ö‡∏≤‡∏ó)'}</label>
                              <input type="number" id="solarManualCost" placeholder="${isEnglish ? 'Auto calculate' : '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥'}" 
                                     class="w-full px-2 py-1 border rounded text-xs" min="1000" max="10000000" step="1000">
                              <div class="text-xs text-gray-500 mt-1">${isEnglish ? 'Leave empty for auto' : '‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥'}</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <button onclick="calculateSolar()" class="w-full px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-medium">
                    ${isEnglish ? '‚òÄÔ∏è Calculate Solar ROI' : '‚òÄÔ∏è ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå'}
                  </button>
                </div>
              </div>

              <!-- Results Section -->
              <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-semibold mb-4">${isEnglish ? 'Solar Analysis Results' : '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå'}</h3>
                <div id="solarResults" class="text-center py-8 text-gray-500">
                  ${isEnglish ? 'Enter your roof area and electricity usage to see results' : '‡πÉ‡∏™‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå'}
                </div>
              </div>
            </div>
          `;
        }

        function toggleSolarAdvanced() {
          const content = document.getElementById('solarAdvancedContent');
          const icon = document.getElementById('solarAdvancedIcon');
          
          if (content.classList.contains('expanded')) {
            content.classList.remove('expanded');
            icon.classList.remove('rotated');
          } else {
            content.classList.add('expanded');
            icon.classList.add('rotated');
          }
        }

        function calculateSolar() {
          const roofArea = parseFloat(document.getElementById('solarRoofArea').value);
          const monthlyUsage = parseFloat(document.getElementById('solarMonthlyUsage').value);
          const region = document.getElementById('solarRegion').value;
          const panelType = document.getElementById('solarPanelType').value;
          const provider = document.getElementById('solarProvider').value;
          const usableRatio = parseFloat(document.getElementById('solarUsableRatio').value) / 100;
          const performance = parseFloat(document.getElementById('solarPerformance').value) / 100;
          const shading = parseFloat(document.getElementById('solarShading').value) / 100;
          
          // Manual override inputs
          const manualCapacity = parseFloat(document.getElementById('solarManualCapacity').value);
          const manualCost = parseFloat(document.getElementById('solarManualCost').value);
          
          const results = document.getElementById('solarResults');
          const isEnglish = currentLanguage === 'en';
          
          if (!monthlyUsage || monthlyUsage <= 0) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please enter valid monthly electricity usage' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'}</p>`;
            return;
          }
          
          // Determine capacity: manual input or auto-calculate from roof area
          let capacity, isManualCapacity = false;
          if (manualCapacity && manualCapacity > 0) {
            // Use manual capacity
            isManualCapacity = true;
            capacity = {
              success: true,
              roofArea: roofArea || 0,
              usableArea: roofArea ? Math.round(roofArea * usableRatio * 100) / 100 : 0,
              panelType,
              capacity: {
                wp: Math.round(manualCapacity * 1000),
                kWp: Math.round(manualCapacity * 100) / 100
              },
              panelInfo: { efficiency: 0.20, name: 'Manual Input' }
            };
          } else {
            // Auto-calculate from roof area
            if (!roofArea || roofArea <= 0) {
              results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please enter valid roof area or specify manual capacity in Advanced Options' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ú‡∏•‡∏¥‡∏ï‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á'}</p>`;
              return;
            }
            capacity = calculateSolarCapacityInline(roofArea, panelType, usableRatio);
            if (capacity.error) {
              results.innerHTML = `<p class="text-red-500">${isEnglish ? capacity.errorEN : capacity.error}</p>`;
              return;
            }
          }
          
          const production = calculateEnergyProductionInline(capacity.capacity.kWp, region, { performanceRatio: performance, shadingLoss: shading });
          if (production.error) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? production.errorEN : production.error}</p>`;
            return;
          }
          
          const electricityBill = calculateElectricityBillInline(monthlyUsage, provider);
          if (electricityBill.error) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? electricityBill.errorEN : electricityBill.error}</p>`;
            return;
          }
          
          // Determine system cost: manual input or auto-calculate
          let systemCost, isManualCost = false;
          if (manualCost && manualCost > 0) {
            // Use manual cost
            isManualCost = true;
            systemCost = {
              success: true,
              capacity: capacity.capacity.kWp,
              costPerKwp: Math.round(manualCost / capacity.capacity.kWp),
              totalCost: Math.round(manualCost),
              category: { name: 'Manual Input' },
              breakdown: {
                equipment: Math.round(manualCost * 0.7),
                installation: Math.round(manualCost * 0.2),
                permits: Math.round(manualCost * 0.1)
              }
            };
          } else {
            // Auto-calculate cost
            systemCost = estimateSystemCostInline(capacity.capacity.kWp);
          }
          const savings = calculateSavingsAndROIInline(production, electricityBill, systemCost.totalCost);
          
          displaySolarResults({
            capacity,
            production,
            electricityBill,
            systemCost,
            savings,
            roofArea,
            monthlyUsage,
            region,
            isManualCapacity,
            isManualCost
          });
        }

        function displaySolarResults(data) {
          const results = document.getElementById('solarResults');
          const isEnglish = currentLanguage === 'en';
          const { capacity, production, electricityBill, systemCost, savings, isManualCapacity, isManualCost } = data;
          
          results.innerHTML = `
            <div class="space-y-4 text-left">
              <!-- System Summary -->
              <div class="p-4 bg-orange-50 rounded-lg border-l-4 border-orange-400">
                <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'System Configuration' : '‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö'}</h4>
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <div>
                    <strong>${isEnglish ? 'Capacity:' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ú‡∏•‡∏¥‡∏ï:'}</strong> ${capacity.capacity.kWp} kWp
                    ${isManualCapacity ? `<span class="ml-1 px-1 bg-blue-100 text-blue-600 text-xs rounded">${isEnglish ? 'Manual' : '‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á'}</span>` : `<span class="ml-1 px-1 bg-green-100 text-green-600 text-xs rounded">${isEnglish ? 'Auto' : '‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥'}</span>`}
                  </div>
                  <div><strong>${isEnglish ? 'Usable Area:' : '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:'}</strong> ${capacity.usableArea} ${isEnglish ? 'sqm' : '‡∏ï‡∏£.‡∏°.'}</div>
                  <div><strong>${isEnglish ? 'Panel Type:' : '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏ú‡∏á:'}</strong> ${capacity.panelInfo.name}</div>
                  <div><strong>${isEnglish ? 'Efficiency:' : '‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û:'}</strong> ${(capacity.panelInfo.efficiency * 100)}%</div>
                </div>
              </div>

              <!-- Energy Production -->
              <div class="p-4 bg-green-50 rounded-lg">
                <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Energy Production' : '‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô'}</h4>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div class="text-center">
                    <div class="font-semibold text-green-600">${production.production.daily} kWh</div>
                    <div class="text-gray-600">${isEnglish ? 'Daily' : '‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô'}</div>
                  </div>
                  <div class="text-center">
                    <div class="font-semibold text-green-600">${production.production.monthly} kWh</div>
                    <div class="text-gray-600">${isEnglish ? 'Monthly' : '‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}</div>
                  </div>
                  <div class="text-center">
                    <div class="font-semibold text-green-600">${production.production.yearly} kWh</div>
                    <div class="text-gray-600">${isEnglish ? 'Yearly' : '‡∏£‡∏≤‡∏¢‡∏õ‡∏µ'}</div>
                  </div>
                </div>
                <div class="mt-2 text-xs text-gray-500">
                  ${isEnglish ? 'Solar Irradiance:' : '‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏â‡∏≤‡∏¢‡πÅ‡∏™‡∏á:'} ${production.region.irradiance} kWh/m¬≤/day (${isEnglish ? production.region.nameEN : production.region.name})
                </div>
              </div>

              <!-- Financial Analysis -->
              <div class="p-4 bg-blue-50 rounded-lg">
                <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Financial Analysis' : '‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô'}</h4>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between">
                    <span>
                      ${isEnglish ? 'System Cost:' : '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏∞‡∏ö‡∏ö:'}
                      ${isManualCost ? `<span class="ml-1 px-1 bg-blue-100 text-blue-600 text-xs rounded">${isEnglish ? 'Manual' : '‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á'}</span>` : `<span class="ml-1 px-1 bg-green-100 text-green-600 text-xs rounded">${isEnglish ? 'Auto' : '‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥'}</span>`}
                    </span>
                    <span class="font-medium">‡∏ø${systemCost.totalCost.toLocaleString()}</span>
                  </div>
                  <div class="flex justify-between">
                    <span>${isEnglish ? 'Monthly Savings:' : '‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:'}</span>
                    <span class="font-medium text-green-600">‡∏ø${savings.savings.monthly.toLocaleString()}</span>
                  </div>
                  <div class="flex justify-between">
                    <span>${isEnglish ? 'Yearly Savings:' : '‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏õ‡∏µ:'}</span>
                    <span class="font-medium text-green-600">‡∏ø${savings.savings.yearly.toLocaleString()}</span>
                  </div>
                  <div class="flex justify-between border-t pt-2">
                    <span class="font-semibold">${isEnglish ? 'Payback Period:' : '‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏∏‡∏ô:'}</span>
                    <span class="font-semibold text-blue-600">${savings.investment.paybackYears} ${isEnglish ? 'years' : '‡∏õ‡∏µ'}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="font-semibold">${isEnglish ? '25-Year ROI:' : 'ROI 25 ‡∏õ‡∏µ:'}</span>
                    <span class="font-semibold text-blue-600">${savings.investment.roi}%</span>
                  </div>
                </div>
              </div>

              <!-- Energy Independence -->
              <div class="p-4 bg-purple-50 rounded-lg">
                <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Energy Independence' : '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¥‡∏™‡∏£‡∏∞‡∏ó‡∏≤‡∏á‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô'}</h4>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between">
                    <span>${isEnglish ? 'Monthly Usage:' : '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:'}</span>
                    <span>${savings.energyFlow.monthlyUsage} kWh</span>
                  </div>
                  <div class="flex justify-between">
                    <span>${isEnglish ? 'Solar Production:' : '‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå:'}</span>
                    <span>${savings.energyFlow.monthlyProduction} kWh</span>
                  </div>
                  <div class="flex justify-between">
                    <span>${isEnglish ? 'Self Sufficiency:' : '‡∏Å‡∏≤‡∏£‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á:'}</span>
                    <span class="font-medium text-purple-600">${savings.energyFlow.selfSufficiency}%</span>
                  </div>
                  <div class="flex justify-between">
                    <span>${isEnglish ? 'Remaining Bill:' : '‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:'}</span>
                    <span class="font-medium">‡∏ø${savings.savings.remainingBill.toLocaleString()}/month</span>
                  </div>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3 mt-3">
                  <div class="bg-purple-600 h-3 rounded-full" style="width: ${Math.min(savings.energyFlow.selfSufficiency, 100)}%"></div>
                </div>
              </div>

              <!-- Environmental Impact -->
              <div class="p-4 bg-teal-50 rounded-lg">
                <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Environmental Impact' : '‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°'}</h4>
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <div class="text-center">
                    <div class="font-semibold text-teal-600">${Math.round(production.production.yearly * 0.5)} kg</div>
                    <div class="text-gray-600">${isEnglish ? 'CO‚ÇÇ Reduction/Year' : '‡∏•‡∏î CO‚ÇÇ/‡∏õ‡∏µ'}</div>
                  </div>
                  <div class="text-center">
                    <div class="font-semibold text-teal-600">${Math.round(production.production.yearly * 0.5 / 22)}</div>
                    <div class="text-gray-600">${isEnglish ? 'Trees Equivalent/Year' : '‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ/‡∏õ‡∏µ'}</div>
                  </div>
                </div>
              </div>
            </div>
          `;
        }

        // Inline Solar Calculation Functions (for browser compatibility)
        function calculateSolarCapacityInline(roofArea, panelType = 'monocrystalline', usableRatio = 0.8) {
          if (roofArea <= 0 || roofArea > 10000) {
            return {
              error: '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 1-10,000 ‡∏ï‡∏£.‡∏°.',
              errorEN: 'Roof area must be between 1-10,000 sqm'
            };
          }

          const powerPerSqm = {
            monocrystalline: 200,
            polycrystalline: 170,
            thinfilm: 130
          };

          const panelEfficiency = {
            monocrystalline: { efficiency: 0.20, name: 'Monocrystalline' },
            polycrystalline: { efficiency: 0.17, name: 'Polycrystalline' },
            thinfilm: { efficiency: 0.13, name: 'Thin Film' }
          };

          const power = powerPerSqm[panelType];
          if (!power) {
            return {
              error: '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏ú‡∏á‡πÇ‡∏ã‡∏•‡∏≤‡∏£‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
              errorEN: 'Invalid panel type'
            };
          }

          const usableArea = roofArea * usableRatio;
          const capacityWp = usableArea * power;
          const capacityKwp = capacityWp / 1000;

          return {
            success: true,
            roofArea,
            usableArea: Math.round(usableArea * 100) / 100,
            panelType,
            capacity: {
              wp: Math.round(capacityWp),
              kWp: Math.round(capacityKwp * 100) / 100
            },
            panelInfo: panelEfficiency[panelType]
          };
        }

        function calculateEnergyProductionInline(capacityKwp, region = 'central', options = {}) {
          const { performanceRatio = 0.85, shadingLoss = 0.05, dustLoss = 0.03 } = options;

          if (capacityKwp <= 0 || capacityKwp > 1000) {
            return {
              error: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 0.1-1,000 kWp',
              errorEN: 'Capacity must be between 0.1-1,000 kWp'
            };
          }

          const solarData = {
            central: { irradiance: 4.8, name: '‡∏†‡∏≤‡∏Ñ‡∏Å‡∏•‡∏≤‡∏á', nameEN: 'Central' },
            north: { irradiance: 4.6, name: '‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠', nameEN: 'Northern' },
            northeast: { irradiance: 5.1, name: '‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠', nameEN: 'Northeastern' },
            south: { irradiance: 4.4, name: '‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ', nameEN: 'Southern' },
            east: { irradiance: 4.9, name: '‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å', nameEN: 'Eastern' }
          };

          const regionData = solarData[region];
          if (!regionData) {
            return {
              error: '‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
              errorEN: 'Invalid region'
            };
          }

          const dailyProduction = capacityKwp * regionData.irradiance * performanceRatio;
          const lossMultiplier = 1 - shadingLoss - dustLoss;
          const adjustedDailyProduction = dailyProduction * lossMultiplier;
          const monthlyProduction = adjustedDailyProduction * 30;
          const yearlyProduction = adjustedDailyProduction * 365;

          return {
            success: true,
            capacity: capacityKwp,
            region: regionData,
            production: {
              daily: Math.round(adjustedDailyProduction * 100) / 100,
              monthly: Math.round(monthlyProduction * 100) / 100,
              yearly: Math.round(yearlyProduction * 100) / 100
            },
            factors: {
              performanceRatio,
              shadingLoss,
              dustLoss,
              totalLoss: Math.round((shadingLoss + dustLoss) * 100 * 100) / 100
            }
          };
        }

        function calculateElectricityBillInline(monthlyUnits, provider = 'mea') {
          if (monthlyUnits < 0 || monthlyUnits > 10000) {
            return {
              error: '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 0-10,000 ‡∏´‡∏ô‡πà‡∏ß‡∏¢',
              errorEN: 'Electricity usage must be between 0-10,000 units'
            };
          }

          const rates = {
            mea: {
              tiers: [
                { max: 15, rate: 2.3488 },
                { max: 25, rate: 2.9882 },
                { max: 35, rate: 3.2405 },
                { max: 100, rate: 3.6237 },
                { max: 150, rate: 3.7171 },
                { max: 400, rate: 4.2218 },
                { max: Infinity, rate: 4.4217 }
              ],
              baseFee: 38.22,
              name: 'MEA (‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ô‡∏Ñ‡∏£‡∏´‡∏•‡∏ß‡∏á)'
            },
            pea: {
              tiers: [
                { max: 15, rate: 2.3488 },
                { max: 25, rate: 2.9882 },
                { max: 35, rate: 3.2405 },
                { max: 100, rate: 3.6237 },
                { max: 150, rate: 3.7171 },
                { max: 400, rate: 4.2218 },
                { max: Infinity, rate: 4.4217 }
              ],
              baseFee: 24.62,
              name: 'PEA (‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ)'
            }
          };

          const rateData = rates[provider];
          if (!rateData) {
            return {
              error: '‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
              errorEN: 'Invalid electricity provider'
            };
          }

          let totalCost = rateData.baseFee;
          let remainingUnits = monthlyUnits;
          const breakdown = [];

          for (const tier of rateData.tiers) {
            if (remainingUnits <= 0) break;
            
            const prevMax = breakdown.length > 0 ? rateData.tiers[breakdown.length - 1].max : 0;
            const unitsInTier = Math.min(remainingUnits, tier.max - prevMax);
            const costInTier = unitsInTier * tier.rate;
            
            breakdown.push({
              units: Math.round(unitsInTier * 100) / 100,
              rate: tier.rate,
              cost: Math.round(costInTier * 100) / 100
            });
            
            totalCost += costInTier;
            remainingUnits -= unitsInTier;
          }

          const averageRate = monthlyUnits > 0 ? (totalCost - rateData.baseFee) / monthlyUnits : 0;

          return {
            success: true,
            monthlyUnits,
            provider: rateData,
            costs: {
              baseFee: rateData.baseFee,
              energyCost: Math.round((totalCost - rateData.baseFee) * 100) / 100,
              totalCost: Math.round(totalCost * 100) / 100,
              averageRate: Math.round(averageRate * 100) / 100
            },
            breakdown
          };
        }

        function estimateSystemCostInline(capacityKwp) {
          if (capacityKwp <= 0 || capacityKwp > 1000) {
            return {
              error: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 0.1-1,000 kWp',
              errorEN: 'Capacity must be between 0.1-1,000 kWp'
            };
          }

          let costPerKwp;
          let category;

          if (capacityKwp <= 3) {
            costPerKwp = 45000;
            category = { name: '‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏•‡πá‡∏Å (1-3 kWp)' };
          } else if (capacityKwp <= 5) {
            costPerKwp = 42000;
            category = { name: '‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏•‡∏≤‡∏á (3-5 kWp)' };
          } else if (capacityKwp <= 10) {
            costPerKwp = 38000;
            category = { name: '‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏ç‡πà (5-10 kWp)' };
          } else {
            costPerKwp = 35000;
            category = { name: '‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å (10+ kWp)' };
          }

          const totalCost = capacityKwp * costPerKwp;

          return {
            success: true,
            capacity: capacityKwp,
            costPerKwp,
            totalCost: Math.round(totalCost),
            category,
            breakdown: {
              equipment: Math.round(totalCost * 0.7),
              installation: Math.round(totalCost * 0.2),
              permits: Math.round(totalCost * 0.1)
            }
          };
        }

        function calculateSavingsAndROIInline(productionData, electricityData, systemCost, options = {}) {
          const {
            netMeteringRate = 2.20,
            electricityPriceInflation = 0.03,
            analysisYears = 25
          } = options;

          if (!productionData.success || !electricityData.success) {
            return {
              error: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
              errorEN: 'Invalid production or electricity data'
            };
          }

          const monthlyProduction = productionData.production.monthly;
          const monthlyUsage = electricityData.monthlyUnits;
          const averageElectricityRate = electricityData.costs.averageRate;

          const selfConsumption = Math.min(monthlyProduction, monthlyUsage);
          const gridExport = Math.max(0, monthlyProduction - monthlyUsage);
          const gridImport = Math.max(0, monthlyUsage - monthlyProduction);

          const selfConsumptionSavings = selfConsumption * averageElectricityRate;
          const exportIncome = gridExport * netMeteringRate;
          const remainingElectricityBill = gridImport * averageElectricityRate + electricityData.costs.baseFee;
          
          const monthlySavings = selfConsumptionSavings + exportIncome;
          const yearlySavings = monthlySavings * 12;

          // Calculate lifetime savings with inflation and degradation
          let lifetimeSavings = 0;
          const degradationRate = 0.008; // 0.8% per year
          
          for (let year = 1; year <= analysisYears; year++) {
            const electricityInflation = Math.pow(1 + electricityPriceInflation, year - 1);
            const solarDegradation = Math.pow(1 - degradationRate, year - 1);
            const yearSavings = yearlySavings * electricityInflation * solarDegradation;
            lifetimeSavings += yearSavings;
          }

          const simplePaybackYears = systemCost / yearlySavings;
          const roi = ((lifetimeSavings - systemCost) / systemCost) * 100;

          return {
            success: true,
            energyFlow: {
              monthlyProduction: Math.round(monthlyProduction * 100) / 100,
              monthlyUsage,
              selfConsumption: Math.round(selfConsumption * 100) / 100,
              gridExport: Math.round(gridExport * 100) / 100,
              gridImport: Math.round(gridImport * 100) / 100,
              selfSufficiency: Math.round((selfConsumption / monthlyUsage) * 100 * 100) / 100
            },
            savings: {
              monthly: Math.round(monthlySavings * 100) / 100,
              yearly: Math.round(yearlySavings * 100) / 100,
              lifetime: Math.round(lifetimeSavings * 100) / 100,
              remainingBill: Math.round(remainingElectricityBill * 100) / 100
            },
            investment: {
              systemCost,
              paybackYears: Math.round(simplePaybackYears * 100) / 100,
              roi: Math.round(roi * 100) / 100,
              netProfit: Math.round((lifetimeSavings - systemCost) * 100) / 100
            },
            rates: {
              electricity: averageElectricityRate,
              netMetering: netMeteringRate
            }
          };
        }

        // Electrical Calculator Functions
        let currentElectricalType = 'conductor';

        function getElectricalCalculatorHTML() {
          const isEnglish = currentLanguage === 'en';
          
          return `
            <div class="space-y-6">
              <!-- Tab Navigation -->
              <div class="flex flex-wrap gap-2 bg-gray-100 p-1 rounded-lg">
                <button onclick="switchElectricalTab('conductor')" 
                        class="electrical-tab flex-1 px-4 py-2 text-sm font-medium rounded-lg transition-colors bg-blue-600 text-white" 
                        data-tab="conductor">
                  ${isEnglish ? 'üìè Wire Size' : 'üìè ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡πÑ‡∏ü'}
                </button>
                <button onclick="switchElectricalTab('distance')" 
                        class="electrical-tab flex-1 px-4 py-2 text-sm font-medium rounded-lg transition-colors bg-white text-gray-700 hover:bg-gray-50" 
                        data-tab="distance">
                  ${isEnglish ? 'üìê Max Distance' : 'üìê ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î'}
                </button>
                <button onclick="switchElectricalTab('voltage')" 
                        class="electrical-tab flex-1 px-4 py-2 text-sm font-medium rounded-lg transition-colors bg-white text-gray-700 hover:bg-gray-50" 
                        data-tab="voltage">
                  ${isEnglish ? '‚ö° Voltage Drop' : '‚ö° ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å'}
                </button>
              </div>

              <!-- Calculator Content -->
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Input Section -->
                <div class="bg-gray-50 p-4 rounded-lg">
                  <h3 class="font-semibold mb-4" id="electricalInputTitle">
                    ${isEnglish ? 'üìè Minimum Conductor Size' : 'üìè ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡πÑ‡∏ü‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥'}
                  </h3>
                  <div id="electricalInputs">
                    <!-- Dynamic inputs will be inserted here -->
                  </div>
                </div>

                <!-- Results Section -->
                <div class="bg-gray-50 p-4 rounded-lg">
                  <h3 class="font-semibold mb-4">${isEnglish ? 'Calculation Results' : '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}</h3>
                  <div id="electricalResults" class="text-center py-8 text-gray-500">
                    ${isEnglish ? 'Enter values and click calculate' : '‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}
                  </div>
                </div>
              </div>
            </div>
          `;
        }

        function switchElectricalTab(type) {
          currentElectricalType = type;
          const isEnglish = currentLanguage === 'en';
          
          // Update tab buttons
          document.querySelectorAll('.electrical-tab').forEach(tab => {
            tab.className = 'electrical-tab flex-1 px-4 py-2 text-sm font-medium rounded-lg transition-colors bg-white text-gray-700 hover:bg-gray-50';
          });
          document.querySelector(`[data-tab="${type}"]`).className = 'electrical-tab flex-1 px-4 py-2 text-sm font-medium rounded-lg transition-colors bg-blue-600 text-white';
          
          // Update input section
          const inputTitle = document.getElementById('electricalInputTitle');
          const inputsDiv = document.getElementById('electricalInputs');
          const results = document.getElementById('electricalResults');
          
          // Clear results
          results.innerHTML = `<div class="text-center py-8 text-gray-500">${isEnglish ? 'Enter values and click calculate' : '‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'}</div>`;
          
          if (type === 'conductor') {
            inputTitle.textContent = isEnglish ? 'üìè Minimum Conductor Size' : 'üìè ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡πÑ‡∏ü‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥';
            inputsDiv.innerHTML = `
              <div class="space-y-3">
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Current (A)' : '‡∏Å‡∏£‡∏∞‡πÅ‡∏™ (‡πÅ‡∏≠‡∏°‡∏õ‡πå)'}</label>
                  <input type="number" id="elecCurrent" placeholder="${isEnglish ? 'Enter current in amperes' : '‡πÉ‡∏™‡πà‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏°‡∏õ‡πå'}" 
                         class="w-full px-3 py-2 border rounded-lg" min="0.1" step="0.1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Distance (m)' : '‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡πÄ‡∏°‡∏ï‡∏£)'}</label>
                  <input type="number" id="elecDistance" placeholder="${isEnglish ? 'Enter distance in meters' : '‡πÉ‡∏™‡πà‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏ï‡∏£'}" 
                         class="w-full px-3 py-2 border rounded-lg" min="0.1" step="0.1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Voltage (V)' : '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô (‡πÇ‡∏ß‡∏•‡∏ï‡πå)'}</label>
                  <select id="elecVoltage" class="w-full px-3 py-2 border rounded-lg">
                    <option value="220">${isEnglish ? '220V (1-phase)' : '220V (1 ‡πÄ‡∏ü‡∏™)'}</option>
                    <option value="380">${isEnglish ? '380V (3-phase)' : '380V (3 ‡πÄ‡∏ü‡∏™)'}</option>
                    <option value="400">${isEnglish ? '400V (3-phase)' : '400V (3 ‡πÄ‡∏ü‡∏™)'}</option>
                    <option value="480">${isEnglish ? '480V (3-phase)' : '480V (3 ‡πÄ‡∏ü‡∏™)'}</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Voltage Drop (%)' : '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å (%)'}</label>
                  <input type="number" id="elecVoltageDrop" value="3" 
                         class="w-full px-3 py-2 border rounded-lg" min="0.1" max="20" step="0.1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Conductor Material' : '‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≤‡∏¢‡πÑ‡∏ü'}</label>
                  <select id="elecMaterial" class="w-full px-3 py-2 border rounded-lg">
                    <option value="copper">${isEnglish ? 'Copper (Cu)' : '‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á (Cu)'}</option>
                    <option value="aluminum">${isEnglish ? 'Aluminum (Al)' : '‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏° (Al)'}</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Number of Phases' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ü‡∏™'}</label>
                  <select id="elecPhases" class="w-full px-3 py-2 border rounded-lg">
                    <option value="1">${isEnglish ? '1 Phase' : '1 ‡πÄ‡∏ü‡∏™'}</option>
                    <option value="3">${isEnglish ? '3 Phase' : '3 ‡πÄ‡∏ü‡∏™'}</option>
                  </select>
                </div>
                <button onclick="calculateElectrical()" class="w-full px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">
                  ${isEnglish ? '‚ö° Calculate Wire Size' : '‚ö° ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢'}
                </button>
              </div>
            `;
          } else if (type === 'distance') {
            inputTitle.textContent = isEnglish ? 'üìê Maximum Circuit Distance' : 'üìê ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ß‡∏á‡∏à‡∏£‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î';
            inputsDiv.innerHTML = `
              <div class="space-y-3">
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Wire Size (mm¬≤)' : '‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢ (‡∏ï‡∏£.‡∏°‡∏°.)'}</label>
                  <select id="elecWireSize" class="w-full px-3 py-2 border rounded-lg">
                    <option value="1.5">1.5 mm¬≤</option>
                    <option value="2.5">2.5 mm¬≤</option>
                    <option value="4">4 mm¬≤</option>
                    <option value="6">6 mm¬≤</option>
                    <option value="10">10 mm¬≤</option>
                    <option value="16">16 mm¬≤</option>
                    <option value="25">25 mm¬≤</option>
                    <option value="35">35 mm¬≤</option>
                    <option value="50">50 mm¬≤</option>
                    <option value="70">70 mm¬≤</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Current (A)' : '‡∏Å‡∏£‡∏∞‡πÅ‡∏™ (‡πÅ‡∏≠‡∏°‡∏õ‡πå)'}</label>
                  <input type="number" id="elecCurrentDist" placeholder="${isEnglish ? 'Enter current in amperes' : '‡πÉ‡∏™‡πà‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏°‡∏õ‡πå'}" 
                         class="w-full px-3 py-2 border rounded-lg" min="0.1" step="0.1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Voltage (V)' : '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô (‡πÇ‡∏ß‡∏•‡∏ï‡πå)'}</label>
                  <select id="elecVoltageDist" class="w-full px-3 py-2 border rounded-lg">
                    <option value="220">${isEnglish ? '220V (1-phase)' : '220V (1 ‡πÄ‡∏ü‡∏™)'}</option>
                    <option value="380">${isEnglish ? '380V (3-phase)' : '380V (3 ‡πÄ‡∏ü‡∏™)'}</option>
                    <option value="400">${isEnglish ? '400V (3-phase)' : '400V (3 ‡πÄ‡∏ü‡∏™)'}</option>
                    <option value="480">${isEnglish ? '480V (3-phase)' : '480V (3 ‡πÄ‡∏ü‡∏™)'}</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Voltage Drop (%)' : '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å (%)'}</label>
                  <input type="number" id="elecVoltageDropDist" value="3" 
                         class="w-full px-3 py-2 border rounded-lg" min="0.1" max="20" step="0.1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Conductor Material' : '‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≤‡∏¢‡πÑ‡∏ü'}</label>
                  <select id="elecMaterialDist" class="w-full px-3 py-2 border rounded-lg">
                    <option value="copper">${isEnglish ? 'Copper (Cu)' : '‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á (Cu)'}</option>
                    <option value="aluminum">${isEnglish ? 'Aluminum (Al)' : '‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏° (Al)'}</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Number of Phases' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ü‡∏™'}</label>
                  <select id="elecPhasesDist" class="w-full px-3 py-2 border rounded-lg">
                    <option value="1">${isEnglish ? '1 Phase' : '1 ‡πÄ‡∏ü‡∏™'}</option>
                    <option value="3">${isEnglish ? '3 Phase' : '3 ‡πÄ‡∏ü‡∏™'}</option>
                  </select>
                </div>
                <button onclick="calculateElectrical()" class="w-full px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">
                  ${isEnglish ? 'üìê Calculate Max Distance' : 'üìê ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î'}
                </button>
              </div>
            `;
          } else if (type === 'voltage') {
            inputTitle.textContent = isEnglish ? '‚ö° Voltage Drop Percentage' : '‚ö° ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å';
            inputsDiv.innerHTML = `
              <div class="space-y-3">
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Wire Size (mm¬≤)' : '‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢ (‡∏ï‡∏£.‡∏°‡∏°.)'}</label>
                  <select id="elecWireSizeVolt" class="w-full px-3 py-2 border rounded-lg">
                    <option value="1.5">1.5 mm¬≤</option>
                    <option value="2.5">2.5 mm¬≤</option>
                    <option value="4">4 mm¬≤</option>
                    <option value="6">6 mm¬≤</option>
                    <option value="10">10 mm¬≤</option>
                    <option value="16">16 mm¬≤</option>
                    <option value="25">25 mm¬≤</option>
                    <option value="35">35 mm¬≤</option>
                    <option value="50">50 mm¬≤</option>
                    <option value="70">70 mm¬≤</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Current (A)' : '‡∏Å‡∏£‡∏∞‡πÅ‡∏™ (‡πÅ‡∏≠‡∏°‡∏õ‡πå)'}</label>
                  <input type="number" id="elecCurrentVolt" placeholder="${isEnglish ? 'Enter current in amperes' : '‡πÉ‡∏™‡πà‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏°‡∏õ‡πå'}" 
                         class="w-full px-3 py-2 border rounded-lg" min="0.1" step="0.1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Distance (m)' : '‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡πÄ‡∏°‡∏ï‡∏£)'}</label>
                  <input type="number" id="elecDistanceVolt" placeholder="${isEnglish ? 'Enter distance in meters' : '‡πÉ‡∏™‡πà‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏ï‡∏£'}" 
                         class="w-full px-3 py-2 border rounded-lg" min="0.1" step="0.1">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Voltage (V)' : '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô (‡πÇ‡∏ß‡∏•‡∏ï‡πå)'}</label>
                  <select id="elecVoltageVolt" class="w-full px-3 py-2 border rounded-lg">
                    <option value="220">${isEnglish ? '220V (1-phase)' : '220V (1 ‡πÄ‡∏ü‡∏™)'}</option>
                    <option value="380">${isEnglish ? '380V (3-phase)' : '380V (3 ‡πÄ‡∏ü‡∏™)'}</option>
                    <option value="400">${isEnglish ? '400V (3-phase)' : '400V (3 ‡πÄ‡∏ü‡∏™)'}</option>
                    <option value="480">${isEnglish ? '480V (3-phase)' : '480V (3 ‡πÄ‡∏ü‡∏™)'}</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Conductor Material' : '‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≤‡∏¢‡πÑ‡∏ü'}</label>
                  <select id="elecMaterialVolt" class="w-full px-3 py-2 border rounded-lg">
                    <option value="copper">${isEnglish ? 'Copper (Cu)' : '‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á (Cu)'}</option>
                    <option value="aluminum">${isEnglish ? 'Aluminum (Al)' : '‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏° (Al)'}</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">${isEnglish ? 'Number of Phases' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ü‡∏™'}</label>
                  <select id="elecPhasesVolt" class="w-full px-3 py-2 border rounded-lg">
                    <option value="1">${isEnglish ? '1 Phase' : '1 ‡πÄ‡∏ü‡∏™'}</option>
                    <option value="3">${isEnglish ? '3 Phase' : '3 ‡πÄ‡∏ü‡∏™'}</option>
                  </select>
                </div>
                <button onclick="calculateElectrical()" class="w-full px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">
                  ${isEnglish ? '‚ö° Calculate Voltage Drop' : '‚ö° ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å'}
                </button>
              </div>
            `;
          }
        }

        function calculateElectrical() {
          const results = document.getElementById('electricalResults');
          const isEnglish = currentLanguage === 'en';
          
          try {
            let result;
            
            if (currentElectricalType === 'conductor') {
              const current = parseFloat(document.getElementById('elecCurrent').value);
              const distance = parseFloat(document.getElementById('elecDistance').value);
              const voltage = parseFloat(document.getElementById('elecVoltage').value);
              const voltageDropPercent = parseFloat(document.getElementById('elecVoltageDrop').value);
              const material = document.getElementById('elecMaterial').value;
              const phases = parseInt(document.getElementById('elecPhases').value);
              
              if (!current || !distance || !voltage || !voltageDropPercent) {
                results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please fill in all fields' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'}</p>`;
                return;
              }
              
              result = calculateMinimumConductorSizeInline(current, distance, voltage, voltageDropPercent, material, phases);
              displayConductorResults(result);
              
            } else if (currentElectricalType === 'distance') {
              const wireSize = parseFloat(document.getElementById('elecWireSize').value);
              const current = parseFloat(document.getElementById('elecCurrentDist').value);
              const voltage = parseFloat(document.getElementById('elecVoltageDist').value);
              const voltageDropPercent = parseFloat(document.getElementById('elecVoltageDropDist').value);
              const material = document.getElementById('elecMaterialDist').value;
              const phases = parseInt(document.getElementById('elecPhasesDist').value);
              
              if (!wireSize || !current || !voltage || !voltageDropPercent) {
                results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please fill in all fields' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'}</p>`;
                return;
              }
              
              result = calculateMaximumCircuitDistanceInline(wireSize, current, voltage, voltageDropPercent, material, phases);
              displayDistanceResults(result);
              
            } else if (currentElectricalType === 'voltage') {
              const wireSize = parseFloat(document.getElementById('elecWireSizeVolt').value);
              const current = parseFloat(document.getElementById('elecCurrentVolt').value);
              const distance = parseFloat(document.getElementById('elecDistanceVolt').value);
              const voltage = parseFloat(document.getElementById('elecVoltageVolt').value);
              const material = document.getElementById('elecMaterialVolt').value;
              const phases = parseInt(document.getElementById('elecPhasesVolt').value);
              
              if (!wireSize || !current || !distance || !voltage) {
                results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Please fill in all fields' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'}</p>`;
                return;
              }
              
              result = calculateVoltageDropPercentageInline(wireSize, current, distance, voltage, material, phases);
              displayVoltageResults(result);
            }
            
          } catch (error) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? 'Calculation error. Please check your inputs.' : '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</p>`;
          }
        }

        function displayConductorResults(result) {
          const results = document.getElementById('electricalResults');
          const isEnglish = currentLanguage === 'en';
          
          if (result.error) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? result.errorEN : result.error}</p>`;
            return;
          }
          
          const { calculation, warnings } = result;
          const wire = calculation.recommendedWire;
          
          let warningsHTML = warnings.map(w => `
            <div class="p-2 rounded text-sm ${w.type === 'error' ? 'bg-red-50 text-red-700' : w.type === 'warning' ? 'bg-yellow-50 text-yellow-700' : w.type === 'success' ? 'bg-green-50 text-green-700' : 'bg-blue-50 text-blue-700'}">
              ${isEnglish ? w.messageEN : w.message}
            </div>
          `).join('');
          
          results.innerHTML = `
            <div class="space-y-4 text-left">
              <!-- Recommended Wire -->
              <div class="p-4 bg-yellow-50 rounded-lg border-l-4 border-yellow-400">
                <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Recommended Wire Size' : '‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥'}</h4>
                <div class="space-y-2">
                  <div class="text-2xl font-bold text-yellow-600">
                    ${wire.mm2} mm¬≤ ${wire.awg !== '-' ? `(AWG ${wire.awg})` : ''}
                  </div>
                  <div class="text-sm">
                    <strong>${isEnglish ? 'Ampacity:' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏ô‡∏≤‡∏î:'}</strong> ${wire.ampacity} A<br>
                    <strong>${isEnglish ? 'Actual Voltage Drop:' : '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å‡∏à‡∏£‡∏¥‡∏á:'}</strong> ${wire.actualVoltageDropPercent}%<br>
                    <strong>${isEnglish ? 'Voltage Drop:' : '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å:'}</strong> ${wire.actualVoltageDrop} V
                  </div>
                </div>
              </div>

              <!-- Comparison Table -->
              <div class="p-4 bg-gray-50 rounded-lg">
                <h4 class="font-semibold mb-2">${isEnglish ? 'Wire Size Comparison' : '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢'}</h4>
                <div class="overflow-x-auto">
                  <table class="w-full text-sm">
                    <thead>
                      <tr class="bg-gray-200">
                        <th class="px-2 py-1 text-left">${isEnglish ? 'Size' : '‡∏Ç‡∏ô‡∏≤‡∏î'}</th>
                        <th class="px-2 py-1 text-left">${isEnglish ? 'Ampacity' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á'}</th>
                        <th class="px-2 py-1 text-left">${isEnglish ? 'V-Drop %' : '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å %'}</th>
                        <th class="px-2 py-1 text-center">${isEnglish ? 'Status' : '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'}</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${calculation.comparisonTable.map(wire => `
                        <tr class="${wire.suitable ? 'bg-green-50' : 'bg-red-50'}">
                          <td class="px-2 py-1">${wire.mm2} mm¬≤</td>
                          <td class="px-2 py-1">${wire.ampacity} A</td>
                          <td class="px-2 py-1">${wire.voltageDropPercent}%</td>
                          <td class="px-2 py-1 text-center">
                            ${wire.suitable ? '‚úÖ' : '‚ùå'}
                          </td>
                        </tr>
                      `).join('')}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Warnings -->
              <div class="space-y-2">
                ${warningsHTML}
              </div>
            </div>
          `;
        }

        function displayDistanceResults(result) {
          const results = document.getElementById('electricalResults');
          const isEnglish = currentLanguage === 'en';
          
          if (result.error) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? result.errorEN : result.error}</p>`;
            return;
          }
          
          const { calculation, warnings } = result;
          
          let warningsHTML = warnings.map(w => `
            <div class="p-2 rounded text-sm ${w.type === 'error' ? 'bg-red-50 text-red-700' : w.type === 'warning' ? 'bg-yellow-50 text-yellow-700' : w.type === 'success' ? 'bg-green-50 text-green-700' : 'bg-blue-50 text-blue-700'}">
              ${isEnglish ? w.messageEN : w.message}
            </div>
          `).join('');
          
          results.innerHTML = `
            <div class="space-y-4 text-left">
              <!-- Maximum Distance -->
              <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Maximum Distance' : '‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î'}</h4>
                <div class="text-2xl font-bold text-blue-600 mb-2">
                  ${calculation.maxDistance} ${isEnglish ? 'meters' : '‡πÄ‡∏°‡∏ï‡∏£'}
                </div>
                <div class="text-sm">
                  <strong>${isEnglish ? 'Wire Size:' : '‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢:'}</strong> ${calculation.wireInfo.mm2} mm¬≤<br>
                  <strong>${isEnglish ? 'Ampacity:' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏ô‡∏≤‡∏î:'}</strong> ${calculation.ampacity} A
                </div>
              </div>

              <!-- Distance Table -->
              <div class="p-4 bg-gray-50 rounded-lg">
                <h4 class="font-semibold mb-2">${isEnglish ? 'Distance Comparison' : '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á'}</h4>
                <div class="overflow-x-auto">
                  <table class="w-full text-sm">
                    <thead>
                      <tr class="bg-gray-200">
                        <th class="px-2 py-1 text-left">${isEnglish ? 'Wire Size' : '‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢'}</th>
                        <th class="px-2 py-1 text-left">${isEnglish ? 'Ampacity' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á'}</th>
                        <th class="px-2 py-1 text-left">${isEnglish ? 'Max Distance' : '‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î'}</th>
                        <th class="px-2 py-1 text-center">${isEnglish ? 'Recommended' : '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥'}</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${calculation.distanceTable.map(wire => `
                        <tr class="${wire.recommended ? 'bg-green-50' : ''}">
                          <td class="px-2 py-1">${wire.mm2} mm¬≤</td>
                          <td class="px-2 py-1">${wire.ampacity} A</td>
                          <td class="px-2 py-1">${wire.maxDistance} m</td>
                          <td class="px-2 py-1 text-center">
                            ${wire.recommended ? '‚≠ê' : ''}
                          </td>
                        </tr>
                      `).join('')}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Warnings -->
              <div class="space-y-2">
                ${warningsHTML}
              </div>
            </div>
          `;
        }

        function displayVoltageResults(result) {
          const results = document.getElementById('electricalResults');
          const isEnglish = currentLanguage === 'en';
          
          if (result.error) {
            results.innerHTML = `<p class="text-red-500">${isEnglish ? result.errorEN : result.error}</p>`;
            return;
          }
          
          const { calculation, warnings } = result;
          
          let warningsHTML = warnings.map(w => `
            <div class="p-2 rounded text-sm ${w.type === 'error' ? 'bg-red-50 text-red-700' : w.type === 'warning' ? 'bg-yellow-50 text-yellow-700' : w.type === 'success' ? 'bg-green-50 text-green-700' : 'bg-blue-50 text-blue-700'}">
              ${isEnglish ? w.messageEN : w.message}
            </div>
          `).join('');
          
          const status = calculation.voltageDropPercentage <= 5 ? 'success' : calculation.voltageDropPercentage <= 10 ? 'warning' : 'error';
          const statusColors = {
            success: 'bg-green-50 border-green-400 text-green-600',
            warning: 'bg-yellow-50 border-yellow-400 text-yellow-600', 
            error: 'bg-red-50 border-red-400 text-red-600'
          };
          
          results.innerHTML = `
            <div class="space-y-4 text-left">
              <!-- Voltage Drop Result -->
              <div class="p-4 rounded-lg border-l-4 ${statusColors[status]}">
                <h4 class="font-semibold text-lg mb-2">${isEnglish ? 'Voltage Drop Analysis' : '‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å'}</h4>
                <div class="space-y-2">
                  <div class="text-2xl font-bold">
                    ${calculation.voltageDropPercentage}%
                  </div>
                  <div class="text-sm">
                    <strong>${isEnglish ? 'Voltage Drop:' : '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å:'}</strong> ${calculation.voltageDrop} V<br>
                    <strong>${isEnglish ? 'Remaining Voltage:' : '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:'}</strong> ${calculation.remainingVoltage} V<br>
                    <strong>${isEnglish ? 'Resistance:' : '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≤‡∏ô‡∏ó‡∏≤‡∏ô:'}</strong> ${calculation.resistance} Œ©
                  </div>
                </div>
              </div>

              <!-- Standards Check -->
              <div class="p-4 bg-gray-50 rounded-lg">
                <h4 class="font-semibold mb-2">${isEnglish ? 'Standards Compliance' : '‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô'}</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
                  <div class="p-2 rounded ${calculation.standards.residential.total ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                    <strong>${isEnglish ? 'Residential' : '‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢'}</strong><br>
                    ${calculation.standards.residential.total ? '‚úÖ Pass' : '‚ùå Fail'} (‚â§5%)
                  </div>
                  <div class="p-2 rounded ${calculation.standards.commercial.total ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                    <strong>${isEnglish ? 'Commercial' : '‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå'}</strong><br>
                    ${calculation.standards.commercial.total ? '‚úÖ Pass' : '‚ùå Fail'} (‚â§5%)
                  </div>
                  <div class="p-2 rounded ${calculation.standards.industrial.total ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                    <strong>${isEnglish ? 'Industrial' : '‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°'}</strong><br>
                    ${calculation.standards.industrial.total ? '‚úÖ Pass' : '‚ùå Fail'} (‚â§10%)
                  </div>
                </div>
              </div>

              <!-- Distance Comparison -->
              <div class="p-4 bg-gray-50 rounded-lg">
                <h4 class="font-semibold mb-2">${isEnglish ? 'Distance vs Voltage Drop' : '‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á vs ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å'}</h4>
                <div class="overflow-x-auto">
                  <table class="w-full text-sm">
                    <thead>
                      <tr class="bg-gray-200">
                        <th class="px-2 py-1 text-left">${isEnglish ? 'Distance' : '‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á'}</th>
                        <th class="px-2 py-1 text-left">${isEnglish ? 'V-Drop %' : '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å %'}</th>
                        <th class="px-2 py-1 text-left">${isEnglish ? 'Remaining V' : '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠'}</th>
                        <th class="px-2 py-1 text-center">${isEnglish ? 'OK' : '‡∏ú‡πà‡∏≤‡∏ô'}</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${calculation.distanceComparisonTable.map(row => `
                        <tr class="${row.acceptable ? 'bg-green-50' : 'bg-red-50'}">
                          <td class="px-2 py-1">${row.distance} m</td>
                          <td class="px-2 py-1">${row.voltageDropPercent}%</td>
                          <td class="px-2 py-1">${row.remainingVoltage} V</td>
                          <td class="px-2 py-1 text-center">
                            ${row.acceptable ? '‚úÖ' : '‚ùå'}
                          </td>
                        </tr>
                      `).join('')}
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Warnings -->
              <div class="space-y-2">
                ${warningsHTML}
              </div>
            </div>
          `;
        }

        // Inline Electrical Calculator Functions for Browser Compatibility
        function calculateMinimumConductorSizeInline(current, distance, voltage, voltageDropPercent, material = 'copper', phases = 1) {
          if (current <= 0 || distance <= 0 || voltage <= 0 || voltageDropPercent <= 0) {
            return {
              error: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡∏Å‡∏£‡∏∞‡πÅ‡∏™, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á, ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô ‡πÅ‡∏•‡∏∞ % ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0',
              errorEN: 'Invalid input: Current, distance, voltage, and voltage drop % must be > 0'
            };
          }

          const resistivity = material === 'copper' ? 0.0175 : 0.0286;
          const allowedVoltageDrop = voltage * (voltageDropPercent / 100);
          
          let maxResistance;
          if (phases === 1) {
            maxResistance = allowedVoltageDrop / current;
          } else {
            maxResistance = allowedVoltageDrop / (Math.sqrt(3) * current);
          }

          const minCrossSection = (resistivity * distance * 2) / maxResistance;

          // Wire sizes table
          const wireSizes = [
            { awg: '14', mm2: 2.08, ampacity_cu: 20, ampacity_al: 15 },
            { awg: '12', mm2: 3.31, ampacity_cu: 25, ampacity_al: 20 },
            { awg: '10', mm2: 5.26, ampacity_cu: 35, ampacity_al: 25 },
            { awg: '8', mm2: 8.37, ampacity_cu: 50, ampacity_al: 40 },
            { awg: '6', mm2: 13.3, ampacity_cu: 65, ampacity_al: 50 },
            { awg: '4', mm2: 21.2, ampacity_cu: 85, ampacity_al: 65 },
            { awg: '2', mm2: 33.6, ampacity_cu: 115, ampacity_al: 90 },
            { awg: '1/0', mm2: 53.5, ampacity_cu: 150, ampacity_al: 120 },
            { awg: '2/0', mm2: 67.4, ampacity_cu: 175, ampacity_al: 135 },
            { awg: '3/0', mm2: 85.0, ampacity_cu: 200, ampacity_al: 155 },
            { awg: '4/0', mm2: 107, ampacity_cu: 230, ampacity_al: 180 },
            { awg: '-', mm2: 1.5, ampacity_cu: 16, ampacity_al: 12 },
            { awg: '-', mm2: 2.5, ampacity_cu: 24, ampacity_al: 18 },
            { awg: '-', mm2: 4.0, ampacity_cu: 32, ampacity_al: 25 },
            { awg: '-', mm2: 6.0, ampacity_cu: 41, ampacity_al: 32 },
            { awg: '-', mm2: 10.0, ampacity_cu: 57, ampacity_al: 44 },
            { awg: '-', mm2: 16.0, ampacity_cu: 76, ampacity_al: 59 },
            { awg: '-', mm2: 25.0, ampacity_cu: 101, ampacity_al: 78 },
            { awg: '-', mm2: 35.0, ampacity_cu: 125, ampacity_al: 96 },
            { awg: '-', mm2: 50.0, ampacity_cu: 151, ampacity_al: 117 },
            { awg: '-', mm2: 70.0, ampacity_cu: 192, ampacity_al: 148 },
            { awg: '-', mm2: 95.0, ampacity_cu: 232, ampacity_al: 179 },
            { awg: '-', mm2: 120.0, ampacity_cu: 269, ampacity_al: 207 },
            { awg: '-', mm2: 150.0, ampacity_cu: 309, ampacity_al: 238 },
            { awg: '-', mm2: 185.0, ampacity_cu: 353, ampacity_al: 272 },
            { awg: '-', mm2: 240.0, ampacity_cu: 415, ampacity_al: 320 }
          ];

          const suitableWires = wireSizes
            .filter(wire => wire.mm2 >= minCrossSection)
            .sort((a, b) => a.mm2 - b.mm2);

          if (suitableWires.length === 0) {
            return {
              error: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° % Voltage Drop ‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ',
              errorEN: 'No suitable wire size found. Please reduce distance or increase allowable voltage drop'
            };
          }

          const recommendedWire = suitableWires[0];
          const ampacityProperty = material === 'copper' ? 'ampacity_cu' : 'ampacity_al';
          const isAmpacitySufficient = recommendedWire[ampacityProperty] >= current;

          const actualResistance = (resistivity * distance * 2) / recommendedWire.mm2;
          let actualVoltageDrop;
          if (phases === 1) {
            actualVoltageDrop = actualResistance * current;
          } else {
            actualVoltageDrop = actualResistance * current * Math.sqrt(3);
          }
          const actualVoltageDropPercent = (actualVoltageDrop / voltage) * 100;

          const comparisonTable = suitableWires.slice(0, 5).map(wire => {
            const resistance = (resistivity * distance * 2) / wire.mm2;
            let voltageDrop;
            if (phases === 1) {
              voltageDrop = resistance * current;
            } else {
              voltageDrop = resistance * current * Math.sqrt(3);
            }
            const voltageDropPercent = (voltageDrop / voltage) * 100;
            const ampacitySufficient = wire[ampacityProperty] >= current;

            return {
              awg: wire.awg,
              mm2: wire.mm2,
              ampacity: wire[ampacityProperty],
              voltageDrop: Math.round(voltageDrop * 100) / 100,
              voltageDropPercent: Math.round(voltageDropPercent * 100) / 100,
              ampacitySufficient,
              suitable: voltageDropPercent <= voltageDropPercent && ampacitySufficient
            };
          });

          const warnings = [];
          if (actualVoltageDropPercent > 5) {
            warnings.push({
              type: 'warning',
              message: '‚ö†Ô∏è % ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô 5% ‡∏≠‡∏≤‡∏à‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå',
              messageEN: '‚ö†Ô∏è Voltage drop exceeds 5%, may affect equipment performance'
            });
          }
          if (actualVoltageDropPercent > 10) {
            warnings.push({
              type: 'error',
              message: '‚ùå % ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô 10% ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
              messageEN: '‚ùå Voltage drop exceeds 10%, unsuitable for operation'
            });
          }
          if (!isAmpacitySufficient) {
            warnings.push({
              type: 'error',
              message: '‚ùå ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Ampacity)',
              messageEN: '‚ùå Wire size insufficient for operating current (Ampacity)'
            });
          }
          if (warnings.length === 0) {
            warnings.push({
              type: 'success',
              message: '‚úÖ ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢',
              messageEN: '‚úÖ Calculation meets safety standards'
            });
          }

          return {
            success: true,
            input: { current, distance, voltage, voltageDropPercent, material, phases },
            calculation: {
              minCrossSection: Math.round(minCrossSection * 100) / 100,
              recommendedWire: {
                awg: recommendedWire.awg,
                mm2: recommendedWire.mm2,
                ampacity: recommendedWire[ampacityProperty],
                actualVoltageDrop: Math.round(actualVoltageDrop * 100) / 100,
                actualVoltageDropPercent: Math.round(actualVoltageDropPercent * 100) / 100,
                isAmpacitySufficient
              },
              comparisonTable
            },
            warnings
          };
        }

        function calculateMaximumCircuitDistanceInline(wireSize, current, voltage, voltageDropPercent, material = 'copper', phases = 1) {
          if (wireSize <= 0 || current <= 0 || voltage <= 0 || voltageDropPercent <= 0) {
            return {
              error: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢, ‡∏Å‡∏£‡∏∞‡πÅ‡∏™, ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô ‡πÅ‡∏•‡∏∞ % ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0',
              errorEN: 'Invalid input: Wire size, current, voltage, and voltage drop % must be > 0'
            };
          }

          const resistivity = material === 'copper' ? 0.0175 : 0.0286;
          const allowedVoltageDrop = voltage * (voltageDropPercent / 100);
          
          let maxResistance;
          if (phases === 1) {
            maxResistance = allowedVoltageDrop / current;
          } else {
            maxResistance = allowedVoltageDrop / (Math.sqrt(3) * current);
          }

          const maxDistance = (maxResistance * wireSize) / (resistivity * 2);

          const wireSizes = [
            { awg: '14', mm2: 2.08, ampacity_cu: 20, ampacity_al: 15 },
            { awg: '12', mm2: 3.31, ampacity_cu: 25, ampacity_al: 20 },
            { awg: '10', mm2: 5.26, ampacity_cu: 35, ampacity_al: 25 },
            { awg: '8', mm2: 8.37, ampacity_cu: 50, ampacity_al: 40 },
            { awg: '6', mm2: 13.3, ampacity_cu: 65, ampacity_al: 50 },
            { awg: '4', mm2: 21.2, ampacity_cu: 85, ampacity_al: 65 },
            { awg: '2', mm2: 33.6, ampacity_cu: 115, ampacity_al: 90 },
            { awg: '1/0', mm2: 53.5, ampacity_cu: 150, ampacity_al: 120 },
            { awg: '2/0', mm2: 67.4, ampacity_cu: 175, ampacity_al: 135 },
            { awg: '3/0', mm2: 85.0, ampacity_cu: 200, ampacity_al: 155 },
            { awg: '4/0', mm2: 107, ampacity_cu: 230, ampacity_al: 180 },
            { awg: '-', mm2: 1.5, ampacity_cu: 16, ampacity_al: 12 },
            { awg: '-', mm2: 2.5, ampacity_cu: 24, ampacity_al: 18 },
            { awg: '-', mm2: 4.0, ampacity_cu: 32, ampacity_al: 25 },
            { awg: '-', mm2: 6.0, ampacity_cu: 41, ampacity_al: 32 },
            { awg: '-', mm2: 10.0, ampacity_cu: 57, ampacity_al: 44 },
            { awg: '-', mm2: 16.0, ampacity_cu: 76, ampacity_al: 59 },
            { awg: '-', mm2: 25.0, ampacity_cu: 101, ampacity_al: 78 },
            { awg: '-', mm2: 35.0, ampacity_cu: 125, ampacity_al: 96 },
            { awg: '-', mm2: 50.0, ampacity_cu: 151, ampacity_al: 117 },
            { awg: '-', mm2: 70.0, ampacity_cu: 192, ampacity_al: 148 },
            { awg: '-', mm2: 95.0, ampacity_cu: 232, ampacity_al: 179 },
            { awg: '-', mm2: 120.0, ampacity_cu: 269, ampacity_al: 207 },
            { awg: '-', mm2: 150.0, ampacity_cu: 309, ampacity_al: 238 },
            { awg: '-', mm2: 185.0, ampacity_cu: 353, ampacity_al: 272 },
            { awg: '-', mm2: 240.0, ampacity_cu: 415, ampacity_al: 320 }
          ];

          const wireInfo = wireSizes.find(wire => Math.abs(wire.mm2 - wireSize) < 0.1);
          const ampacityProperty = material === 'copper' ? 'ampacity_cu' : 'ampacity_al';
          const ampacity = wireInfo ? wireInfo[ampacityProperty] : null;
          const isAmpacitySufficient = ampacity ? ampacity >= current : null;

          const distanceTable = wireSizes
            .filter(wire => wire.mm2 >= wireSize * 0.5)
            .slice(0, 8)
            .map(wire => {
              const wireMaxResistance = phases === 1 ? allowedVoltageDrop / current : allowedVoltageDrop / (Math.sqrt(3) * current);
              const wireMaxDistance = (wireMaxResistance * wire.mm2) / (resistivity * 2);
              const wireAmpacitySufficient = wire[ampacityProperty] >= current;

              return {
                awg: wire.awg,
                mm2: wire.mm2,
                ampacity: wire[ampacityProperty],
                maxDistance: Math.round(wireMaxDistance * 100) / 100,
                ampacitySufficient: wireAmpacitySufficient,
                recommended: wireAmpacitySufficient && wireMaxDistance >= maxDistance
              };
            })
            .sort((a, b) => b.maxDistance - a.maxDistance);

          const warnings = [];
          if (voltageDropPercent > 5) {
            warnings.push({
              type: 'warning',
              message: '‚ö†Ô∏è % ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô 5% ‡∏≠‡∏≤‡∏à‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå',
              messageEN: '‚ö†Ô∏è Voltage drop exceeds 5%, may affect equipment performance'
            });
          }
          if (!isAmpacitySufficient) {
            warnings.push({
              type: 'error',
              message: '‚ùå ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Ampacity)',
              messageEN: '‚ùå Wire size insufficient for operating current (Ampacity)'
            });
          }
          if (warnings.length === 0) {
            warnings.push({
              type: 'success',
              message: '‚úÖ ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢',
              messageEN: '‚úÖ Calculation meets safety standards'
            });
          }

          return {
            success: true,
            input: { wireSize, current, voltage, voltageDropPercent, material, phases },
            calculation: {
              maxDistance: Math.round(maxDistance * 100) / 100,
              wireInfo: wireInfo || { awg: 'Custom', mm2: wireSize, [ampacityProperty]: 'Unknown' },
              ampacity,
              isAmpacitySufficient,
              distanceTable
            },
            warnings
          };
        }

        function calculateVoltageDropPercentageInline(wireSize, current, distance, voltage, material = 'copper', phases = 1) {
          if (wireSize <= 0 || current <= 0 || distance <= 0 || voltage <= 0) {
            return {
              error: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢, ‡∏Å‡∏£‡∏∞‡πÅ‡∏™, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0',
              errorEN: 'Invalid input: Wire size, current, distance, and voltage must be > 0'
            };
          }

          const resistivity = material === 'copper' ? 0.0175 : 0.0286;
          const resistance = (resistivity * distance * 2) / wireSize;

          let voltageDrop;
          if (phases === 1) {
            voltageDrop = resistance * current;
          } else {
            voltageDrop = resistance * current * Math.sqrt(3);
          }

          const voltageDropPercentage = (voltageDrop / voltage) * 100;
          const remainingVoltage = voltage - voltageDrop;

          const wireSizes = [
            { awg: '14', mm2: 2.08, ampacity_cu: 20, ampacity_al: 15 },
            { awg: '12', mm2: 3.31, ampacity_cu: 25, ampacity_al: 20 },
            { awg: '10', mm2: 5.26, ampacity_cu: 35, ampacity_al: 25 },
            { awg: '8', mm2: 8.37, ampacity_cu: 50, ampacity_al: 40 },
            { awg: '6', mm2: 13.3, ampacity_cu: 65, ampacity_al: 50 },
            { awg: '4', mm2: 21.2, ampacity_cu: 85, ampacity_al: 65 },
            { awg: '2', mm2: 33.6, ampacity_cu: 115, ampacity_al: 90 },
            { awg: '1/0', mm2: 53.5, ampacity_cu: 150, ampacity_al: 120 },
            { awg: '2/0', mm2: 67.4, ampacity_cu: 175, ampacity_al: 135 },
            { awg: '3/0', mm2: 85.0, ampacity_cu: 200, ampacity_al: 155 },
            { awg: '4/0', mm2: 107, ampacity_cu: 230, ampacity_al: 180 },
            { awg: '-', mm2: 1.5, ampacity_cu: 16, ampacity_al: 12 },
            { awg: '-', mm2: 2.5, ampacity_cu: 24, ampacity_al: 18 },
            { awg: '-', mm2: 4.0, ampacity_cu: 32, ampacity_al: 25 },
            { awg: '-', mm2: 6.0, ampacity_cu: 41, ampacity_al: 32 },
            { awg: '-', mm2: 10.0, ampacity_cu: 57, ampacity_al: 44 },
            { awg: '-', mm2: 16.0, ampacity_cu: 76, ampacity_al: 59 },
            { awg: '-', mm2: 25.0, ampacity_cu: 101, ampacity_al: 78 },
            { awg: '-', mm2: 35.0, ampacity_cu: 125, ampacity_al: 96 },
            { awg: '-', mm2: 50.0, ampacity_cu: 151, ampacity_al: 117 },
            { awg: '-', mm2: 70.0, ampacity_cu: 192, ampacity_al: 148 },
            { awg: '-', mm2: 95.0, ampacity_cu: 232, ampacity_al: 179 },
            { awg: '-', mm2: 120.0, ampacity_cu: 269, ampacity_al: 207 },
            { awg: '-', mm2: 150.0, ampacity_cu: 309, ampacity_al: 238 },
            { awg: '-', mm2: 185.0, ampacity_cu: 353, ampacity_al: 272 },
            { awg: '-', mm2: 240.0, ampacity_cu: 415, ampacity_al: 320 }
          ];

          const wireInfo = wireSizes.find(wire => Math.abs(wire.mm2 - wireSize) < 0.1);
          const ampacityProperty = material === 'copper' ? 'ampacity_cu' : 'ampacity_al';
          const ampacity = wireInfo ? wireInfo[ampacityProperty] : null;
          const isAmpacitySufficient = ampacity ? ampacity >= current : null;

          const standards = {
            residential: {
              branch: voltageDropPercentage <= 3,
              feeder: voltageDropPercentage <= 5,
              total: voltageDropPercentage <= 5
            },
            commercial: {
              branch: voltageDropPercentage <= 3,
              feeder: voltageDropPercentage <= 5,
              total: voltageDropPercentage <= 5
            },
            industrial: {
              branch: voltageDropPercentage <= 5,
              feeder: voltageDropPercentage <= 5,
              total: voltageDropPercentage <= 10
            }
          };

          const distanceComparisonTable = [10, 25, 50, 100, 150, 200, 300, 500].map(dist => {
            const distResistance = (resistivity * dist * 2) / wireSize;
            let distVoltageDrop;
            if (phases === 1) {
              distVoltageDrop = distResistance * current;
            } else {
              distVoltageDrop = distResistance * current * Math.sqrt(3);
            }
            const distVoltageDropPercent = (distVoltageDrop / voltage) * 100;

            return {
              distance: dist,
              voltageDrop: Math.round(distVoltageDrop * 100) / 100,
              voltageDropPercent: Math.round(distVoltageDropPercent * 100) / 100,
              remainingVoltage: Math.round((voltage - distVoltageDrop) * 100) / 100,
              acceptable: distVoltageDropPercent <= 5
            };
          });

          const warnings = [];
          if (voltageDropPercentage > 5) {
            warnings.push({
              type: 'warning',
              message: '‚ö†Ô∏è % ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô 5% ‡∏≠‡∏≤‡∏à‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå',
              messageEN: '‚ö†Ô∏è Voltage drop exceeds 5%, may affect equipment performance'
            });
          }
          if (voltageDropPercentage > 10) {
            warnings.push({
              type: 'error',
              message: '‚ùå % ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô 10% ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
              messageEN: '‚ùå Voltage drop exceeds 10%, unsuitable for operation'
            });
          }
          if (isAmpacitySufficient === false) {
            warnings.push({
              type: 'error',
              message: '‚ùå ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Ampacity)',
              messageEN: '‚ùå Wire size insufficient for operating current (Ampacity)'
            });
          }
          if (warnings.length === 0) {
            warnings.push({
              type: 'success',
              message: '‚úÖ ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢',
              messageEN: '‚úÖ Calculation meets safety standards'
            });
          }

          return {
            success: true,
            input: { wireSize, current, distance, voltage, material, phases },
            calculation: {
              resistance: Math.round(resistance * 10000) / 10000,
              voltageDrop: Math.round(voltageDrop * 100) / 100,
              voltageDropPercentage: Math.round(voltageDropPercentage * 100) / 100,
              remainingVoltage: Math.round(remainingVoltage * 100) / 100,
              wireInfo: wireInfo || { awg: 'Custom', mm2: wireSize, [ampacityProperty]: 'Unknown' },
              ampacity,
              isAmpacitySufficient,
              standards,
              distanceComparisonTable
            },
            warnings
          };
        }

        </script>

  <!-- Netlify Analytics -->
  <script defer src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </body>
</html>